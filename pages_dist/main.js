/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";!function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}();const e={NODE_CLIENT:!1,NODE_ADMIN:!1,SDK_VERSION:"${JSCORE_VERSION}"},t=function(e,t){if(!e)throw n(t)},n=function(t){return new Error("Firebase Database ("+e.SDK_VERSION+") INTERNAL ASSERT FAILED: "+t)},i=function(e){const t=[];let n=0;for(let i=0;i<e.length;i++){let s=e.charCodeAt(i);s<128?t[n++]=s:s<2048?(t[n++]=s>>6|192,t[n++]=63&s|128):55296==(64512&s)&&i+1<e.length&&56320==(64512&e.charCodeAt(i+1))?(s=65536+((1023&s)<<10)+(1023&e.charCodeAt(++i)),t[n++]=s>>18|240,t[n++]=s>>12&63|128,t[n++]=s>>6&63|128,t[n++]=63&s|128):(t[n++]=s>>12|224,t[n++]=s>>6&63|128,t[n++]=63&s|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,i=[];for(let t=0;t<e.length;t+=3){const s=e[t],r=t+1<e.length,o=r?e[t+1]:0,a=t+2<e.length,c=a?e[t+2]:0,l=s>>2,h=(3&s)<<4|o>>4;let u=(15&o)<<2|c>>6,d=63&c;a||(d=64,r||(u=64)),i.push(n[l],n[h],n[u],n[d])}return i.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let n=0,i=0;for(;n<e.length;){const s=e[n++];if(s<128)t[i++]=String.fromCharCode(s);else if(s>191&&s<224){const r=e[n++];t[i++]=String.fromCharCode((31&s)<<6|63&r)}else if(s>239&&s<365){const r=((7&s)<<18|(63&e[n++])<<12|(63&e[n++])<<6|63&e[n++])-65536;t[i++]=String.fromCharCode(55296+(r>>10)),t[i++]=String.fromCharCode(56320+(1023&r))}else{const r=e[n++],o=e[n++];t[i++]=String.fromCharCode((15&s)<<12|(63&r)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const n=t?this.charToByteMapWebSafe_:this.charToByteMap_,i=[];for(let t=0;t<e.length;){const s=n[e.charAt(t++)],r=t<e.length?n[e.charAt(t)]:0;++t;const o=t<e.length?n[e.charAt(t)]:64;++t;const a=t<e.length?n[e.charAt(t)]:64;if(++t,null==s||null==r||null==o||null==a)throw Error();const c=s<<2|r>>4;if(i.push(c),64!==o){const e=r<<4&240|o>>2;if(i.push(e),64!==a){const e=o<<6&192|a;i.push(e)}}}return i},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}},r=function(e){const t=i(e);return s.encodeByteArray(t,!0)},o=function(e){return r(e).replace(/\./g,"")},a=function(e){try{return s.decodeString(e,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function c(e){return l(void 0,e)}function l(e,t){if(!(t instanceof Object))return t;switch(t.constructor){case Date:return new Date(t.getTime());case Object:void 0===e&&(e={});break;case Array:e=[];break;default:return t}for(const n in t)t.hasOwnProperty(n)&&"__proto__"!==n&&(e[n]=l(e[n],t[n]));return e}class h{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((e,t)=>{this.resolve=e,this.reject=t}))}wrapCallback(e){return(t,n)=>{t?this.reject(t):this.resolve(n),"function"==typeof e&&(this.promise.catch((()=>{})),1===e.length?e(t):e(t,n))}}}function u(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(u())}function p(){const e="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof e&&void 0!==e.id}function f(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function _(){return!0===e.NODE_CLIENT||!0===e.NODE_ADMIN}function m(){return"object"==typeof indexedDB}function g(){return new Promise(((e,t)=>{try{let n=!0;const i="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(i);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(i),e(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var e;t((null===(e=s.error)||void 0===e?void 0:e.message)||"")}}catch(e){t(e)}}))}class v extends Error{constructor(e,t,n){super(t),this.code=e,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,v.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,y.prototype.create)}}class y{constructor(e,t,n){this.service=e,this.serviceName=t,this.errors=n}create(e,...t){const n=t[0]||{},i=`${this.service}/${e}`,s=this.errors[e],r=s?function(e,t){return e.replace(w,((e,n)=>{const i=t[n];return null!=i?String(i):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${r} (${i}).`;return new v(i,o,n)}}const w=/\{\$([^}]+)}/g;function I(e){return JSON.parse(e)}function b(e){return JSON.stringify(e)}const C=function(e){let t={},n={},i={},s="";try{const r=e.split(".");t=I(a(r[0])||""),n=I(a(r[1])||""),s=r[2],i=n.d||{},delete n.d}catch(e){}return{header:t,claims:n,data:i,signature:s}};function T(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function k(e,t){return Object.prototype.hasOwnProperty.call(e,t)?e[t]:void 0}function E(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}function S(e,t,n){const i={};for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(i[s]=t.call(n,e[s],s,e));return i}function N(e,t){if(e===t)return!0;const n=Object.keys(e),i=Object.keys(t);for(const s of n){if(!i.includes(s))return!1;const n=e[s],r=t[s];if(P(n)&&P(r)){if(!N(n,r))return!1}else if(n!==r)return!1}for(const e of i)if(!n.includes(e))return!1;return!0}function P(e){return null!==e&&"object"==typeof e}function R(e){const t=[];for(const[n,i]of Object.entries(e))Array.isArray(i)?i.forEach((e=>{t.push(encodeURIComponent(n)+"="+encodeURIComponent(e))})):t.push(encodeURIComponent(n)+"="+encodeURIComponent(i));return t.length?"&"+t.join("&"):""}function O(e){const t={};return e.replace(/^\?/,"").split("&").forEach((e=>{if(e){const[n,i]=e.split("=");t[decodeURIComponent(n)]=decodeURIComponent(i)}})),t}function D(e){const t=e.indexOf("?");if(!t)return"";const n=e.indexOf("#",t);return e.substring(t,n>0?n:void 0)}class A{constructor(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(let e=1;e<this.blockSize;++e)this.pad_[e]=0;this.reset()}reset(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0}compress_(e,t){t||(t=0);const n=this.W_;if("string"==typeof e)for(let i=0;i<16;i++)n[i]=e.charCodeAt(t)<<24|e.charCodeAt(t+1)<<16|e.charCodeAt(t+2)<<8|e.charCodeAt(t+3),t+=4;else for(let i=0;i<16;i++)n[i]=e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3],t+=4;for(let e=16;e<80;e++){const t=n[e-3]^n[e-8]^n[e-14]^n[e-16];n[e]=4294967295&(t<<1|t>>>31)}let i,s,r=this.chain_[0],o=this.chain_[1],a=this.chain_[2],c=this.chain_[3],l=this.chain_[4];for(let e=0;e<80;e++){e<40?e<20?(i=c^o&(a^c),s=1518500249):(i=o^a^c,s=1859775393):e<60?(i=o&a|c&(o|a),s=2400959708):(i=o^a^c,s=3395469782);const t=(r<<5|r>>>27)+i+l+s+n[e]&4294967295;l=c,c=a,a=4294967295&(o<<30|o>>>2),o=r,r=t}this.chain_[0]=this.chain_[0]+r&4294967295,this.chain_[1]=this.chain_[1]+o&4294967295,this.chain_[2]=this.chain_[2]+a&4294967295,this.chain_[3]=this.chain_[3]+c&4294967295,this.chain_[4]=this.chain_[4]+l&4294967295}update(e,t){if(null==e)return;void 0===t&&(t=e.length);const n=t-this.blockSize;let i=0;const s=this.buf_;let r=this.inbuf_;for(;i<t;){if(0===r)for(;i<=n;)this.compress_(e,i),i+=this.blockSize;if("string"==typeof e){for(;i<t;)if(s[r]=e.charCodeAt(i),++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}else for(;i<t;)if(s[r]=e[i],++r,++i,r===this.blockSize){this.compress_(s),r=0;break}}this.inbuf_=r,this.total_+=t}digest(){const e=[];let t=8*this.total_;this.inbuf_<56?this.update(this.pad_,56-this.inbuf_):this.update(this.pad_,this.blockSize-(this.inbuf_-56));for(let e=this.blockSize-1;e>=56;e--)this.buf_[e]=255&t,t/=256;this.compress_(this.buf_);let n=0;for(let t=0;t<5;t++)for(let i=24;i>=0;i-=8)e[n]=this.chain_[t]>>i&255,++n;return e}}class x{constructor(e,t){this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=t,this.task.then((()=>{e(this)})).catch((e=>{this.error(e)}))}next(e){this.forEachObserver((t=>{t.next(e)}))}error(e){this.forEachObserver((t=>{t.error(e)})),this.close(e)}complete(){this.forEachObserver((e=>{e.complete()})),this.close()}subscribe(e,t,n){let i;if(void 0===e&&void 0===t&&void 0===n)throw new Error("Missing Observer.");i=function(e,t){if("object"!=typeof e||null===e)return!1;for(const t of["next","error","complete"])if(t in e&&"function"==typeof e[t])return!0;return!1}(e)?e:{next:e,error:t,complete:n},void 0===i.next&&(i.next=M),void 0===i.error&&(i.error=M),void 0===i.complete&&(i.complete=M);const s=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then((()=>{try{this.finalError?i.error(this.finalError):i.complete()}catch(e){}})),this.observers.push(i),s}unsubscribeOne(e){void 0!==this.observers&&void 0!==this.observers[e]&&(delete this.observers[e],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))}forEachObserver(e){if(!this.finalized)for(let t=0;t<this.observers.length;t++)this.sendOne(t,e)}sendOne(e,t){this.task.then((()=>{if(void 0!==this.observers&&void 0!==this.observers[e])try{t(this.observers[e])}catch(e){"undefined"!=typeof console&&console.error&&console.error(e)}}))}close(e){this.finalized||(this.finalized=!0,void 0!==e&&(this.finalError=e),this.task.then((()=>{this.observers=void 0,this.onNoObservers=void 0})))}}function M(){}function L(e,t){return`${e} failed: ${t} argument `}const F=function(e){let t=0;for(let n=0;n<e.length;n++){const i=e.charCodeAt(n);i<128?t++:i<2048?t+=2:i>=55296&&i<=56319?(t+=4,n++):t+=3}return t},U=1e3,q=2,j=144e5,W=.5;function H(e,t=U,n=q){const i=t*Math.pow(n,e),s=Math.round(W*i*(Math.random()-.5)*2);return Math.min(j,i+s)}function V(e){return e&&e._delegate?e._delegate:e}class z{constructor(e,t,n){this.name=e,this.instanceFactory=t,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const B="[DEFAULT]";class ${constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new h;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:t});n&&e.resolve(n)}catch(e){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const n=this.normalizeInstanceIdentifier(null==e?void 0:e.identifier),i=null!==(t=null==e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(i)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(e){if(i)return null;throw e}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error(`Mismatching Component ${e.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:B})}catch(e){}for(const[e,t]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});t.resolve(e)}catch(e){}}}}clearInstance(e=B){this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter((e=>"INTERNAL"in e)).map((e=>e.INTERNAL.delete())),...e.filter((e=>"_delete"in e)).map((e=>e._delete()))])}isComponentSet(){return null!=this.component}isInitialized(e=B){return this.instances.has(e)}getOptions(e=B){return this.instancesOptions.get(e)||{}}initialize(e={}){const{options:t={}}=e,n=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const i=this.getOrInitializeService({instanceIdentifier:n,options:t});for(const[e,t]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(e)&&t.resolve(i);return i}onInit(e,t){var n;const i=this.normalizeInstanceIdentifier(t),s=null!==(n=this.onInitCallbacks.get(i))&&void 0!==n?n:new Set;s.add(e),this.onInitCallbacks.set(i,s);const r=this.instances.get(i);return r&&e(r,i),()=>{s.delete(e)}}invokeOnInitCallbacks(e,t){const n=this.onInitCallbacks.get(t);if(n)for(const i of n)try{i(e,t)}catch(e){}}getOrInitializeService({instanceIdentifier:e,options:t={}}){let n=this.instances.get(e);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=e,i===B?void 0:i),options:t}),this.instances.set(e,n),this.instancesOptions.set(e,t),this.invokeOnInitCallbacks(n,e),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,e,n)}catch(e){}var i;return n||null}normalizeInstanceIdentifier(e=B){return this.component?this.component.multipleInstances?e:B:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class K{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error(`Component ${e.name} has already been registered with ${this.name}`);t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new $(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const G=[];var Y;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(Y||(Y={}));const J={debug:Y.DEBUG,verbose:Y.VERBOSE,info:Y.INFO,warn:Y.WARN,error:Y.ERROR,silent:Y.SILENT},Q=Y.INFO,X={[Y.DEBUG]:"log",[Y.VERBOSE]:"log",[Y.INFO]:"info",[Y.WARN]:"warn",[Y.ERROR]:"error"},Z=(e,t,...n)=>{if(t<e.logLevel)return;const i=(new Date).toISOString(),s=X[t];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${t})`);console[s](`[${i}]  ${e.name}:`,...n)};class ee{constructor(e){this.name=e,this._logLevel=Q,this._logHandler=Z,this._userLogHandler=null,G.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in Y))throw new TypeError(`Invalid value "${e}" assigned to \`logLevel\``);this._logLevel=e}setLogLevel(e){this._logLevel="string"==typeof e?J[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!=typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(...e){this._userLogHandler&&this._userLogHandler(this,Y.DEBUG,...e),this._logHandler(this,Y.DEBUG,...e)}log(...e){this._userLogHandler&&this._userLogHandler(this,Y.VERBOSE,...e),this._logHandler(this,Y.VERBOSE,...e)}info(...e){this._userLogHandler&&this._userLogHandler(this,Y.INFO,...e),this._logHandler(this,Y.INFO,...e)}warn(...e){this._userLogHandler&&this._userLogHandler(this,Y.WARN,...e),this._logHandler(this,Y.WARN,...e)}error(...e){this._userLogHandler&&this._userLogHandler(this,Y.ERROR,...e),this._logHandler(this,Y.ERROR,...e)}}const te=(e,t)=>t.some((t=>e instanceof t));let ne,ie;const se=new WeakMap,re=new WeakMap,oe=new WeakMap,ae=new WeakMap,ce=new WeakMap;let le={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return re.get(e);if("objectStoreNames"===t)return e.objectStoreNames||oe.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return ue(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function he(e){return"function"==typeof e?(t=e)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(ie||(ie=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(t)?function(...e){return t.apply(de(this),e),ue(se.get(this))}:function(...e){return ue(t.apply(de(this),e))}:function(e,...n){const i=t.call(de(this),e,...n);return oe.set(i,e.sort?e.sort():[e]),ue(i)}:(e instanceof IDBTransaction&&function(e){if(re.has(e))return;const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("complete",s),e.removeEventListener("error",r),e.removeEventListener("abort",r)},s=()=>{t(),i()},r=()=>{n(e.error||new DOMException("AbortError","AbortError")),i()};e.addEventListener("complete",s),e.addEventListener("error",r),e.addEventListener("abort",r)}));re.set(e,t)}(e),te(e,ne||(ne=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(e,le):e);var t}function ue(e){if(e instanceof IDBRequest)return function(e){const t=new Promise(((t,n)=>{const i=()=>{e.removeEventListener("success",s),e.removeEventListener("error",r)},s=()=>{t(ue(e.result)),i()},r=()=>{n(e.error),i()};e.addEventListener("success",s),e.addEventListener("error",r)}));return t.then((t=>{t instanceof IDBCursor&&se.set(t,e)})).catch((()=>{})),ce.set(t,e),t}(e);if(ae.has(e))return ae.get(e);const t=he(e);return t!==e&&(ae.set(e,t),ce.set(t,e)),t}const de=e=>ce.get(e);function pe(e,t,{blocked:n,upgrade:i,blocking:s,terminated:r}={}){const o=indexedDB.open(e,t),a=ue(o);return i&&o.addEventListener("upgradeneeded",(e=>{i(ue(o.result),e.oldVersion,e.newVersion,ue(o.transaction))})),n&&o.addEventListener("blocked",(()=>n())),a.then((e=>{r&&e.addEventListener("close",(()=>r())),s&&e.addEventListener("versionchange",(()=>s()))})).catch((()=>{})),a}const fe=["get","getKey","getAll","getAllKeys","count"],_e=["put","add","delete","clear"],me=new Map;function ge(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!=typeof t)return;if(me.get(t))return me.get(t);const n=t.replace(/FromIndex$/,""),i=t!==n,s=_e.includes(n);if(!(n in(i?IDBIndex:IDBObjectStore).prototype)||!s&&!fe.includes(n))return;const r=async function(e,...t){const r=this.transaction(e,s?"readwrite":"readonly");let o=r.store;return i&&(o=o.index(t.shift())),(await Promise.all([o[n](...t),s&&r.done]))[0]};return me.set(t,r),r}var ve;ve=le,le={...ve,get:(e,t,n)=>ge(e,t)||ve.get(e,t,n),has:(e,t)=>!!ge(e,t)||ve.has(e,t)};class ye{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map((e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null==t?void 0:t.type)}(e)){const t=e.getImmediate();return`${t.library}/${t.version}`}return null})).filter((e=>e)).join(" ")}}const we="@firebase/app",Ie="0.7.31",be=new ee("@firebase/app"),Ce="[DEFAULT]",Te={[we]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},ke=new Map,Ee=new Map;function Se(e,t){try{e.container.addComponent(t)}catch(n){be.debug(`Component ${t.name} failed to register with FirebaseApp ${e.name}`,n)}}function Ne(e){const t=e.name;if(Ee.has(t))return be.debug(`There were multiple attempts to register component ${t}.`),!1;Ee.set(t,e);for(const t of ke.values())Se(t,e);return!0}function Pe(e,t){const n=e.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),e.container.getProvider(t)}const Re=new y("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class Oe{constructor(e,t,n){this._isDeleted=!1,this._options=Object.assign({},e),this._config=Object.assign({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new z("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Re.create("app-deleted",{appName:this._name})}}const De="9.9.3";function Ae(e=Ce){const t=ke.get(e);if(!t)throw Re.create("no-app",{appName:e});return t}function xe(e,t,n){var i;let s=null!==(i=Te[e])&&void 0!==i?i:e;n&&(s+=`-${n}`);const r=s.match(/\s|\//),o=t.match(/\s|\//);if(r||o){const e=[`Unable to register library "${s}" with version "${t}":`];return r&&e.push(`library name "${s}" contains illegal characters (whitespace or "/")`),r&&o&&e.push("and"),o&&e.push(`version name "${t}" contains illegal characters (whitespace or "/")`),void be.warn(e.join(" "))}Ne(new z(`${s}-version`,(()=>({library:s,version:t})),"VERSION"))}const Me="firebase-heartbeat-database",Le=1,Fe="firebase-heartbeat-store";let Ue=null;function qe(){return Ue||(Ue=pe(Me,Le,{upgrade:(e,t)=>{0===t&&e.createObjectStore(Fe)}}).catch((e=>{throw Re.create("idb-open",{originalErrorMessage:e.message})}))),Ue}async function je(e,t){var n;try{const n=(await qe()).transaction(Fe,"readwrite"),i=n.objectStore(Fe);return await i.put(t,We(e)),n.done}catch(e){if(e instanceof v)be.warn(e.message);else{const t=Re.create("idb-set",{originalErrorMessage:null===(n=e)||void 0===n?void 0:n.message});be.warn(t.message)}}}function We(e){return`${e.name}!${e.options.appId}`}class He{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new ze(t),this._heartbeatsCachePromise=this._storage.read().then((e=>(this._heartbeatsCache=e,e)))}async triggerHeartbeat(){const e=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),t=Ve();if(null===this._heartbeatsCache&&(this._heartbeatsCache=await this._heartbeatsCachePromise),this._heartbeatsCache.lastSentHeartbeatDate!==t&&!this._heartbeatsCache.heartbeats.some((e=>e.date===t)))return this._heartbeatsCache.heartbeats.push({date:t,agent:e}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((e=>{const t=new Date(e.date).valueOf();return Date.now()-t<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null===this._heartbeatsCache||0===this._heartbeatsCache.heartbeats.length)return"";const e=Ve(),{heartbeatsToSend:t,unsentEntries:n}=function(e,t=1024){const n=[];let i=e.slice();for(const s of e){const e=n.find((e=>e.agent===s.agent));if(e){if(e.dates.push(s.date),Be(n)>t){e.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),Be(n)>t){n.pop();break}i=i.slice(1)}return{heartbeatsToSend:n,unsentEntries:i}}(this._heartbeatsCache.heartbeats),i=o(JSON.stringify({version:2,heartbeats:t}));return this._heartbeatsCache.lastSentHeartbeatDate=e,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function Ve(){return(new Date).toISOString().substring(0,10)}class ze{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!m()&&g().then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){return await async function(e){var t;try{return(await qe()).transaction(Fe).objectStore(Fe).get(We(e))}catch(e){if(e instanceof v)be.warn(e.message);else{const n=Re.create("idb-get",{originalErrorMessage:null===(t=e)||void 0===t?void 0:t.message});be.warn(n.message)}}}(this.app)||{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return je(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){var t;if(await this._canUseIndexedDBPromise){const n=await this.read();return je(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...e.heartbeats]})}}}function Be(e){return o(JSON.stringify({version:2,heartbeats:e})).length}Ne(new z("platform-logger",(e=>new ye(e)),"PRIVATE")),Ne(new z("heartbeat",(e=>new He(e)),"PRIVATE")),xe(we,Ie,""),xe(we,Ie,"esm2017"),xe("fire-js",""),xe("firebase","9.9.3","app");const $e="@firebase/installations",Ke="0.5.12",Ge=1e4,Ye=`w:${Ke}`,Je="FIS_v2",Qe="https://firebaseinstallations.googleapis.com/v1",Xe=36e5,Ze=new y("installations","Installations",{"missing-app-config-values":'Missing App configuration value: "{$valueName}"',"not-registered":"Firebase Installation is not registered.","installation-not-found":"Firebase Installation not found.","request-failed":'{$requestName} request failed with error "{$serverCode} {$serverStatus}: {$serverMessage}"',"app-offline":"Could not process request. Application offline.","delete-pending-registration":"Can't delete installation while there is a pending registration request."});function et(e){return e instanceof v&&e.code.includes("request-failed")}function tt({projectId:e}){return`${Qe}/projects/${e}/installations`}function nt(e){return{token:e.token,requestStatus:2,expiresIn:(t=e.expiresIn,Number(t.replace("s","000"))),creationTime:Date.now()};var t}async function it(e,t){const n=(await t.json()).error;return Ze.create("request-failed",{requestName:e,serverCode:n.code,serverMessage:n.message,serverStatus:n.status})}function st({apiKey:e}){return new Headers({"Content-Type":"application/json",Accept:"application/json","x-goog-api-key":e})}async function rt(e){const t=await e();return t.status>=500&&t.status<600?e():t}function ot(e){return new Promise((t=>{setTimeout(t,e)}))}const at=/^[cdef][\w-]{21}$/,ct="";function lt(){try{const e=new Uint8Array(17);(self.crypto||self.msCrypto).getRandomValues(e),e[0]=112+e[0]%16;const t=function(e){var t;return(t=e,btoa(String.fromCharCode(...t)).replace(/\+/g,"-").replace(/\//g,"_")).substr(0,22)}(e);return at.test(t)?t:ct}catch(e){return ct}}function ht(e){return`${e.appName}!${e.appId}`}const ut=new Map;function dt(e,t){const n=ht(e);pt(n,t),function(e,t){const n=(!ft&&"BroadcastChannel"in self&&(ft=new BroadcastChannel("[Firebase] FID Change"),ft.onmessage=e=>{pt(e.data.key,e.data.fid)}),ft);n&&n.postMessage({key:e,fid:t}),0===ut.size&&ft&&(ft.close(),ft=null)}(n,t)}function pt(e,t){const n=ut.get(e);if(n)for(const e of n)e(t)}let ft=null;const _t="firebase-installations-database",mt=1,gt="firebase-installations-store";let vt=null;function yt(){return vt||(vt=pe(_t,mt,{upgrade:(e,t)=>{0===t&&e.createObjectStore(gt)}})),vt}async function wt(e,t){const n=ht(e),i=(await yt()).transaction(gt,"readwrite"),s=i.objectStore(gt),r=await s.get(n);return await s.put(t,n),await i.done,r&&r.fid===t.fid||dt(e,t.fid),t}async function It(e){const t=ht(e),n=(await yt()).transaction(gt,"readwrite");await n.objectStore(gt).delete(t),await n.done}async function bt(e,t){const n=ht(e),i=(await yt()).transaction(gt,"readwrite"),s=i.objectStore(gt),r=await s.get(n),o=t(r);return void 0===o?await s.delete(n):await s.put(o,n),await i.done,!o||r&&r.fid===o.fid||dt(e,o.fid),o}async function Ct(e){let t;const n=await bt(e.appConfig,(n=>{const i=function(e){return Et(e||{fid:lt(),registrationStatus:0})}(n),s=function(e,t){if(0===t.registrationStatus){if(!navigator.onLine)return{installationEntry:t,registrationPromise:Promise.reject(Ze.create("app-offline"))};const n={fid:t.fid,registrationStatus:1,registrationTime:Date.now()},i=async function(e,t){try{const n=await async function({appConfig:e,heartbeatServiceProvider:t},{fid:n}){const i=tt(e),s=st(e),r=t.getImmediate({optional:!0});if(r){const e=await r.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}const o={fid:n,authVersion:Je,appId:e.appId,sdkVersion:Ye},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await rt((()=>fetch(i,a)));if(c.ok){const e=await c.json();return{fid:e.fid||n,registrationStatus:2,refreshToken:e.refreshToken,authToken:nt(e.authToken)}}throw await it("Create Installation",c)}(e,t);return wt(e.appConfig,n)}catch(n){throw et(n)&&409===n.customData.serverCode?await It(e.appConfig):await wt(e.appConfig,{fid:t.fid,registrationStatus:0}),n}}(e,n);return{installationEntry:n,registrationPromise:i}}return 1===t.registrationStatus?{installationEntry:t,registrationPromise:Tt(e)}:{installationEntry:t}}(e,i);return t=s.registrationPromise,s.installationEntry}));return n.fid===ct?{installationEntry:await t}:{installationEntry:n,registrationPromise:t}}async function Tt(e){let t=await kt(e.appConfig);for(;1===t.registrationStatus;)await ot(100),t=await kt(e.appConfig);if(0===t.registrationStatus){const{installationEntry:t,registrationPromise:n}=await Ct(e);return n||t}return t}function kt(e){return bt(e,(e=>{if(!e)throw Ze.create("installation-not-found");return Et(e)}))}function Et(e){return 1===(t=e).registrationStatus&&t.registrationTime+Ge<Date.now()?{fid:e.fid,registrationStatus:0}:e;var t}async function St({appConfig:e,heartbeatServiceProvider:t},n){const i=function(e,{fid:t}){return`${tt(e)}/${t}/authTokens:generate`}(e,n),s=function(e,{refreshToken:t}){const n=st(e);return n.append("Authorization",function(e){return`${Je} ${e}`}(t)),n}(e,n),r=t.getImmediate({optional:!0});if(r){const e=await r.getHeartbeatsHeader();e&&s.append("x-firebase-client",e)}const o={installation:{sdkVersion:Ye,appId:e.appId}},a={method:"POST",headers:s,body:JSON.stringify(o)},c=await rt((()=>fetch(i,a)));if(c.ok)return nt(await c.json());throw await it("Generate Auth Token",c)}async function Nt(e,t=!1){let n;const i=await bt(e.appConfig,(i=>{if(!Rt(i))throw Ze.create("not-registered");const s=i.authToken;if(!t&&(2===(r=s).requestStatus&&!function(e){const t=Date.now();return t<e.creationTime||e.creationTime+e.expiresIn<t+Xe}(r)))return i;var r;if(1===s.requestStatus)return n=async function(e,t){let n=await Pt(e.appConfig);for(;1===n.authToken.requestStatus;)await ot(100),n=await Pt(e.appConfig);const i=n.authToken;return 0===i.requestStatus?Nt(e,t):i}(e,t),i;{if(!navigator.onLine)throw Ze.create("app-offline");const t=function(e){const t={requestStatus:1,requestTime:Date.now()};return Object.assign(Object.assign({},e),{authToken:t})}(i);return n=async function(e,t){try{const n=await St(e,t),i=Object.assign(Object.assign({},t),{authToken:n});return await wt(e.appConfig,i),n}catch(n){if(!et(n)||401!==n.customData.serverCode&&404!==n.customData.serverCode){const n=Object.assign(Object.assign({},t),{authToken:{requestStatus:0}});await wt(e.appConfig,n)}else await It(e.appConfig);throw n}}(e,t),t}}));return n?await n:i.authToken}function Pt(e){return bt(e,(e=>{if(!Rt(e))throw Ze.create("not-registered");return 1===(t=e.authToken).requestStatus&&t.requestTime+Ge<Date.now()?Object.assign(Object.assign({},e),{authToken:{requestStatus:0}}):e;var t}))}function Rt(e){return void 0!==e&&2===e.registrationStatus}function Ot(e){return Ze.create("missing-app-config-values",{valueName:e})}const Dt="installations";Ne(new z(Dt,(e=>{const t=e.getProvider("app").getImmediate(),n=function(e){if(!e||!e.options)throw Ot("App Configuration");if(!e.name)throw Ot("App Name");const t=["projectId","apiKey","appId"];for(const n of t)if(!e.options[n])throw Ot(n);return{appName:e.name,projectId:e.options.projectId,apiKey:e.options.apiKey,appId:e.options.appId}}(t);return{app:t,appConfig:n,heartbeatServiceProvider:Pe(t,"heartbeat"),_delete:()=>Promise.resolve()}}),"PUBLIC")),Ne(new z("installations-internal",(e=>{const t=Pe(e.getProvider("app").getImmediate(),Dt).getImmediate();return{getId:()=>async function(e){const t=e,{installationEntry:n,registrationPromise:i}=await Ct(t);return i?i.catch(console.error):Nt(t).catch(console.error),n.fid}(t),getToken:e=>async function(e,t=!1){const n=e;return await async function(e){const{registrationPromise:t}=await Ct(e);t&&await t}(n),(await Nt(n,t)).token}(t,e)}}),"PRIVATE")),xe($e,Ke),xe($e,Ke,"esm2017");const At="analytics",xt="firebase_id",Mt="origin",Lt=6e4,Ft="https://firebase.googleapis.com/v1alpha/projects/-/apps/{app-id}/webConfig",Ut="https://www.googletagmanager.com/gtag/js",qt=new ee("@firebase/analytics");function jt(e){return Promise.all(e.map((e=>e.catch((e=>e)))))}const Wt=new y("analytics","Analytics",{"already-exists":"A Firebase Analytics instance with the appId {$id}  already exists. Only one Firebase Analytics instance can be created for each appId.","already-initialized":"initializeAnalytics() cannot be called again with different options than those it was initially called with. It can be called again with the same options to return the existing instance, or getAnalytics() can be used to get a reference to the already-intialized instance.","already-initialized-settings":"Firebase Analytics has already been initialized.settings() must be called before initializing any Analytics instanceor it will have no effect.","interop-component-reg-failed":"Firebase Analytics Interop Component failed to instantiate: {$reason}","invalid-analytics-context":"Firebase Analytics is not supported in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","indexeddb-unavailable":"IndexedDB unavailable or restricted in this environment. Wrap initialization of analytics in analytics.isSupported() to prevent initialization in unsupported environments. Details: {$errorInfo}","fetch-throttle":"The config fetch request timed out while in an exponential backoff state. Unix timestamp in milliseconds when fetch request throttling ends: {$throttleEndTimeMillis}.","config-fetch-failed":"Dynamic config fetch failed: [{$httpStatus}] {$responseMessage}","no-api-key":'The "apiKey" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid API key.',"no-app-id":'The "appId" field is empty in the local Firebase config. Firebase Analytics requires this field tocontain a valid app ID.'}),Ht=30,Vt=new class{constructor(e={},t=1e3){this.throttleMetadata=e,this.intervalMillis=t}getThrottleMetadata(e){return this.throttleMetadata[e]}setThrottleMetadata(e,t){this.throttleMetadata[e]=t}deleteThrottleMetadata(e){delete this.throttleMetadata[e]}};function zt(e){return new Headers({Accept:"application/json","x-goog-api-key":e})}async function Bt(e,t=Vt,n){const{appId:i,apiKey:s,measurementId:r}=e.options;if(!i)throw Wt.create("no-app-id");if(!s){if(r)return{measurementId:r,appId:i};throw Wt.create("no-api-key")}const o=t.getThrottleMetadata(i)||{backoffCount:0,throttleEndTimeMillis:Date.now()},a=new Kt;return setTimeout((async()=>{a.abort()}),void 0!==n?n:Lt),$t({appId:i,apiKey:s,measurementId:r},o,a,t)}async function $t(e,{throttleEndTimeMillis:t,backoffCount:n},i,s=Vt){var r,o;const{appId:a,measurementId:c}=e;try{await function(e,t){return new Promise(((n,i)=>{const s=Math.max(t-Date.now(),0),r=setTimeout(n,s);e.addEventListener((()=>{clearTimeout(r),i(Wt.create("fetch-throttle",{throttleEndTimeMillis:t}))}))}))}(i,t)}catch(e){if(c)return qt.warn(`Timed out fetching this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null===(r=e)||void 0===r?void 0:r.message}]`),{appId:a,measurementId:c};throw e}try{const t=await async function(e){var t;const{appId:n,apiKey:i}=e,s={method:"GET",headers:zt(i)},r=Ft.replace("{app-id}",n),o=await fetch(r,s);if(200!==o.status&&304!==o.status){let e="";try{const n=await o.json();(null===(t=n.error)||void 0===t?void 0:t.message)&&(e=n.error.message)}catch(e){}throw Wt.create("config-fetch-failed",{httpStatus:o.status,responseMessage:e})}return o.json()}(e);return s.deleteThrottleMetadata(a),t}catch(t){const r=t;if(!function(e){if(!(e instanceof v&&e.customData))return!1;const t=Number(e.customData.httpStatus);return 429===t||500===t||503===t||504===t}(r)){if(s.deleteThrottleMetadata(a),c)return qt.warn(`Failed to fetch this Firebase app's measurement ID from the server. Falling back to the measurement ID ${c} provided in the "measurementId" field in the local Firebase config. [${null==r?void 0:r.message}]`),{appId:a,measurementId:c};throw t}const l=503===Number(null===(o=null==r?void 0:r.customData)||void 0===o?void 0:o.httpStatus)?H(n,s.intervalMillis,Ht):H(n,s.intervalMillis),h={throttleEndTimeMillis:Date.now()+l,backoffCount:n+1};return s.setThrottleMetadata(a,h),qt.debug(`Calling attemptFetch again in ${l} millis`),$t(e,h,i,s)}}class Kt{constructor(){this.listeners=[]}addEventListener(e){this.listeners.push(e)}abort(){this.listeners.forEach((e=>e()))}}let Gt,Yt;async function Jt(e,t,n,i,s,r,o){var a;const c=Bt(e);c.then((t=>{n[t.measurementId]=t.appId,e.options.measurementId&&t.measurementId!==e.options.measurementId&&qt.warn(`The measurement ID in the local Firebase config (${e.options.measurementId}) does not match the measurement ID fetched from the server (${t.measurementId}). To ensure analytics events are always sent to the correct Analytics property, update the measurement ID field in the local config or remove it from the local config.`)})).catch((e=>qt.error(e))),t.push(c);const l=async function(){var e;if(!m())return qt.warn(Wt.create("indexeddb-unavailable",{errorInfo:"IndexedDB is not available in this environment."}).message),!1;try{await g()}catch(t){return qt.warn(Wt.create("indexeddb-unavailable",{errorInfo:null===(e=t)||void 0===e?void 0:e.toString()}).message),!1}return!0}().then((e=>e?i.getId():void 0)),[h,u]=await Promise.all([c,l]);(function(){const e=window.document.getElementsByTagName("script");for(const t of Object.values(e))if(t.src&&t.src.includes(Ut))return t;return null})()||function(e,t){const n=document.createElement("script");n.src=`${Ut}?l=${e}&id=${t}`,n.async=!0,document.head.appendChild(n)}(r,h.measurementId),Yt&&(s("consent","default",Yt),Yt=void 0),s("js",new Date);const d=null!==(a=null==o?void 0:o.config)&&void 0!==a?a:{};return d[Mt]="firebase",d.update=!0,null!=u&&(d[xt]=u),s("config",h.measurementId,d),Gt&&(s("set",Gt),Gt=void 0),h.measurementId}class Qt{constructor(e){this.app=e}_delete(){return delete Xt[this.app.options.appId],Promise.resolve()}}let Xt={},Zt=[];const en={};let tn,nn,sn="dataLayer",rn="gtag",on=!1;function an(e,t,n){!function(){const e=[];if(p()&&e.push("This is a browser extension environment."),"undefined"!=typeof navigator&&navigator.cookieEnabled||e.push("Cookies are not available."),e.length>0){const t=e.map(((e,t)=>`(${t+1}) ${e}`)).join(" "),n=Wt.create("invalid-analytics-context",{errorInfo:t});qt.warn(n.message)}}();const i=e.options.appId;if(!i)throw Wt.create("no-app-id");if(!e.options.apiKey){if(!e.options.measurementId)throw Wt.create("no-api-key");qt.warn(`The "apiKey" field is empty in the local Firebase config. This is needed to fetch the latest measurement ID for this Firebase app. Falling back to the measurement ID ${e.options.measurementId} provided in the "measurementId" field in the local Firebase config.`)}if(null!=Xt[i])throw Wt.create("already-exists",{id:i});if(!on){!function(e){let t=[];Array.isArray(window[e])?t=window[e]:window[e]=t}(sn);const{wrappedGtag:e,gtagCore:t}=function(e,t,n,i,s){let r=function(...e){window[i].push(arguments)};return window[s]&&"function"==typeof window[s]&&(r=window[s]),window[s]=function(e,t,n,i){return async function(s,r,o){try{"event"===s?await async function(e,t,n,i,s){try{let r=[];if(s&&s.send_to){let e=s.send_to;Array.isArray(e)||(e=[e]);const i=await jt(n);for(const n of e){const e=i.find((e=>e.measurementId===n)),s=e&&t[e.appId];if(!s){r=[];break}r.push(s)}}0===r.length&&(r=Object.values(t)),await Promise.all(r),e("event",i,s||{})}catch(e){qt.error(e)}}(e,t,n,r,o):"config"===s?await async function(e,t,n,i,s,r){const o=i[s];try{if(o)await t[o];else{const e=(await jt(n)).find((e=>e.measurementId===s));e&&await t[e.appId]}}catch(e){qt.error(e)}e("config",s,r)}(e,t,n,i,r,o):"consent"===s?e("consent","update",o):e("set",r)}catch(e){qt.error(e)}}}(r,e,t,n),{gtagCore:r,wrappedGtag:window[s]}}(Xt,Zt,en,sn,rn);nn=e,tn=t,on=!0}return Xt[i]=Jt(e,Zt,en,t,tn,sn,n),new Qt(e)}const cn="@firebase/analytics",ln="0.8.0";function hn(e,t){var n={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(n[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var s=0;for(i=Object.getOwnPropertySymbols(e);s<i.length;s++)t.indexOf(i[s])<0&&Object.prototype.propertyIsEnumerable.call(e,i[s])&&(n[i[s]]=e[i[s]])}return n}Ne(new z(At,((e,{options:t})=>an(e.getProvider("app").getImmediate(),e.getProvider("installations-internal").getImmediate(),t)),"PUBLIC")),Ne(new z("analytics-internal",(function(e){try{const t=e.getProvider(At).getImmediate();return{logEvent:(e,n,i)=>function(e,t,n,i){e=V(e),async function(e,t,n,i,s){if(s&&s.global)e("event",n,i);else{const s=await t;e("event",n,Object.assign(Object.assign({},i),{send_to:s}))}}(nn,Xt[e.app.options.appId],t,n,i).catch((e=>qt.error(e)))}(t,e,n,i)}}catch(e){throw Wt.create("interop-component-reg-failed",{reason:e})}}),"PRIVATE")),xe(cn,ln),xe(cn,ln,"esm2017"),Object.create,Object.create;const un=function(){return{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}},dn=new y("auth","Firebase",{"dependent-sdk-initialized-before-auth":"Another Firebase SDK was initialized and is trying to use Auth before Auth is initialized. Please be sure to call `initializeAuth` or `getAuth` before starting any other Firebase SDK."}),pn=new ee("@firebase/auth");function fn(e,...t){pn.logLevel<=Y.ERROR&&pn.error(`Auth (${De}): ${e}`,...t)}function _n(e,...t){throw gn(e,...t)}function mn(e,...t){return gn(e,...t)}function gn(e,...t){if("string"!=typeof e){const n=t[0],i=[...t.slice(1)];return i[0]&&(i[0].appName=e.name),e._errorFactory.create(n,...i)}return dn.create(e,...t)}function vn(e,t,...n){if(!e)throw gn(t,...n)}function yn(e){const t="INTERNAL ASSERTION FAILED: "+e;throw fn(t),new Error(t)}function wn(e,t){e||yn(t)}const In=new Map;function bn(e){wn(e instanceof Function,"Expected a class definition");let t=In.get(e);return t?(wn(t instanceof e,"Instance stored in cache mismatched with class"),t):(t=new e,In.set(e,t),t)}function Cn(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.href)||""}function Tn(){var e;return"undefined"!=typeof self&&(null===(e=self.location)||void 0===e?void 0:e.protocol)||null}class kn{constructor(e,t){this.shortDelay=e,this.longDelay=t,wn(t>e,"Short delay should be less than long delay!"),this.isMobile=d()||f()}get(){return"undefined"!=typeof navigator&&navigator&&"onLine"in navigator&&"boolean"==typeof navigator.onLine&&("http:"===Tn()||"https:"===Tn()||p()||"connection"in navigator)&&!navigator.onLine?Math.min(5e3,this.shortDelay):this.isMobile?this.longDelay:this.shortDelay}}function En(e,t){wn(e.emulator,"Emulator should always be set here");const{url:n}=e.emulator;return t?`${n}${t.startsWith("/")?t.slice(1):t}`:n}class Sn{static initialize(e,t,n){this.fetchImpl=e,t&&(this.headersImpl=t),n&&(this.responseImpl=n)}static fetch(){return this.fetchImpl?this.fetchImpl:"undefined"!=typeof self&&"fetch"in self?self.fetch:void yn("Could not find fetch implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static headers(){return this.headersImpl?this.headersImpl:"undefined"!=typeof self&&"Headers"in self?self.Headers:void yn("Could not find Headers implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}static response(){return this.responseImpl?this.responseImpl:"undefined"!=typeof self&&"Response"in self?self.Response:void yn("Could not find Response implementation, make sure you call FetchProvider.initialize() with an appropriate polyfill")}}const Nn={CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_PASSWORD:"wrong-password",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_REQ_TYPE:"internal-error",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",INVALID_CODE:"invalid-verification-code",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_SESSION_INFO:"missing-verification-id",SESSION_EXPIRED:"code-expired",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation",INVALID_MFA_PENDING_CREDENTIAL:"invalid-multi-factor-session",MFA_ENROLLMENT_NOT_FOUND:"multi-factor-info-not-found",MISSING_MFA_ENROLLMENT_ID:"missing-multi-factor-info",MISSING_MFA_PENDING_CREDENTIAL:"missing-multi-factor-session",SECOND_FACTOR_EXISTS:"second-factor-already-in-use",SECOND_FACTOR_LIMIT_EXCEEDED:"maximum-second-factor-count-exceeded",BLOCKING_FUNCTION_ERROR_RESPONSE:"internal-error"},Pn=new kn(3e4,6e4);function Rn(e,t){return e.tenantId&&!t.tenantId?Object.assign(Object.assign({},t),{tenantId:e.tenantId}):t}async function On(e,t,n,i,s={}){return Dn(e,s,(async()=>{let s={},r={};i&&("GET"===t?r=i:s={body:JSON.stringify(i)});const o=R(Object.assign({key:e.config.apiKey},r)).slice(1),a=await e._getAdditionalHeaders();return a["Content-Type"]="application/json",e.languageCode&&(a["X-Firebase-Locale"]=e.languageCode),Sn.fetch()(xn(e,e.config.apiHost,n,o),Object.assign({method:t,headers:a,referrerPolicy:"no-referrer"},s))}))}async function Dn(e,t,n){e._canInitEmulator=!1;const i=Object.assign(Object.assign({},Nn),t);try{const t=new Mn(e),s=await Promise.race([n(),t.promise]);t.clearNetworkTimeout();const r=await s.json();if("needConfirmation"in r)throw Ln(e,"account-exists-with-different-credential",r);if(s.ok&&!("errorMessage"in r))return r;{const t=s.ok?r.errorMessage:r.error.message,[n,o]=t.split(" : ");if("FEDERATED_USER_ID_ALREADY_LINKED"===n)throw Ln(e,"credential-already-in-use",r);if("EMAIL_EXISTS"===n)throw Ln(e,"email-already-in-use",r);if("USER_DISABLED"===n)throw Ln(e,"user-disabled",r);const a=i[n]||n.toLowerCase().replace(/[_\s]+/g,"-");if(o)throw function(e,t,n){const i=Object.assign(Object.assign({},un()),{[t]:n});return new y("auth","Firebase",i).create(t,{appName:e.name})}(e,a,o);_n(e,a)}}catch(t){if(t instanceof v)throw t;_n(e,"network-request-failed")}}async function An(e,t,n,i,s={}){const r=await On(e,t,n,i,s);return"mfaPendingCredential"in r&&_n(e,"multi-factor-auth-required",{_serverResponse:r}),r}function xn(e,t,n,i){const s=`${t}${n}?${i}`;return e.config.emulator?En(e.config,s):`${e.config.apiScheme}://${s}`}class Mn{constructor(e){this.auth=e,this.timer=null,this.promise=new Promise(((e,t)=>{this.timer=setTimeout((()=>t(mn(this.auth,"network-request-failed"))),Pn.get())}))}clearNetworkTimeout(){clearTimeout(this.timer)}}function Ln(e,t,n){const i={appName:e.name};n.email&&(i.email=n.email),n.phoneNumber&&(i.phoneNumber=n.phoneNumber);const s=mn(e,t,i);return s.customData._tokenResponse=n,s}function Fn(e){if(e)try{const t=new Date(Number(e));if(!isNaN(t.getTime()))return t.toUTCString()}catch(e){}}function Un(e){return 1e3*Number(e)}function qn(e){var t;const[n,i,s]=e.split(".");if(void 0===n||void 0===i||void 0===s)return fn("JWT malformed, contained fewer than 3 sections"),null;try{const e=a(i);return e?JSON.parse(e):(fn("Failed to decode base64 JWT payload"),null)}catch(e){return fn("Caught error parsing JWT payload as JSON",null===(t=e)||void 0===t?void 0:t.toString()),null}}async function jn(e,t,n=!1){if(n)return t;try{return await t}catch(t){throw t instanceof v&&function({code:e}){return"auth/user-disabled"===e||"auth/user-token-expired"===e}(t)&&e.auth.currentUser===e&&await e.auth.signOut(),t}}class Wn{constructor(e){this.user=e,this.isRunning=!1,this.timerId=null,this.errorBackoff=3e4}_start(){this.isRunning||(this.isRunning=!0,this.schedule())}_stop(){this.isRunning&&(this.isRunning=!1,null!==this.timerId&&clearTimeout(this.timerId))}getInterval(e){var t;if(e){const e=this.errorBackoff;return this.errorBackoff=Math.min(2*this.errorBackoff,96e4),e}{this.errorBackoff=3e4;const e=(null!==(t=this.user.stsTokenManager.expirationTime)&&void 0!==t?t:0)-Date.now()-3e5;return Math.max(0,e)}}schedule(e=!1){if(!this.isRunning)return;const t=this.getInterval(e);this.timerId=setTimeout((async()=>{await this.iteration()}),t)}async iteration(){var e;try{await this.user.getIdToken(!0)}catch(t){return void("auth/network-request-failed"===(null===(e=t)||void 0===e?void 0:e.code)&&this.schedule(!0))}this.schedule()}}class Hn{constructor(e,t){this.createdAt=e,this.lastLoginAt=t,this._initializeTime()}_initializeTime(){this.lastSignInTime=Fn(this.lastLoginAt),this.creationTime=Fn(this.createdAt)}_copy(e){this.createdAt=e.createdAt,this.lastLoginAt=e.lastLoginAt,this._initializeTime()}toJSON(){return{createdAt:this.createdAt,lastLoginAt:this.lastLoginAt}}}async function Vn(e){var t;const n=e.auth,i=await e.getIdToken(),s=await jn(e,async function(e,t){return On(e,"POST","/v1/accounts:lookup",t)}(n,{idToken:i}));vn(null==s?void 0:s.users.length,n,"internal-error");const r=s.users[0];e._notifyReloadListener(r);const o=(null===(t=r.providerUserInfo)||void 0===t?void 0:t.length)?r.providerUserInfo.map((e=>{var{providerId:t}=e,n=hn(e,["providerId"]);return{providerId:t,uid:n.rawId||"",displayName:n.displayName||null,email:n.email||null,phoneNumber:n.phoneNumber||null,photoURL:n.photoUrl||null}})):[],a=(c=e.providerData,l=o,[...c.filter((e=>!l.some((t=>t.providerId===e.providerId)))),...l]);var c,l;const h=e.isAnonymous,u=!(e.email&&r.passwordHash||(null==a?void 0:a.length)),d=!!h&&u,p={uid:r.localId,displayName:r.displayName||null,photoURL:r.photoUrl||null,email:r.email||null,emailVerified:r.emailVerified||!1,phoneNumber:r.phoneNumber||null,tenantId:r.tenantId||null,providerData:a,metadata:new Hn(r.createdAt,r.lastLoginAt),isAnonymous:d};Object.assign(e,p)}class zn{constructor(){this.refreshToken=null,this.accessToken=null,this.expirationTime=null}get isExpired(){return!this.expirationTime||Date.now()>this.expirationTime-3e4}updateFromServerResponse(e){vn(e.idToken,"internal-error"),vn(void 0!==e.idToken,"internal-error"),vn(void 0!==e.refreshToken,"internal-error");const t="expiresIn"in e&&void 0!==e.expiresIn?Number(e.expiresIn):function(e){const t=qn(e);return vn(t,"internal-error"),vn(void 0!==t.exp,"internal-error"),vn(void 0!==t.iat,"internal-error"),Number(t.exp)-Number(t.iat)}(e.idToken);this.updateTokensAndExpiration(e.idToken,e.refreshToken,t)}async getToken(e,t=!1){return vn(!this.accessToken||this.refreshToken,e,"user-token-expired"),t||!this.accessToken||this.isExpired?this.refreshToken?(await this.refresh(e,this.refreshToken),this.accessToken):null:this.accessToken}clearRefreshToken(){this.refreshToken=null}async refresh(e,t){const{accessToken:n,refreshToken:i,expiresIn:s}=await async function(e,t){const n=await Dn(e,{},(async()=>{const n=R({grant_type:"refresh_token",refresh_token:t}).slice(1),{tokenApiHost:i,apiKey:s}=e.config,r=xn(e,i,"/v1/token",`key=${s}`),o=await e._getAdditionalHeaders();return o["Content-Type"]="application/x-www-form-urlencoded",Sn.fetch()(r,{method:"POST",headers:o,body:n})}));return{accessToken:n.access_token,expiresIn:n.expires_in,refreshToken:n.refresh_token}}(e,t);this.updateTokensAndExpiration(n,i,Number(s))}updateTokensAndExpiration(e,t,n){this.refreshToken=t||null,this.accessToken=e||null,this.expirationTime=Date.now()+1e3*n}static fromJSON(e,t){const{refreshToken:n,accessToken:i,expirationTime:s}=t,r=new zn;return n&&(vn("string"==typeof n,"internal-error",{appName:e}),r.refreshToken=n),i&&(vn("string"==typeof i,"internal-error",{appName:e}),r.accessToken=i),s&&(vn("number"==typeof s,"internal-error",{appName:e}),r.expirationTime=s),r}toJSON(){return{refreshToken:this.refreshToken,accessToken:this.accessToken,expirationTime:this.expirationTime}}_assign(e){this.accessToken=e.accessToken,this.refreshToken=e.refreshToken,this.expirationTime=e.expirationTime}_clone(){return Object.assign(new zn,this.toJSON())}_performRefresh(){return yn("not implemented")}}function Bn(e,t){vn("string"==typeof e||void 0===e,"internal-error",{appName:t})}class $n{constructor(e){var{uid:t,auth:n,stsTokenManager:i}=e,s=hn(e,["uid","auth","stsTokenManager"]);this.providerId="firebase",this.proactiveRefresh=new Wn(this),this.reloadUserInfo=null,this.reloadListener=null,this.uid=t,this.auth=n,this.stsTokenManager=i,this.accessToken=i.accessToken,this.displayName=s.displayName||null,this.email=s.email||null,this.emailVerified=s.emailVerified||!1,this.phoneNumber=s.phoneNumber||null,this.photoURL=s.photoURL||null,this.isAnonymous=s.isAnonymous||!1,this.tenantId=s.tenantId||null,this.providerData=s.providerData?[...s.providerData]:[],this.metadata=new Hn(s.createdAt||void 0,s.lastLoginAt||void 0)}async getIdToken(e){const t=await jn(this,this.stsTokenManager.getToken(this.auth,e));return vn(t,this.auth,"internal-error"),this.accessToken!==t&&(this.accessToken=t,await this.auth._persistUserIfCurrent(this),this.auth._notifyListenersIfCurrent(this)),t}getIdTokenResult(e){return async function(e,t=!1){const n=V(e),i=await n.getIdToken(t),s=qn(i);vn(s&&s.exp&&s.auth_time&&s.iat,n.auth,"internal-error");const r="object"==typeof s.firebase?s.firebase:void 0,o=null==r?void 0:r.sign_in_provider;return{claims:s,token:i,authTime:Fn(Un(s.auth_time)),issuedAtTime:Fn(Un(s.iat)),expirationTime:Fn(Un(s.exp)),signInProvider:o||null,signInSecondFactor:(null==r?void 0:r.sign_in_second_factor)||null}}(this,e)}reload(){return async function(e){const t=V(e);await Vn(t),await t.auth._persistUserIfCurrent(t),t.auth._notifyListenersIfCurrent(t)}(this)}_assign(e){this!==e&&(vn(this.uid===e.uid,this.auth,"internal-error"),this.displayName=e.displayName,this.photoURL=e.photoURL,this.email=e.email,this.emailVerified=e.emailVerified,this.phoneNumber=e.phoneNumber,this.isAnonymous=e.isAnonymous,this.tenantId=e.tenantId,this.providerData=e.providerData.map((e=>Object.assign({},e))),this.metadata._copy(e.metadata),this.stsTokenManager._assign(e.stsTokenManager))}_clone(e){return new $n(Object.assign(Object.assign({},this),{auth:e,stsTokenManager:this.stsTokenManager._clone()}))}_onReload(e){vn(!this.reloadListener,this.auth,"internal-error"),this.reloadListener=e,this.reloadUserInfo&&(this._notifyReloadListener(this.reloadUserInfo),this.reloadUserInfo=null)}_notifyReloadListener(e){this.reloadListener?this.reloadListener(e):this.reloadUserInfo=e}_startProactiveRefresh(){this.proactiveRefresh._start()}_stopProactiveRefresh(){this.proactiveRefresh._stop()}async _updateTokensIfNecessary(e,t=!1){let n=!1;e.idToken&&e.idToken!==this.stsTokenManager.accessToken&&(this.stsTokenManager.updateFromServerResponse(e),n=!0),t&&await Vn(this),await this.auth._persistUserIfCurrent(this),n&&this.auth._notifyListenersIfCurrent(this)}async delete(){const e=await this.getIdToken();return await jn(this,async function(e,t){return On(e,"POST","/v1/accounts:delete",t)}(this.auth,{idToken:e})),this.stsTokenManager.clearRefreshToken(),this.auth.signOut()}toJSON(){return Object.assign(Object.assign({uid:this.uid,email:this.email||void 0,emailVerified:this.emailVerified,displayName:this.displayName||void 0,isAnonymous:this.isAnonymous,photoURL:this.photoURL||void 0,phoneNumber:this.phoneNumber||void 0,tenantId:this.tenantId||void 0,providerData:this.providerData.map((e=>Object.assign({},e))),stsTokenManager:this.stsTokenManager.toJSON(),_redirectEventId:this._redirectEventId},this.metadata.toJSON()),{apiKey:this.auth.config.apiKey,appName:this.auth.name})}get refreshToken(){return this.stsTokenManager.refreshToken||""}static _fromJSON(e,t){var n,i,s,r,o,a,c,l;const h=null!==(n=t.displayName)&&void 0!==n?n:void 0,u=null!==(i=t.email)&&void 0!==i?i:void 0,d=null!==(s=t.phoneNumber)&&void 0!==s?s:void 0,p=null!==(r=t.photoURL)&&void 0!==r?r:void 0,f=null!==(o=t.tenantId)&&void 0!==o?o:void 0,_=null!==(a=t._redirectEventId)&&void 0!==a?a:void 0,m=null!==(c=t.createdAt)&&void 0!==c?c:void 0,g=null!==(l=t.lastLoginAt)&&void 0!==l?l:void 0,{uid:v,emailVerified:y,isAnonymous:w,providerData:I,stsTokenManager:b}=t;vn(v&&b,e,"internal-error");const C=zn.fromJSON(this.name,b);vn("string"==typeof v,e,"internal-error"),Bn(h,e.name),Bn(u,e.name),vn("boolean"==typeof y,e,"internal-error"),vn("boolean"==typeof w,e,"internal-error"),Bn(d,e.name),Bn(p,e.name),Bn(f,e.name),Bn(_,e.name),Bn(m,e.name),Bn(g,e.name);const T=new $n({uid:v,auth:e,email:u,emailVerified:y,displayName:h,isAnonymous:w,photoURL:p,phoneNumber:d,tenantId:f,stsTokenManager:C,createdAt:m,lastLoginAt:g});return I&&Array.isArray(I)&&(T.providerData=I.map((e=>Object.assign({},e)))),_&&(T._redirectEventId=_),T}static async _fromIdTokenResponse(e,t,n=!1){const i=new zn;i.updateFromServerResponse(t);const s=new $n({uid:t.localId,auth:e,stsTokenManager:i,isAnonymous:n});return await Vn(s),s}}class Kn{constructor(){this.type="NONE",this.storage={}}async _isAvailable(){return!0}async _set(e,t){this.storage[e]=t}async _get(e){const t=this.storage[e];return void 0===t?null:t}async _remove(e){delete this.storage[e]}_addListener(e,t){}_removeListener(e,t){}}Kn.type="NONE";const Gn=Kn;function Yn(e,t,n){return`firebase:${e}:${t}:${n}`}class Jn{constructor(e,t,n){this.persistence=e,this.auth=t,this.userKey=n;const{config:i,name:s}=this.auth;this.fullUserKey=Yn(this.userKey,i.apiKey,s),this.fullPersistenceKey=Yn("persistence",i.apiKey,s),this.boundEventHandler=t._onStorageEvent.bind(t),this.persistence._addListener(this.fullUserKey,this.boundEventHandler)}setCurrentUser(e){return this.persistence._set(this.fullUserKey,e.toJSON())}async getCurrentUser(){const e=await this.persistence._get(this.fullUserKey);return e?$n._fromJSON(this.auth,e):null}removeCurrentUser(){return this.persistence._remove(this.fullUserKey)}savePersistenceForRedirect(){return this.persistence._set(this.fullPersistenceKey,this.persistence.type)}async setPersistence(e){if(this.persistence===e)return;const t=await this.getCurrentUser();return await this.removeCurrentUser(),this.persistence=e,t?this.setCurrentUser(t):void 0}delete(){this.persistence._removeListener(this.fullUserKey,this.boundEventHandler)}static async create(e,t,n="authUser"){if(!t.length)return new Jn(bn(Gn),e,n);const i=(await Promise.all(t.map((async e=>{if(await e._isAvailable())return e})))).filter((e=>e));let s=i[0]||bn(Gn);const r=Yn(n,e.config.apiKey,e.name);let o=null;for(const n of t)try{const t=await n._get(r);if(t){const i=$n._fromJSON(e,t);n!==s&&(o=i),s=n;break}}catch(e){}const a=i.filter((e=>e._shouldAllowMigration));return s._shouldAllowMigration&&a.length?(s=a[0],o&&await s._set(r,o.toJSON()),await Promise.all(t.map((async e=>{if(e!==s)try{await e._remove(r)}catch(e){}}))),new Jn(s,e,n)):new Jn(s,e,n)}}function Qn(e){const t=e.toLowerCase();if(t.includes("opera/")||t.includes("opr/")||t.includes("opios/"))return"Opera";if(ti(t))return"IEMobile";if(t.includes("msie")||t.includes("trident/"))return"IE";if(t.includes("edge/"))return"Edge";if(Xn(t))return"Firefox";if(t.includes("silk/"))return"Silk";if(ii(t))return"Blackberry";if(si(t))return"Webos";if(Zn(t))return"Safari";if((t.includes("chrome/")||ei(t))&&!t.includes("edge/"))return"Chrome";if(ni(t))return"Android";{const t=/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/,n=e.match(t);if(2===(null==n?void 0:n.length))return n[1]}return"Other"}function Xn(e=u()){return/firefox\//i.test(e)}function Zn(e=u()){const t=e.toLowerCase();return t.includes("safari/")&&!t.includes("chrome/")&&!t.includes("crios/")&&!t.includes("android")}function ei(e=u()){return/crios\//i.test(e)}function ti(e=u()){return/iemobile/i.test(e)}function ni(e=u()){return/android/i.test(e)}function ii(e=u()){return/blackberry/i.test(e)}function si(e=u()){return/webos/i.test(e)}function ri(e=u()){return/iphone|ipad|ipod/i.test(e)||/macintosh/i.test(e)&&/mobile/i.test(e)}function oi(e=u()){return ri(e)||ni(e)||si(e)||ii(e)||/windows phone/i.test(e)||ti(e)}function ai(e,t=[]){let n;switch(e){case"Browser":n=Qn(u());break;case"Worker":n=`${Qn(u())}-${e}`;break;default:n=e}const i=t.length?t.join(","):"FirebaseCore-web";return`${n}/JsCore/${De}/${i}`}class ci{constructor(e){this.auth=e,this.queue=[]}pushCallback(e,t){const n=t=>new Promise(((n,i)=>{try{n(e(t))}catch(e){i(e)}}));n.onAbort=t,this.queue.push(n);const i=this.queue.length-1;return()=>{this.queue[i]=()=>Promise.resolve()}}async runMiddleware(e){var t;if(this.auth.currentUser===e)return;const n=[];try{for(const t of this.queue)await t(e),t.onAbort&&n.push(t.onAbort)}catch(e){n.reverse();for(const e of n)try{e()}catch(e){}throw this.auth._errorFactory.create("login-blocked",{originalMessage:null===(t=e)||void 0===t?void 0:t.message})}}}class li{constructor(e,t,n){this.app=e,this.heartbeatServiceProvider=t,this.config=n,this.currentUser=null,this.emulatorConfig=null,this.operations=Promise.resolve(),this.authStateSubscription=new ui(this),this.idTokenSubscription=new ui(this),this.beforeStateQueue=new ci(this),this.redirectUser=null,this.isProactiveRefreshEnabled=!1,this._canInitEmulator=!0,this._isInitialized=!1,this._deleted=!1,this._initializationPromise=null,this._popupRedirectResolver=null,this._errorFactory=dn,this.lastNotifiedUid=void 0,this.languageCode=null,this.tenantId=null,this.settings={appVerificationDisabledForTesting:!1},this.frameworks=[],this.name=e.name,this.clientVersion=n.sdkClientVersion}_initializeWithPersistence(e,t){return t&&(this._popupRedirectResolver=bn(t)),this._initializationPromise=this.queue((async()=>{var n,i;if(!this._deleted&&(this.persistenceManager=await Jn.create(this,e),!this._deleted)){if(null===(n=this._popupRedirectResolver)||void 0===n?void 0:n._shouldInitProactively)try{await this._popupRedirectResolver._initialize(this)}catch(e){}await this.initializeCurrentUser(t),this.lastNotifiedUid=(null===(i=this.currentUser)||void 0===i?void 0:i.uid)||null,this._deleted||(this._isInitialized=!0)}})),this._initializationPromise}async _onStorageEvent(){if(this._deleted)return;const e=await this.assertedPersistence.getCurrentUser();return this.currentUser||e?this.currentUser&&e&&this.currentUser.uid===e.uid?(this._currentUser._assign(e),void await this.currentUser.getIdToken()):void await this._updateCurrentUser(e,!0):void 0}async initializeCurrentUser(e){var t;const n=await this.assertedPersistence.getCurrentUser();let i=n,s=!1;if(e&&this.config.authDomain){await this.getOrInitRedirectPersistenceManager();const n=null===(t=this.redirectUser)||void 0===t?void 0:t._redirectEventId,r=null==i?void 0:i._redirectEventId,o=await this.tryRedirectSignIn(e);n&&n!==r||!(null==o?void 0:o.user)||(i=o.user,s=!0)}if(!i)return this.directlySetCurrentUser(null);if(!i._redirectEventId){if(s)try{await this.beforeStateQueue.runMiddleware(i)}catch(e){i=n,this._popupRedirectResolver._overrideRedirectResult(this,(()=>Promise.reject(e)))}return i?this.reloadAndSetCurrentUserOrClear(i):this.directlySetCurrentUser(null)}return vn(this._popupRedirectResolver,this,"argument-error"),await this.getOrInitRedirectPersistenceManager(),this.redirectUser&&this.redirectUser._redirectEventId===i._redirectEventId?this.directlySetCurrentUser(i):this.reloadAndSetCurrentUserOrClear(i)}async tryRedirectSignIn(e){let t=null;try{t=await this._popupRedirectResolver._completeRedirectFn(this,e,!0)}catch(e){await this._setRedirectUser(null)}return t}async reloadAndSetCurrentUserOrClear(e){var t;try{await Vn(e)}catch(e){if("auth/network-request-failed"!==(null===(t=e)||void 0===t?void 0:t.code))return this.directlySetCurrentUser(null)}return this.directlySetCurrentUser(e)}useDeviceLanguage(){this.languageCode=function(){if("undefined"==typeof navigator)return null;const e=navigator;return e.languages&&e.languages[0]||e.language||null}()}async _delete(){this._deleted=!0}async updateCurrentUser(e){const t=e?V(e):null;return t&&vn(t.auth.config.apiKey===this.config.apiKey,this,"invalid-user-token"),this._updateCurrentUser(t&&t._clone(this))}async _updateCurrentUser(e,t=!1){if(!this._deleted)return e&&vn(this.tenantId===e.tenantId,this,"tenant-id-mismatch"),t||await this.beforeStateQueue.runMiddleware(e),this.queue((async()=>{await this.directlySetCurrentUser(e),this.notifyAuthListeners()}))}async signOut(){return await this.beforeStateQueue.runMiddleware(null),(this.redirectPersistenceManager||this._popupRedirectResolver)&&await this._setRedirectUser(null),this._updateCurrentUser(null,!0)}setPersistence(e){return this.queue((async()=>{await this.assertedPersistence.setPersistence(bn(e))}))}_getPersistence(){return this.assertedPersistence.persistence.type}_updateErrorMap(e){this._errorFactory=new y("auth","Firebase",e())}onAuthStateChanged(e,t,n){return this.registerStateListener(this.authStateSubscription,e,t,n)}beforeAuthStateChanged(e,t){return this.beforeStateQueue.pushCallback(e,t)}onIdTokenChanged(e,t,n){return this.registerStateListener(this.idTokenSubscription,e,t,n)}toJSON(){var e;return{apiKey:this.config.apiKey,authDomain:this.config.authDomain,appName:this.name,currentUser:null===(e=this._currentUser)||void 0===e?void 0:e.toJSON()}}async _setRedirectUser(e,t){const n=await this.getOrInitRedirectPersistenceManager(t);return null===e?n.removeCurrentUser():n.setCurrentUser(e)}async getOrInitRedirectPersistenceManager(e){if(!this.redirectPersistenceManager){const t=e&&bn(e)||this._popupRedirectResolver;vn(t,this,"argument-error"),this.redirectPersistenceManager=await Jn.create(this,[bn(t._redirectPersistence)],"redirectUser"),this.redirectUser=await this.redirectPersistenceManager.getCurrentUser()}return this.redirectPersistenceManager}async _redirectUserForId(e){var t,n;return this._isInitialized&&await this.queue((async()=>{})),(null===(t=this._currentUser)||void 0===t?void 0:t._redirectEventId)===e?this._currentUser:(null===(n=this.redirectUser)||void 0===n?void 0:n._redirectEventId)===e?this.redirectUser:null}async _persistUserIfCurrent(e){if(e===this.currentUser)return this.queue((async()=>this.directlySetCurrentUser(e)))}_notifyListenersIfCurrent(e){e===this.currentUser&&this.notifyAuthListeners()}_key(){return`${this.config.authDomain}:${this.config.apiKey}:${this.name}`}_startProactiveRefresh(){this.isProactiveRefreshEnabled=!0,this.currentUser&&this._currentUser._startProactiveRefresh()}_stopProactiveRefresh(){this.isProactiveRefreshEnabled=!1,this.currentUser&&this._currentUser._stopProactiveRefresh()}get _currentUser(){return this.currentUser}notifyAuthListeners(){var e,t;if(!this._isInitialized)return;this.idTokenSubscription.next(this.currentUser);const n=null!==(t=null===(e=this.currentUser)||void 0===e?void 0:e.uid)&&void 0!==t?t:null;this.lastNotifiedUid!==n&&(this.lastNotifiedUid=n,this.authStateSubscription.next(this.currentUser))}registerStateListener(e,t,n,i){if(this._deleted)return()=>{};const s="function"==typeof t?t:t.next.bind(t),r=this._isInitialized?Promise.resolve():this._initializationPromise;return vn(r,this,"internal-error"),r.then((()=>s(this.currentUser))),"function"==typeof t?e.addObserver(t,n,i):e.addObserver(t)}async directlySetCurrentUser(e){this.currentUser&&this.currentUser!==e&&(this._currentUser._stopProactiveRefresh(),e&&this.isProactiveRefreshEnabled&&e._startProactiveRefresh()),this.currentUser=e,e?await this.assertedPersistence.setCurrentUser(e):await this.assertedPersistence.removeCurrentUser()}queue(e){return this.operations=this.operations.then(e,e),this.operations}get assertedPersistence(){return vn(this.persistenceManager,this,"internal-error"),this.persistenceManager}_logFramework(e){e&&!this.frameworks.includes(e)&&(this.frameworks.push(e),this.frameworks.sort(),this.clientVersion=ai(this.config.clientPlatform,this._getFrameworks()))}_getFrameworks(){return this.frameworks}async _getAdditionalHeaders(){var e;const t={"X-Client-Version":this.clientVersion};this.app.options.appId&&(t["X-Firebase-gmpid"]=this.app.options.appId);const n=await(null===(e=this.heartbeatServiceProvider.getImmediate({optional:!0}))||void 0===e?void 0:e.getHeartbeatsHeader());return n&&(t["X-Firebase-Client"]=n),t}}function hi(e){return V(e)}class ui{constructor(e){this.auth=e,this.observer=null,this.addObserver=function(e,t){const n=new x(e,void 0);return n.subscribe.bind(n)}((e=>this.observer=e))}get next(){return vn(this.observer,this.auth,"internal-error"),this.observer.next.bind(this.observer)}}class di{constructor(e,t){this.providerId=e,this.signInMethod=t}toJSON(){return yn("not implemented")}_getIdTokenResponse(e){return yn("not implemented")}_linkToIdToken(e,t){return yn("not implemented")}_getReauthenticationResolver(e){return yn("not implemented")}}class pi extends di{constructor(e,t,n,i=null){super("password",n),this._email=e,this._password=t,this._tenantId=i}static _fromEmailAndPassword(e,t){return new pi(e,t,"password")}static _fromEmailAndCode(e,t,n=null){return new pi(e,t,"emailLink",n)}toJSON(){return{email:this._email,password:this._password,signInMethod:this.signInMethod,tenantId:this._tenantId}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e;if((null==t?void 0:t.email)&&(null==t?void 0:t.password)){if("password"===t.signInMethod)return this._fromEmailAndPassword(t.email,t.password);if("emailLink"===t.signInMethod)return this._fromEmailAndCode(t.email,t.password,t.tenantId)}return null}async _getIdTokenResponse(e){switch(this.signInMethod){case"password":return async function(e,t){return An(e,"POST","/v1/accounts:signInWithPassword",Rn(e,t))}(e,{returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return An(e,"POST","/v1/accounts:signInWithEmailLink",Rn(e,t))}(e,{email:this._email,oobCode:this._password});default:_n(e,"internal-error")}}async _linkToIdToken(e,t){switch(this.signInMethod){case"password":return async function(e,t){return On(e,"POST","/v1/accounts:update",t)}(e,{idToken:t,returnSecureToken:!0,email:this._email,password:this._password});case"emailLink":return async function(e,t){return An(e,"POST","/v1/accounts:signInWithEmailLink",Rn(e,t))}(e,{idToken:t,email:this._email,oobCode:this._password});default:_n(e,"internal-error")}}_getReauthenticationResolver(e){return this._getIdTokenResponse(e)}}async function fi(e,t){return An(e,"POST","/v1/accounts:signInWithIdp",Rn(e,t))}class _i extends di{constructor(){super(...arguments),this.pendingToken=null}static _fromParams(e){const t=new _i(e.providerId,e.signInMethod);return e.idToken||e.accessToken?(e.idToken&&(t.idToken=e.idToken),e.accessToken&&(t.accessToken=e.accessToken),e.nonce&&!e.pendingToken&&(t.nonce=e.nonce),e.pendingToken&&(t.pendingToken=e.pendingToken)):e.oauthToken&&e.oauthTokenSecret?(t.accessToken=e.oauthToken,t.secret=e.oauthTokenSecret):_n("argument-error"),t}toJSON(){return{idToken:this.idToken,accessToken:this.accessToken,secret:this.secret,nonce:this.nonce,pendingToken:this.pendingToken,providerId:this.providerId,signInMethod:this.signInMethod}}static fromJSON(e){const t="string"==typeof e?JSON.parse(e):e,{providerId:n,signInMethod:i}=t,s=hn(t,["providerId","signInMethod"]);if(!n||!i)return null;const r=new _i(n,i);return r.idToken=s.idToken||void 0,r.accessToken=s.accessToken||void 0,r.secret=s.secret,r.nonce=s.nonce,r.pendingToken=s.pendingToken||null,r}_getIdTokenResponse(e){return fi(e,this.buildRequest())}_linkToIdToken(e,t){const n=this.buildRequest();return n.idToken=t,fi(e,n)}_getReauthenticationResolver(e){const t=this.buildRequest();return t.autoCreate=!1,fi(e,t)}buildRequest(){const e={requestUri:"http://localhost",returnSecureToken:!0};if(this.pendingToken)e.pendingToken=this.pendingToken;else{const t={};this.idToken&&(t.id_token=this.idToken),this.accessToken&&(t.access_token=this.accessToken),this.secret&&(t.oauth_token_secret=this.secret),t.providerId=this.providerId,this.nonce&&!this.pendingToken&&(t.nonce=this.nonce),e.postBody=R(t)}return e}}const mi={USER_NOT_FOUND:"user-not-found"};class gi extends di{constructor(e){super("phone","phone"),this.params=e}static _fromVerification(e,t){return new gi({verificationId:e,verificationCode:t})}static _fromTokenResponse(e,t){return new gi({phoneNumber:e,temporaryProof:t})}_getIdTokenResponse(e){return async function(e,t){return An(e,"POST","/v1/accounts:signInWithPhoneNumber",Rn(e,t))}(e,this._makeVerificationRequest())}_linkToIdToken(e,t){return async function(e,t){const n=await An(e,"POST","/v1/accounts:signInWithPhoneNumber",Rn(e,t));if(n.temporaryProof)throw Ln(e,"account-exists-with-different-credential",n);return n}(e,Object.assign({idToken:t},this._makeVerificationRequest()))}_getReauthenticationResolver(e){return async function(e,t){return An(e,"POST","/v1/accounts:signInWithPhoneNumber",Rn(e,Object.assign(Object.assign({},t),{operation:"REAUTH"})),mi)}(e,this._makeVerificationRequest())}_makeVerificationRequest(){const{temporaryProof:e,phoneNumber:t,verificationId:n,verificationCode:i}=this.params;return e&&t?{temporaryProof:e,phoneNumber:t}:{sessionInfo:n,code:i}}toJSON(){const e={providerId:this.providerId};return this.params.phoneNumber&&(e.phoneNumber=this.params.phoneNumber),this.params.temporaryProof&&(e.temporaryProof=this.params.temporaryProof),this.params.verificationCode&&(e.verificationCode=this.params.verificationCode),this.params.verificationId&&(e.verificationId=this.params.verificationId),e}static fromJSON(e){"string"==typeof e&&(e=JSON.parse(e));const{verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}=e;return n||t||i||s?new gi({verificationId:t,verificationCode:n,phoneNumber:i,temporaryProof:s}):null}}class vi{constructor(e){var t,n,i,s,r,o;const a=O(D(e)),c=null!==(t=a.apiKey)&&void 0!==t?t:null,l=null!==(n=a.oobCode)&&void 0!==n?n:null,h=function(e){switch(e){case"recoverEmail":return"RECOVER_EMAIL";case"resetPassword":return"PASSWORD_RESET";case"signIn":return"EMAIL_SIGNIN";case"verifyEmail":return"VERIFY_EMAIL";case"verifyAndChangeEmail":return"VERIFY_AND_CHANGE_EMAIL";case"revertSecondFactorAddition":return"REVERT_SECOND_FACTOR_ADDITION";default:return null}}(null!==(i=a.mode)&&void 0!==i?i:null);vn(c&&l&&h,"argument-error"),this.apiKey=c,this.operation=h,this.code=l,this.continueUrl=null!==(s=a.continueUrl)&&void 0!==s?s:null,this.languageCode=null!==(r=a.languageCode)&&void 0!==r?r:null,this.tenantId=null!==(o=a.tenantId)&&void 0!==o?o:null}static parseLink(e){const t=function(e){const t=O(D(e)).link,n=t?O(D(t)).deep_link_id:null,i=O(D(e)).deep_link_id;return(i?O(D(i)).link:null)||i||n||t||e}(e);try{return new vi(t)}catch(e){return null}}}class yi{constructor(){this.providerId=yi.PROVIDER_ID}static credential(e,t){return pi._fromEmailAndPassword(e,t)}static credentialWithLink(e,t){const n=vi.parseLink(t);return vn(n,"argument-error"),pi._fromEmailAndCode(e,n.code,n.tenantId)}}yi.PROVIDER_ID="password",yi.EMAIL_PASSWORD_SIGN_IN_METHOD="password",yi.EMAIL_LINK_SIGN_IN_METHOD="emailLink";class wi{constructor(e){this.providerId=e,this.defaultLanguageCode=null,this.customParameters={}}setDefaultLanguage(e){this.defaultLanguageCode=e}setCustomParameters(e){return this.customParameters=e,this}getCustomParameters(){return this.customParameters}}class Ii extends wi{constructor(){super(...arguments),this.scopes=[]}addScope(e){return this.scopes.includes(e)||this.scopes.push(e),this}getScopes(){return[...this.scopes]}}class bi extends Ii{constructor(){super("facebook.com")}static credential(e){return _i._fromParams({providerId:bi.PROVIDER_ID,signInMethod:bi.FACEBOOK_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return bi.credentialFromTaggedObject(e)}static credentialFromError(e){return bi.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return bi.credential(e.oauthAccessToken)}catch(e){return null}}}bi.FACEBOOK_SIGN_IN_METHOD="facebook.com",bi.PROVIDER_ID="facebook.com";class Ci extends Ii{constructor(){super("google.com"),this.addScope("profile")}static credential(e,t){return _i._fromParams({providerId:Ci.PROVIDER_ID,signInMethod:Ci.GOOGLE_SIGN_IN_METHOD,idToken:e,accessToken:t})}static credentialFromResult(e){return Ci.credentialFromTaggedObject(e)}static credentialFromError(e){return Ci.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthIdToken:t,oauthAccessToken:n}=e;if(!t&&!n)return null;try{return Ci.credential(t,n)}catch(e){return null}}}Ci.GOOGLE_SIGN_IN_METHOD="google.com",Ci.PROVIDER_ID="google.com";class Ti extends Ii{constructor(){super("github.com")}static credential(e){return _i._fromParams({providerId:Ti.PROVIDER_ID,signInMethod:Ti.GITHUB_SIGN_IN_METHOD,accessToken:e})}static credentialFromResult(e){return Ti.credentialFromTaggedObject(e)}static credentialFromError(e){return Ti.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e||!("oauthAccessToken"in e))return null;if(!e.oauthAccessToken)return null;try{return Ti.credential(e.oauthAccessToken)}catch(e){return null}}}Ti.GITHUB_SIGN_IN_METHOD="github.com",Ti.PROVIDER_ID="github.com";class ki extends Ii{constructor(){super("twitter.com")}static credential(e,t){return _i._fromParams({providerId:ki.PROVIDER_ID,signInMethod:ki.TWITTER_SIGN_IN_METHOD,oauthToken:e,oauthTokenSecret:t})}static credentialFromResult(e){return ki.credentialFromTaggedObject(e)}static credentialFromError(e){return ki.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{oauthAccessToken:t,oauthTokenSecret:n}=e;if(!t||!n)return null;try{return ki.credential(t,n)}catch(e){return null}}}ki.TWITTER_SIGN_IN_METHOD="twitter.com",ki.PROVIDER_ID="twitter.com";class Ei{constructor(e){this.user=e.user,this.providerId=e.providerId,this._tokenResponse=e._tokenResponse,this.operationType=e.operationType}static async _fromIdTokenResponse(e,t,n,i=!1){const s=await $n._fromIdTokenResponse(e,n,i),r=Si(n);return new Ei({user:s,providerId:r,_tokenResponse:n,operationType:t})}static async _forOperation(e,t,n){await e._updateTokensIfNecessary(n,!0);const i=Si(n);return new Ei({user:e,providerId:i,_tokenResponse:n,operationType:t})}}function Si(e){return e.providerId?e.providerId:"phoneNumber"in e?"phone":null}class Ni extends v{constructor(e,t,n,i){var s;super(t.code,t.message),this.operationType=n,this.user=i,Object.setPrototypeOf(this,Ni.prototype),this.customData={appName:e.name,tenantId:null!==(s=e.tenantId)&&void 0!==s?s:void 0,_serverResponse:t.customData._serverResponse,operationType:n}}static _fromErrorAndOperation(e,t,n,i){return new Ni(e,t,n,i)}}function Pi(e,t,n,i){return("reauthenticate"===t?n._getReauthenticationResolver(e):n._getIdTokenResponse(e)).catch((n=>{if("auth/multi-factor-auth-required"===n.code)throw Ni._fromErrorAndOperation(e,n,t,i);throw n}))}new WeakMap;const Ri="__sak";class Oi{constructor(e,t){this.storageRetriever=e,this.type=t}_isAvailable(){try{return this.storage?(this.storage.setItem(Ri,"1"),this.storage.removeItem(Ri),Promise.resolve(!0)):Promise.resolve(!1)}catch(e){return Promise.resolve(!1)}}_set(e,t){return this.storage.setItem(e,JSON.stringify(t)),Promise.resolve()}_get(e){const t=this.storage.getItem(e);return Promise.resolve(t?JSON.parse(t):null)}_remove(e){return this.storage.removeItem(e),Promise.resolve()}get storage(){return this.storageRetriever()}}class Di extends Oi{constructor(){super((()=>window.localStorage),"LOCAL"),this.boundEventHandler=(e,t)=>this.onStorageEvent(e,t),this.listeners={},this.localCache={},this.pollTimer=null,this.safariLocalStorageNotSynced=function(){const e=u();return Zn(e)||ri(e)}()&&function(){try{return!(!window||window===window.top)}catch(e){return!1}}(),this.fallbackToPolling=oi(),this._shouldAllowMigration=!0}forAllChangedKeys(e){for(const t of Object.keys(this.listeners)){const n=this.storage.getItem(t),i=this.localCache[t];n!==i&&e(t,i,n)}}onStorageEvent(e,t=!1){if(!e.key)return void this.forAllChangedKeys(((e,t,n)=>{this.notifyListeners(e,n)}));const n=e.key;if(t?this.detachListener():this.stopPolling(),this.safariLocalStorageNotSynced){const i=this.storage.getItem(n);if(e.newValue!==i)null!==e.newValue?this.storage.setItem(n,e.newValue):this.storage.removeItem(n);else if(this.localCache[n]===e.newValue&&!t)return}const i=()=>{const e=this.storage.getItem(n);(t||this.localCache[n]!==e)&&this.notifyListeners(n,e)},s=this.storage.getItem(n);!function(){const e=u();return e.indexOf("MSIE ")>=0||e.indexOf("Trident/")>=0}()||10!==document.documentMode||s===e.newValue||e.newValue===e.oldValue?i():setTimeout(i,10)}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t?JSON.parse(t):t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((()=>{this.forAllChangedKeys(((e,t,n)=>{this.onStorageEvent(new StorageEvent("storage",{key:e,oldValue:t,newValue:n}),!0)}))}),1e3)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}attachListener(){window.addEventListener("storage",this.boundEventHandler)}detachListener(){window.removeEventListener("storage",this.boundEventHandler)}_addListener(e,t){0===Object.keys(this.listeners).length&&(this.fallbackToPolling?this.startPolling():this.attachListener()),this.listeners[e]||(this.listeners[e]=new Set,this.localCache[e]=this.storage.getItem(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&(this.detachListener(),this.stopPolling())}async _set(e,t){await super._set(e,t),this.localCache[e]=JSON.stringify(t)}async _get(e){const t=await super._get(e);return this.localCache[e]=JSON.stringify(t),t}async _remove(e){await super._remove(e),delete this.localCache[e]}}Di.type="LOCAL";const Ai=Di;class xi extends Oi{constructor(){super((()=>window.sessionStorage),"SESSION")}_addListener(e,t){}_removeListener(e,t){}}xi.type="SESSION";const Mi=xi;class Li{constructor(e){this.eventTarget=e,this.handlersMap={},this.boundEventHandler=this.handleEvent.bind(this)}static _getInstance(e){const t=this.receivers.find((t=>t.isListeningto(e)));if(t)return t;const n=new Li(e);return this.receivers.push(n),n}isListeningto(e){return this.eventTarget===e}async handleEvent(e){const t=e,{eventId:n,eventType:i,data:s}=t.data,r=this.handlersMap[i];if(!(null==r?void 0:r.size))return;t.ports[0].postMessage({status:"ack",eventId:n,eventType:i});const o=Array.from(r).map((async e=>e(t.origin,s))),a=await function(e){return Promise.all(e.map((async e=>{try{return{fulfilled:!0,value:await e}}catch(e){return{fulfilled:!1,reason:e}}})))}(o);t.ports[0].postMessage({status:"done",eventId:n,eventType:i,response:a})}_subscribe(e,t){0===Object.keys(this.handlersMap).length&&this.eventTarget.addEventListener("message",this.boundEventHandler),this.handlersMap[e]||(this.handlersMap[e]=new Set),this.handlersMap[e].add(t)}_unsubscribe(e,t){this.handlersMap[e]&&t&&this.handlersMap[e].delete(t),t&&0!==this.handlersMap[e].size||delete this.handlersMap[e],0===Object.keys(this.handlersMap).length&&this.eventTarget.removeEventListener("message",this.boundEventHandler)}}function Fi(e="",t=10){let n="";for(let e=0;e<t;e++)n+=Math.floor(10*Math.random());return e+n}Li.receivers=[];class Ui{constructor(e){this.target=e,this.handlers=new Set}removeMessageHandler(e){e.messageChannel&&(e.messageChannel.port1.removeEventListener("message",e.onMessage),e.messageChannel.port1.close()),this.handlers.delete(e)}async _send(e,t,n=50){const i="undefined"!=typeof MessageChannel?new MessageChannel:null;if(!i)throw new Error("connection_unavailable");let s,r;return new Promise(((o,a)=>{const c=Fi("",20);i.port1.start();const l=setTimeout((()=>{a(new Error("unsupported_event"))}),n);r={messageChannel:i,onMessage(e){const t=e;if(t.data.eventId===c)switch(t.data.status){case"ack":clearTimeout(l),s=setTimeout((()=>{a(new Error("timeout"))}),3e3);break;case"done":clearTimeout(s),o(t.data.response);break;default:clearTimeout(l),clearTimeout(s),a(new Error("invalid_response"))}}},this.handlers.add(r),i.port1.addEventListener("message",r.onMessage),this.target.postMessage({eventType:e,eventId:c,data:t},[i.port2])})).finally((()=>{r&&this.removeMessageHandler(r)}))}}function qi(){return window}function ji(){return void 0!==qi().WorkerGlobalScope&&"function"==typeof qi().importScripts}const Wi="firebaseLocalStorageDb",Hi=1,Vi="firebaseLocalStorage",zi="fbase_key";class Bi{constructor(e){this.request=e}toPromise(){return new Promise(((e,t)=>{this.request.addEventListener("success",(()=>{e(this.request.result)})),this.request.addEventListener("error",(()=>{t(this.request.error)}))}))}}function $i(e,t){return e.transaction([Vi],t?"readwrite":"readonly").objectStore(Vi)}function Ki(){const e=indexedDB.open(Wi,Hi);return new Promise(((t,n)=>{e.addEventListener("error",(()=>{n(e.error)})),e.addEventListener("upgradeneeded",(()=>{const t=e.result;try{t.createObjectStore(Vi,{keyPath:zi})}catch(e){n(e)}})),e.addEventListener("success",(async()=>{const n=e.result;n.objectStoreNames.contains(Vi)?t(n):(n.close(),await function(){const e=indexedDB.deleteDatabase(Wi);return new Bi(e).toPromise()}(),t(await Ki()))}))}))}async function Gi(e,t,n){const i=$i(e,!0).put({[zi]:t,value:n});return new Bi(i).toPromise()}function Yi(e,t){const n=$i(e,!0).delete(t);return new Bi(n).toPromise()}class Ji{constructor(){this.type="LOCAL",this._shouldAllowMigration=!0,this.listeners={},this.localCache={},this.pollTimer=null,this.pendingWrites=0,this.receiver=null,this.sender=null,this.serviceWorkerReceiverAvailable=!1,this.activeServiceWorker=null,this._workerInitializationPromise=this.initializeServiceWorkerMessaging().then((()=>{}),(()=>{}))}async _openDb(){return this.db||(this.db=await Ki()),this.db}async _withRetries(e){let t=0;for(;;)try{const t=await this._openDb();return await e(t)}catch(e){if(t++>3)throw e;this.db&&(this.db.close(),this.db=void 0)}}async initializeServiceWorkerMessaging(){return ji()?this.initializeReceiver():this.initializeSender()}async initializeReceiver(){this.receiver=Li._getInstance(ji()?self:null),this.receiver._subscribe("keyChanged",(async(e,t)=>({keyProcessed:(await this._poll()).includes(t.key)}))),this.receiver._subscribe("ping",(async(e,t)=>["keyChanged"]))}async initializeSender(){var e,t;if(this.activeServiceWorker=await async function(){if(!(null===navigator||void 0===navigator?void 0:navigator.serviceWorker))return null;try{return(await navigator.serviceWorker.ready).active}catch(e){return null}}(),!this.activeServiceWorker)return;this.sender=new Ui(this.activeServiceWorker);const n=await this.sender._send("ping",{},800);n&&(null===(e=n[0])||void 0===e?void 0:e.fulfilled)&&(null===(t=n[0])||void 0===t?void 0:t.value.includes("keyChanged"))&&(this.serviceWorkerReceiverAvailable=!0)}async notifyServiceWorker(e){var t;if(this.sender&&this.activeServiceWorker&&((null===(t=null===navigator||void 0===navigator?void 0:navigator.serviceWorker)||void 0===t?void 0:t.controller)||null)===this.activeServiceWorker)try{await this.sender._send("keyChanged",{key:e},this.serviceWorkerReceiverAvailable?800:50)}catch(t){}}async _isAvailable(){try{if(!indexedDB)return!1;const e=await Ki();return await Gi(e,Ri,"1"),await Yi(e,Ri),!0}catch(e){}return!1}async _withPendingWrite(e){this.pendingWrites++;try{await e()}finally{this.pendingWrites--}}async _set(e,t){return this._withPendingWrite((async()=>(await this._withRetries((n=>Gi(n,e,t))),this.localCache[e]=t,this.notifyServiceWorker(e))))}async _get(e){const t=await this._withRetries((t=>async function(e,t){const n=$i(e,!1).get(t),i=await new Bi(n).toPromise();return void 0===i?null:i.value}(t,e)));return this.localCache[e]=t,t}async _remove(e){return this._withPendingWrite((async()=>(await this._withRetries((t=>Yi(t,e))),delete this.localCache[e],this.notifyServiceWorker(e))))}async _poll(){const e=await this._withRetries((e=>{const t=$i(e,!1).getAll();return new Bi(t).toPromise()}));if(!e)return[];if(0!==this.pendingWrites)return[];const t=[],n=new Set;for(const{fbase_key:i,value:s}of e)n.add(i),JSON.stringify(this.localCache[i])!==JSON.stringify(s)&&(this.notifyListeners(i,s),t.push(i));for(const e of Object.keys(this.localCache))this.localCache[e]&&!n.has(e)&&(this.notifyListeners(e,null),t.push(e));return t}notifyListeners(e,t){this.localCache[e]=t;const n=this.listeners[e];if(n)for(const e of Array.from(n))e(t)}startPolling(){this.stopPolling(),this.pollTimer=setInterval((async()=>this._poll()),800)}stopPolling(){this.pollTimer&&(clearInterval(this.pollTimer),this.pollTimer=null)}_addListener(e,t){0===Object.keys(this.listeners).length&&this.startPolling(),this.listeners[e]||(this.listeners[e]=new Set,this._get(e)),this.listeners[e].add(t)}_removeListener(e,t){this.listeners[e]&&(this.listeners[e].delete(t),0===this.listeners[e].size&&delete this.listeners[e]),0===Object.keys(this.listeners).length&&this.stopPolling()}}Ji.type="LOCAL";const Qi=Ji;function Xi(e){return`__${e}${Math.floor(1e6*Math.random())}`}Xi("rcb"),new kn(3e4,6e4);const Zi="recaptcha";class es{constructor(e){this.providerId=es.PROVIDER_ID,this.auth=hi(e)}verifyPhoneNumber(e,t){return async function(e,t,n){var i;const s=await n.verify();try{let r;if(vn("string"==typeof s,e,"argument-error"),vn(n.type===Zi,e,"argument-error"),r="string"==typeof t?{phoneNumber:t}:t,"session"in r){const t=r.session;if("phoneNumber"in r){vn("enroll"===t.type,e,"internal-error");const n=await function(e,t){return On(e,"POST","/v2/accounts/mfaEnrollment:start",Rn(e,t))}(e,{idToken:t.credential,phoneEnrollmentInfo:{phoneNumber:r.phoneNumber,recaptchaToken:s}});return n.phoneSessionInfo.sessionInfo}{vn("signin"===t.type,e,"internal-error");const n=(null===(i=r.multiFactorHint)||void 0===i?void 0:i.uid)||r.multiFactorUid;vn(n,e,"missing-multi-factor-info");const o=await function(e,t){return On(e,"POST","/v2/accounts/mfaSignIn:start",Rn(e,t))}(e,{mfaPendingCredential:t.credential,mfaEnrollmentId:n,phoneSignInInfo:{recaptchaToken:s}});return o.phoneResponseInfo.sessionInfo}}{const{sessionInfo:t}=await async function(e,t){return On(e,"POST","/v1/accounts:sendVerificationCode",Rn(e,t))}(e,{phoneNumber:r.phoneNumber,recaptchaToken:s});return t}}finally{n._reset()}}(this.auth,e,V(t))}static credential(e,t){return gi._fromVerification(e,t)}static credentialFromResult(e){const t=e;return es.credentialFromTaggedObject(t)}static credentialFromError(e){return es.credentialFromTaggedObject(e.customData||{})}static credentialFromTaggedObject({_tokenResponse:e}){if(!e)return null;const{phoneNumber:t,temporaryProof:n}=e;return t&&n?gi._fromTokenResponse(t,n):null}}es.PROVIDER_ID="phone",es.PHONE_SIGN_IN_METHOD="phone";class ts extends di{constructor(e){super("custom","custom"),this.params=e}_getIdTokenResponse(e){return fi(e,this._buildIdpRequest())}_linkToIdToken(e,t){return fi(e,this._buildIdpRequest(t))}_getReauthenticationResolver(e){return fi(e,this._buildIdpRequest())}_buildIdpRequest(e){const t={requestUri:this.params.requestUri,sessionId:this.params.sessionId,postBody:this.params.postBody,tenantId:this.params.tenantId,pendingToken:this.params.pendingToken,returnSecureToken:!0,returnIdpCredential:!0};return e&&(t.idToken=e),t}}function ns(e){return async function(e,t,n=!1){const i="signIn",s=await Pi(e,i,t),r=await Ei._fromIdTokenResponse(e,i,s);return n||await e._updateCurrentUser(r.user),r}(e.auth,new ts(e),e.bypassAuthState)}function is(e){const{auth:t,user:n}=e;return vn(n,t,"internal-error"),async function(e,t,n=!1){var i;const{auth:s}=e,r="reauthenticate";try{const i=await jn(e,Pi(s,r,t,e),n);vn(i.idToken,s,"internal-error");const o=qn(i.idToken);vn(o,s,"internal-error");const{sub:a}=o;return vn(e.uid===a,s,"user-mismatch"),Ei._forOperation(e,r,i)}catch(e){throw"auth/user-not-found"===(null===(i=e)||void 0===i?void 0:i.code)&&_n(s,"user-mismatch"),e}}(n,new ts(e),e.bypassAuthState)}async function ss(e){const{auth:t,user:n}=e;return vn(n,t,"internal-error"),async function(e,t,n=!1){const i=await jn(e,t._linkToIdToken(e.auth,await e.getIdToken()),n);return Ei._forOperation(e,"link",i)}(n,new ts(e),e.bypassAuthState)}class rs{constructor(e,t,n,i,s=!1){this.auth=e,this.resolver=n,this.user=i,this.bypassAuthState=s,this.pendingPromise=null,this.eventManager=null,this.filter=Array.isArray(t)?t:[t]}execute(){return new Promise((async(e,t)=>{this.pendingPromise={resolve:e,reject:t};try{this.eventManager=await this.resolver._initialize(this.auth),await this.onExecution(),this.eventManager.registerConsumer(this)}catch(e){this.reject(e)}}))}async onAuthEvent(e){const{urlResponse:t,sessionId:n,postBody:i,tenantId:s,error:r,type:o}=e;if(r)return void this.reject(r);const a={auth:this.auth,requestUri:t,sessionId:n,tenantId:s||void 0,postBody:i||void 0,user:this.user,bypassAuthState:this.bypassAuthState};try{this.resolve(await this.getIdpTask(o)(a))}catch(e){this.reject(e)}}onError(e){this.reject(e)}getIdpTask(e){switch(e){case"signInViaPopup":case"signInViaRedirect":return ns;case"linkViaPopup":case"linkViaRedirect":return ss;case"reauthViaPopup":case"reauthViaRedirect":return is;default:_n(this.auth,"internal-error")}}resolve(e){wn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.resolve(e),this.unregisterAndCleanUp()}reject(e){wn(this.pendingPromise,"Pending promise was never set"),this.pendingPromise.reject(e),this.unregisterAndCleanUp()}unregisterAndCleanUp(){this.eventManager&&this.eventManager.unregisterConsumer(this),this.pendingPromise=null,this.cleanUp()}}const os=new kn(2e3,1e4);class as extends rs{constructor(e,t,n,i,s){super(e,t,i,s),this.provider=n,this.authWindow=null,this.pollId=null,as.currentPopupAction&&as.currentPopupAction.cancel(),as.currentPopupAction=this}async executeNotNull(){const e=await this.execute();return vn(e,this.auth,"internal-error"),e}async onExecution(){wn(1===this.filter.length,"Popup operations only handle one event");const e=Fi();this.authWindow=await this.resolver._openPopup(this.auth,this.provider,this.filter[0],e),this.authWindow.associatedEvent=e,this.resolver._originValidation(this.auth).catch((e=>{this.reject(e)})),this.resolver._isIframeWebStorageSupported(this.auth,(e=>{e||this.reject(mn(this.auth,"web-storage-unsupported"))})),this.pollUserCancellation()}get eventId(){var e;return(null===(e=this.authWindow)||void 0===e?void 0:e.associatedEvent)||null}cancel(){this.reject(mn(this.auth,"cancelled-popup-request"))}cleanUp(){this.authWindow&&this.authWindow.close(),this.pollId&&window.clearTimeout(this.pollId),this.authWindow=null,this.pollId=null,as.currentPopupAction=null}pollUserCancellation(){const e=()=>{var t,n;(null===(n=null===(t=this.authWindow)||void 0===t?void 0:t.window)||void 0===n?void 0:n.closed)?this.pollId=window.setTimeout((()=>{this.pollId=null,this.reject(mn(this.auth,"popup-closed-by-user"))}),2e3):this.pollId=window.setTimeout(e,os.get())};e()}}as.currentPopupAction=null;const cs="pendingRedirect",ls=new Map;class hs extends rs{constructor(e,t,n=!1){super(e,["signInViaRedirect","linkViaRedirect","reauthViaRedirect","unknown"],t,void 0,n),this.eventId=null}async execute(){let e=ls.get(this.auth._key());if(!e){try{const t=await async function(e,t){const n=function(e){return Yn(cs,e.config.apiKey,e.name)}(t),i=function(e){return bn(e._redirectPersistence)}(e);if(!await i._isAvailable())return!1;const s="true"===await i._get(n);return await i._remove(n),s}(this.resolver,this.auth),n=t?await super.execute():null;e=()=>Promise.resolve(n)}catch(t){e=()=>Promise.reject(t)}ls.set(this.auth._key(),e)}return this.bypassAuthState||ls.set(this.auth._key(),(()=>Promise.resolve(null))),e()}async onAuthEvent(e){if("signInViaRedirect"===e.type)return super.onAuthEvent(e);if("unknown"!==e.type){if(e.eventId){const t=await this.auth._redirectUserForId(e.eventId);if(t)return this.user=t,super.onAuthEvent(e);this.resolve(null)}}else this.resolve(null)}async onExecution(){}cleanUp(){}}function us(e,t){ls.set(e._key(),t)}async function ds(e,t,n=!1){const i=hi(e),s=function(e,t){return t?bn(t):(vn(e._popupRedirectResolver,e,"argument-error"),e._popupRedirectResolver)}(i,t),r=new hs(i,s,n),o=await r.execute();return o&&!n&&(delete o.user._redirectEventId,await i._persistUserIfCurrent(o.user),await i._setRedirectUser(null,t)),o}class ps{constructor(e){this.auth=e,this.cachedEventUids=new Set,this.consumers=new Set,this.queuedRedirectEvent=null,this.hasHandledPotentialRedirect=!1,this.lastProcessedEventTime=Date.now()}registerConsumer(e){this.consumers.add(e),this.queuedRedirectEvent&&this.isEventForConsumer(this.queuedRedirectEvent,e)&&(this.sendToConsumer(this.queuedRedirectEvent,e),this.saveEventToCache(this.queuedRedirectEvent),this.queuedRedirectEvent=null)}unregisterConsumer(e){this.consumers.delete(e)}onEvent(e){if(this.hasEventBeenHandled(e))return!1;let t=!1;return this.consumers.forEach((n=>{this.isEventForConsumer(e,n)&&(t=!0,this.sendToConsumer(e,n),this.saveEventToCache(e))})),this.hasHandledPotentialRedirect||!function(e){switch(e.type){case"signInViaRedirect":case"linkViaRedirect":case"reauthViaRedirect":return!0;case"unknown":return _s(e);default:return!1}}(e)||(this.hasHandledPotentialRedirect=!0,t||(this.queuedRedirectEvent=e,t=!0)),t}sendToConsumer(e,t){var n;if(e.error&&!_s(e)){const i=(null===(n=e.error.code)||void 0===n?void 0:n.split("auth/")[1])||"internal-error";t.onError(mn(this.auth,i))}else t.onAuthEvent(e)}isEventForConsumer(e,t){const n=null===t.eventId||!!e.eventId&&e.eventId===t.eventId;return t.filter.includes(e.type)&&n}hasEventBeenHandled(e){return Date.now()-this.lastProcessedEventTime>=6e5&&this.cachedEventUids.clear(),this.cachedEventUids.has(fs(e))}saveEventToCache(e){this.cachedEventUids.add(fs(e)),this.lastProcessedEventTime=Date.now()}}function fs(e){return[e.type,e.eventId,e.sessionId,e.tenantId].filter((e=>e)).join("-")}function _s({type:e,error:t}){return"unknown"===e&&"auth/no-auth-event"===(null==t?void 0:t.code)}const ms=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,gs=/^https?/;function vs(e){const t=Cn(),{protocol:n,hostname:i}=new URL(t);if(e.startsWith("chrome-extension://")){const s=new URL(e);return""===s.hostname&&""===i?"chrome-extension:"===n&&e.replace("chrome-extension://","")===t.replace("chrome-extension://",""):"chrome-extension:"===n&&s.hostname===i}if(!gs.test(n))return!1;if(ms.test(e))return i===e;const s=e.replace(/\./g,"\\.");return new RegExp("^(.+\\."+s+"|"+s+")$","i").test(i)}const ys=new kn(3e4,6e4);function ws(){const e=qi().___jsl;if(null==e?void 0:e.H)for(const t of Object.keys(e.H))if(e.H[t].r=e.H[t].r||[],e.H[t].L=e.H[t].L||[],e.H[t].r=[...e.H[t].L],e.CP)for(let t=0;t<e.CP.length;t++)e.CP[t]=null}let Is=null;function bs(e){return Is=Is||function(e){return new Promise(((t,n)=>{var i,s,r,o;function a(){ws(),gapi.load("gapi.iframes",{callback:()=>{t(gapi.iframes.getContext())},ontimeout:()=>{ws(),n(mn(e,"network-request-failed"))},timeout:ys.get()})}if(null===(s=null===(i=qi().gapi)||void 0===i?void 0:i.iframes)||void 0===s?void 0:s.Iframe)t(gapi.iframes.getContext());else{if(!(null===(r=qi().gapi)||void 0===r?void 0:r.load)){const t=Xi("iframefcb");return qi()[t]=()=>{gapi.load?a():n(mn(e,"network-request-failed"))},(o=`https://apis.google.com/js/api.js?onload=${t}`,new Promise(((e,t)=>{const n=document.createElement("script");var i,s;n.setAttribute("src",o),n.onload=e,n.onerror=e=>{const n=mn("internal-error");n.customData=e,t(n)},n.type="text/javascript",n.charset="UTF-8",(null!==(s=null===(i=document.getElementsByTagName("head"))||void 0===i?void 0:i[0])&&void 0!==s?s:document).appendChild(n)}))).catch((e=>n(e)))}a()}})).catch((e=>{throw Is=null,e}))}(e),Is}const Cs=new kn(5e3,15e3),Ts="__/auth/iframe",ks="emulator/auth/iframe",Es={style:{position:"absolute",top:"-100px",width:"1px",height:"1px"},"aria-hidden":"true",tabindex:"-1"},Ss=new Map([["identitytoolkit.googleapis.com","p"],["staging-identitytoolkit.sandbox.googleapis.com","s"],["test-identitytoolkit.sandbox.googleapis.com","t"]]);function Ns(e){const t=e.config;vn(t.authDomain,e,"auth-domain-config-required");const n=t.emulator?En(t,ks):`https://${e.config.authDomain}/${Ts}`,i={apiKey:t.apiKey,appName:e.name,v:De},s=Ss.get(e.config.apiHost);s&&(i.eid=s);const r=e._getFrameworks();return r.length&&(i.fw=r.join(",")),`${n}?${R(i).slice(1)}`}const Ps={location:"yes",resizable:"yes",statusbar:"yes",toolbar:"no"},Rs=500,Os=600,Ds="_blank",As="http://localhost";class xs{constructor(e){this.window=e,this.associatedEvent=null}close(){if(this.window)try{this.window.close()}catch(e){}}}const Ms="__/auth/handler",Ls="emulator/auth/handler";function Fs(e,t,n,i,s,r){vn(e.config.authDomain,e,"auth-domain-config-required"),vn(e.config.apiKey,e,"invalid-api-key");const o={apiKey:e.config.apiKey,appName:e.name,authType:n,redirectUrl:i,v:De,eventId:s};if(t instanceof wi){t.setDefaultLanguage(e.languageCode),o.providerId=t.providerId||"",E(t.getCustomParameters())||(o.customParameters=JSON.stringify(t.getCustomParameters()));for(const[e,t]of Object.entries(r||{}))o[e]=t}if(t instanceof Ii){const e=t.getScopes().filter((e=>""!==e));e.length>0&&(o.scopes=e.join(","))}e.tenantId&&(o.tid=e.tenantId);const a=o;for(const e of Object.keys(a))void 0===a[e]&&delete a[e];return`${function({config:e}){return e.emulator?En(e,Ls):`https://${e.authDomain}/${Ms}`}(e)}?${R(a).slice(1)}`}const Us="webStorageSupport",qs=class{constructor(){this.eventManagers={},this.iframes={},this.originValidationPromises={},this._redirectPersistence=Mi,this._completeRedirectFn=ds,this._overrideRedirectResult=us}async _openPopup(e,t,n,i){var s;return wn(null===(s=this.eventManagers[e._key()])||void 0===s?void 0:s.manager,"_initialize() not called before _openPopup()"),function(e,t,n,i=Rs,s=Os){const r=Math.max((window.screen.availHeight-s)/2,0).toString(),o=Math.max((window.screen.availWidth-i)/2,0).toString();let a="";const c=Object.assign(Object.assign({},Ps),{width:i.toString(),height:s.toString(),top:r,left:o}),l=u().toLowerCase();n&&(a=ei(l)?Ds:n),Xn(l)&&(t=t||As,c.scrollbars="yes");const h=Object.entries(c).reduce(((e,[t,n])=>`${e}${t}=${n},`),"");if(function(e=u()){var t;return ri(e)&&!!(null===(t=window.navigator)||void 0===t?void 0:t.standalone)}(l)&&"_self"!==a)return function(e,t){const n=document.createElement("a");n.href=e,n.target=t;const i=document.createEvent("MouseEvent");i.initMouseEvent("click",!0,!0,window,1,0,0,0,0,!1,!1,!1,!1,1,null),n.dispatchEvent(i)}(t||"",a),new xs(null);const d=window.open(t||"",a,h);vn(d,e,"popup-blocked");try{d.focus()}catch(e){}return new xs(d)}(e,Fs(e,t,n,Cn(),i),Fi())}async _openRedirect(e,t,n,i){var s;return await this._originValidation(e),s=Fs(e,t,n,Cn(),i),qi().location.href=s,new Promise((()=>{}))}_initialize(e){const t=e._key();if(this.eventManagers[t]){const{manager:e,promise:n}=this.eventManagers[t];return e?Promise.resolve(e):(wn(n,"If manager is not set, promise should be"),n)}const n=this.initAndGetManager(e);return this.eventManagers[t]={promise:n},n.catch((()=>{delete this.eventManagers[t]})),n}async initAndGetManager(e){const t=await async function(e){const t=await bs(e),n=qi().gapi;return vn(n,e,"internal-error"),t.open({where:document.body,url:Ns(e),messageHandlersFilter:n.iframes.CROSS_ORIGIN_IFRAMES_FILTER,attributes:Es,dontclear:!0},(t=>new Promise((async(n,i)=>{await t.restyle({setHideOnLeave:!1});const s=mn(e,"network-request-failed"),r=qi().setTimeout((()=>{i(s)}),Cs.get());function o(){qi().clearTimeout(r),n(t)}t.ping(o).then(o,(()=>{i(s)}))}))))}(e),n=new ps(e);return t.register("authEvent",(t=>(vn(null==t?void 0:t.authEvent,e,"invalid-auth-event"),{status:n.onEvent(t.authEvent)?"ACK":"ERROR"})),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER),this.eventManagers[e._key()]={manager:n},this.iframes[e._key()]=t,n}_isIframeWebStorageSupported(e,t){this.iframes[e._key()].send(Us,{type:Us},(n=>{var i;const s=null===(i=null==n?void 0:n[0])||void 0===i?void 0:i[Us];void 0!==s&&t(!!s),_n(e,"internal-error")}),gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER)}_originValidation(e){const t=e._key();return this.originValidationPromises[t]||(this.originValidationPromises[t]=async function(e){if(e.config.emulator)return;const{authorizedDomains:t}=await async function(e,t={}){return On(e,"GET","/v1/projects",t)}(e);for(const e of t)try{if(vs(e))return}catch(e){}_n(e,"unauthorized-domain")}(e)),this.originValidationPromises[t]}get _shouldInitProactively(){return oi()||Zn()||ri()}};var js,Ws="@firebase/auth",Hs="0.20.5";class Vs{constructor(e){this.auth=e,this.internalListeners=new Map}getUid(){var e;return this.assertAuthConfigured(),(null===(e=this.auth.currentUser)||void 0===e?void 0:e.uid)||null}async getToken(e){return this.assertAuthConfigured(),await this.auth._initializationPromise,this.auth.currentUser?{accessToken:await this.auth.currentUser.getIdToken(e)}:null}addAuthTokenListener(e){if(this.assertAuthConfigured(),this.internalListeners.has(e))return;const t=this.auth.onIdTokenChanged((t=>{var n;e((null===(n=t)||void 0===n?void 0:n.stsTokenManager.accessToken)||null)}));this.internalListeners.set(e,t),this.updateProactiveRefresh()}removeAuthTokenListener(e){this.assertAuthConfigured();const t=this.internalListeners.get(e);t&&(this.internalListeners.delete(e),t(),this.updateProactiveRefresh())}assertAuthConfigured(){vn(this.auth._initializationPromise,"dependent-sdk-initialized-before-auth")}updateProactiveRefresh(){this.internalListeners.size>0?this.auth._startProactiveRefresh():this.auth._stopProactiveRefresh()}}js="Browser",Ne(new z("auth",((e,{options:t})=>{const n=e.getProvider("app").getImmediate(),i=e.getProvider("heartbeat"),{apiKey:s,authDomain:r}=n.options;return((e,n)=>{vn(s&&!s.includes(":"),"invalid-api-key",{appName:e.name}),vn(!(null==r?void 0:r.includes(":")),"argument-error",{appName:e.name});const i={apiKey:s,authDomain:r,clientPlatform:js,apiHost:"identitytoolkit.googleapis.com",tokenApiHost:"securetoken.googleapis.com",apiScheme:"https",sdkClientVersion:ai(js)},o=new li(e,n,i);return function(e,t){const n=(null==t?void 0:t.persistence)||[],i=(Array.isArray(n)?n:[n]).map(bn);(null==t?void 0:t.errorMap)&&e._updateErrorMap(t.errorMap),e._initializeWithPersistence(i,null==t?void 0:t.popupRedirectResolver)}(o,t),o})(n,i)}),"PUBLIC").setInstantiationMode("EXPLICIT").setInstanceCreatedCallback(((e,t,n)=>{e.getProvider("auth-internal").initialize()}))),Ne(new z("auth-internal",(e=>(e=>new Vs(e))(hi(e.getProvider("auth").getImmediate()))),"PRIVATE").setInstantiationMode("EXPLICIT")),xe(Ws,Hs,function(e){switch(e){case"Node":return"node";case"ReactNative":return"rn";case"Worker":return"webworker";case"Cordova":return"cordova";default:return}}(js)),xe(Ws,Hs,"esm2017");const zs="@firebase/database",Bs="0.13.5";let $s="";class Ks{constructor(e){this.domStorage_=e,this.prefix_="firebase:"}set(e,t){null==t?this.domStorage_.removeItem(this.prefixedName_(e)):this.domStorage_.setItem(this.prefixedName_(e),b(t))}get(e){const t=this.domStorage_.getItem(this.prefixedName_(e));return null==t?null:I(t)}remove(e){this.domStorage_.removeItem(this.prefixedName_(e))}prefixedName_(e){return this.prefix_+e}toString(){return this.domStorage_.toString()}}class Gs{constructor(){this.cache_={},this.isInMemoryStorage=!0}set(e,t){null==t?delete this.cache_[e]:this.cache_[e]=t}get(e){return T(this.cache_,e)?this.cache_[e]:null}remove(e){delete this.cache_[e]}}const Ys=function(e){try{if("undefined"!=typeof window&&void 0!==window[e]){const t=window[e];return t.setItem("firebase:sentinel","cache"),t.removeItem("firebase:sentinel"),new Ks(t)}}catch(e){}return new Gs},Js=Ys("localStorage"),Qs=Ys("sessionStorage"),Xs=new ee("@firebase/database"),Zs=function(){let e=1;return function(){return e++}}(),er=function(e){const n=function(e){const n=[];let i=0;for(let s=0;s<e.length;s++){let r=e.charCodeAt(s);if(r>=55296&&r<=56319){const n=r-55296;s++,t(s<e.length,"Surrogate pair missing trail surrogate."),r=65536+(n<<10)+(e.charCodeAt(s)-56320)}r<128?n[i++]=r:r<2048?(n[i++]=r>>6|192,n[i++]=63&r|128):r<65536?(n[i++]=r>>12|224,n[i++]=r>>6&63|128,n[i++]=63&r|128):(n[i++]=r>>18|240,n[i++]=r>>12&63|128,n[i++]=r>>6&63|128,n[i++]=63&r|128)}return n}(e),i=new A;i.update(n);const r=i.digest();return s.encodeByteArray(r)},tr=function(...e){let t="";for(let n=0;n<e.length;n++){const i=e[n];Array.isArray(i)||i&&"object"==typeof i&&"number"==typeof i.length?t+=tr.apply(null,i):t+="object"==typeof i?b(i):i,t+=" "}return t};let nr=null,ir=!0;const sr=function(...e){if(!0===ir&&(ir=!1,null===nr&&!0===Qs.get("logging_enabled")&&(n=!0,t(!i||!0===n||!1===n,"Can't turn on custom loggers persistently."),!0===n?(Xs.logLevel=Y.VERBOSE,nr=Xs.log.bind(Xs),i&&Qs.set("logging_enabled",!0)):"function"==typeof n?nr=n:(nr=null,Qs.remove("logging_enabled")))),nr){const t=tr.apply(null,e);nr(t)}var n,i},rr=function(e){return function(...t){sr(e,...t)}},or=function(...e){const t="FIREBASE INTERNAL ERROR: "+tr(...e);Xs.error(t)},ar=function(...e){const t=`FIREBASE FATAL ERROR: ${tr(...e)}`;throw Xs.error(t),new Error(t)},cr=function(...e){const t="FIREBASE WARNING: "+tr(...e);Xs.warn(t)},lr=function(e){return"number"==typeof e&&(e!=e||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY)},hr="[MIN_NAME]",ur="[MAX_NAME]",dr=function(e,t){if(e===t)return 0;if(e===hr||t===ur)return-1;if(t===hr||e===ur)return 1;{const n=wr(e),i=wr(t);return null!==n?null!==i?n-i==0?e.length-t.length:n-i:-1:null!==i?1:e<t?-1:1}},pr=function(e,t){return e===t?0:e<t?-1:1},fr=function(e,t){if(t&&e in t)return t[e];throw new Error("Missing required key ("+e+") in object: "+b(t))},_r=function(e){if("object"!=typeof e||null===e)return b(e);const t=[];for(const n in e)t.push(n);t.sort();let n="{";for(let i=0;i<t.length;i++)0!==i&&(n+=","),n+=b(t[i]),n+=":",n+=_r(e[t[i]]);return n+="}",n},mr=function(e,t){const n=e.length;if(n<=t)return[e];const i=[];for(let s=0;s<n;s+=t)s+t>n?i.push(e.substring(s,n)):i.push(e.substring(s,s+t));return i};function gr(e,t){for(const n in e)e.hasOwnProperty(n)&&t(n,e[n])}const vr=function(e){t(!lr(e),"Invalid JSON number");let n,i,s,r,o;0===e?(i=0,s=0,n=1/e==-1/0?1:0):(n=e<0,(e=Math.abs(e))>=Math.pow(2,-1022)?(r=Math.min(Math.floor(Math.log(e)/Math.LN2),1023),i=r+1023,s=Math.round(e*Math.pow(2,52-r)-Math.pow(2,52))):(i=0,s=Math.round(e/Math.pow(2,-1074))));const a=[];for(o=52;o;o-=1)a.push(s%2?1:0),s=Math.floor(s/2);for(o=11;o;o-=1)a.push(i%2?1:0),i=Math.floor(i/2);a.push(n?1:0),a.reverse();const c=a.join("");let l="";for(o=0;o<64;o+=8){let e=parseInt(c.substr(o,8),2).toString(16);1===e.length&&(e="0"+e),l+=e}return l.toLowerCase()},yr=new RegExp("^-?(0*)\\d{1,10}$"),wr=function(e){if(yr.test(e)){const t=Number(e);if(t>=-2147483648&&t<=2147483647)return t}return null},Ir=function(e){try{e()}catch(e){setTimeout((()=>{const t=e.stack||"";throw cr("Exception was thrown by user callback.",t),e}),Math.floor(0))}},br=function(){return("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0},Cr=function(e,t){const n=setTimeout(e,t);return"object"==typeof n&&n.unref&&n.unref(),n};class Tr{constructor(e,t){this.appName_=e,this.appCheckProvider=t,this.appCheck=null==t?void 0:t.getImmediate({optional:!0}),this.appCheck||null==t||t.get().then((e=>this.appCheck=e))}getToken(e){return this.appCheck?this.appCheck.getToken(e):new Promise(((t,n)=>{setTimeout((()=>{this.appCheck?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){var t;null===(t=this.appCheckProvider)||void 0===t||t.get().then((t=>t.addTokenListener(e)))}notifyForInvalidToken(){cr(`Provided AppCheck credentials for the app named "${this.appName_}" are invalid. This usually indicates your app was not initialized correctly.`)}}class kr{constructor(e,t,n){this.appName_=e,this.firebaseOptions_=t,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit((e=>this.auth_=e))}getToken(e){return this.auth_?this.auth_.getToken(e).catch((e=>e&&"auth/token-not-initialized"===e.code?(sr("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(e))):new Promise(((t,n)=>{setTimeout((()=>{this.auth_?this.getToken(e).then(t,n):t(null)}),0)}))}addTokenChangeListener(e){this.auth_?this.auth_.addAuthTokenListener(e):this.authProvider_.get().then((t=>t.addAuthTokenListener(e)))}removeTokenChangeListener(e){this.authProvider_.get().then((t=>t.removeAuthTokenListener(e)))}notifyForInvalidToken(){let e='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';"credential"in this.firebaseOptions_?e+='Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?e+='Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':e+='Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.',cr(e)}}class Er{constructor(e){this.accessToken=e}getToken(e){return Promise.resolve({accessToken:this.accessToken})}addTokenChangeListener(e){e(this.accessToken)}removeTokenChangeListener(e){}notifyForInvalidToken(){}}Er.OWNER="owner";const Sr="5",Nr=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,Pr="ac",Rr="websocket",Or="long_polling";class Dr{constructor(e,t,n,i,s=!1,r="",o=!1){this.secure=t,this.namespace=n,this.webSocketOnly=i,this.nodeAdmin=s,this.persistenceKey=r,this.includeNamespaceInQueryParams=o,this._host=e.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=Js.get("host:"+e)||this._host}isCacheableHost(){return"s-"===this.internalHost.substr(0,2)}isCustomHost(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain}get host(){return this._host}set host(e){e!==this.internalHost&&(this.internalHost=e,this.isCacheableHost()&&Js.set("host:"+this._host,this.internalHost))}toString(){let e=this.toURLString();return this.persistenceKey&&(e+="<"+this.persistenceKey+">"),e}toURLString(){const e=this.secure?"https://":"http://",t=this.includeNamespaceInQueryParams?`?ns=${this.namespace}`:"";return`${e}${this.host}/${t}`}}function Ar(e,n,i){let s;if(t("string"==typeof n,"typeof type must == string"),t("object"==typeof i,"typeof params must == object"),n===Rr)s=(e.secure?"wss://":"ws://")+e.internalHost+"/.ws?";else{if(n!==Or)throw new Error("Unknown connection type: "+n);s=(e.secure?"https://":"http://")+e.internalHost+"/.lp?"}(function(e){return e.host!==e.internalHost||e.isCustomHost()||e.includeNamespaceInQueryParams})(e)&&(i.ns=e.namespace);const r=[];return gr(i,((e,t)=>{r.push(e+"="+t)})),s+r.join("&")}class xr{constructor(){this.counters_={}}incrementCounter(e,t=1){T(this.counters_,e)||(this.counters_[e]=0),this.counters_[e]+=t}get(){return c(this.counters_)}}const Mr={},Lr={};function Fr(e){const t=e.toString();return Mr[t]||(Mr[t]=new xr),Mr[t]}class Ur{constructor(e){this.onMessage_=e,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}closeAfter(e,t){this.closeAfterResponse=e,this.onClose=t,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)}handleResponse(e,t){for(this.pendingResponses[e]=t;this.pendingResponses[this.currentResponseNum];){const e=this.pendingResponses[this.currentResponseNum];delete this.pendingResponses[this.currentResponseNum];for(let t=0;t<e.length;++t)e[t]&&Ir((()=>{this.onMessage_(e[t])}));if(this.currentResponseNum===this.closeAfterResponse){this.onClose&&(this.onClose(),this.onClose=null);break}this.currentResponseNum++}}}const qr="start";class jr{constructor(e,t,n,i,s,r,o){this.connId=e,this.repoInfo=t,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.transportSessionId=r,this.lastSessionId=o,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=rr(e),this.stats_=Fr(t),this.urlFn=e=>(this.appCheckToken&&(e[Pr]=this.appCheckToken),Ar(t,Or,e))}open(e,t){this.curSegmentNum=0,this.onDisconnect_=t,this.myPacketOrderer=new Ur(e),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout((()=>{this.log_("Timed out trying to connect."),this.onClosed_(),this.connectTimeoutTimer_=null}),Math.floor(3e4)),function(e){if(_()||"complete"===document.readyState)e();else{let t=!1;const n=function(){document.body?t||(t=!0,e()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",(()=>{"complete"===document.readyState&&n()})),window.attachEvent("onload",n))}}((()=>{if(this.isClosed_)return;this.scriptTagHolder=new Wr(((...e)=>{const[t,n,i,s,r]=e;if(this.incrementIncomingBytes_(e),this.scriptTagHolder)if(this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null),this.everConnected_=!0,t===qr)this.id=n,this.password=i;else{if("close"!==t)throw new Error("Unrecognized command received: "+t);n?(this.scriptTagHolder.sendNewPolls=!1,this.myPacketOrderer.closeAfter(n,(()=>{this.onClosed_()}))):this.onClosed_()}}),((...e)=>{const[t,n]=e;this.incrementIncomingBytes_(e),this.myPacketOrderer.handleResponse(t,n)}),(()=>{this.onClosed_()}),this.urlFn);const e={};e[qr]="t",e.ser=Math.floor(1e8*Math.random()),this.scriptTagHolder.uniqueCallbackIdentifier&&(e.cb=this.scriptTagHolder.uniqueCallbackIdentifier),e.v=Sr,this.transportSessionId&&(e.s=this.transportSessionId),this.lastSessionId&&(e.ls=this.lastSessionId),this.applicationId&&(e.p=this.applicationId),this.appCheckToken&&(e[Pr]=this.appCheckToken),"undefined"!=typeof location&&location.hostname&&Nr.test(location.hostname)&&(e.r="f");const t=this.urlFn(e);this.log_("Connecting via long-poll to "+t),this.scriptTagHolder.addTag(t,(()=>{}))}))}start(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)}static forceAllow(){jr.forceAllow_=!0}static forceDisallow(){jr.forceDisallow_=!0}static isAvailable(){return!(_()||!jr.forceAllow_&&(jr.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))}markConnectionHealthy(){}shutdown_(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)}onClosed_(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))}close(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())}send(e){const t=b(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=r(t),i=mr(n,1840);for(let e=0;e<i.length;e++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,i.length,i[e]),this.curSegmentNum++}addDisconnectPingFrame(e,t){if(_())return;this.myDisconnFrame=document.createElement("iframe");const n={dframe:"t"};n.id=e,n.pw=t,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}incrementIncomingBytes_(e){const t=b(e).length;this.bytesReceived+=t,this.stats_.incrementCounter("bytes_received",t)}}class Wr{constructor(e,t,n,i){if(this.onDisconnect=n,this.urlFn=i,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,_())this.commandCB=e,this.onMessageCB=t;else{this.uniqueCallbackIdentifier=Zs(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=t,this.myIFrame=Wr.createIFrame_();let n="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(n='<script>document.domain="'+document.domain+'";<\/script>');const i="<html><body>"+n+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(i),this.myIFrame.doc.close()}catch(e){sr("frame writing exception"),e.stack&&sr(e.stack),sr(e)}}}static createIFrame_(){const e=document.createElement("iframe");if(e.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(e);try{e.contentWindow.document||sr("No IE domain setting required")}catch(t){const n=document.domain;e.src="javascript:void((function(){document.open();document.domain='"+n+"';document.close();})())"}return e.contentDocument?e.doc=e.contentDocument:e.contentWindow?e.doc=e.contentWindow.document:e.document&&(e.doc=e.document),e}close(){this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout((()=>{null!==this.myIFrame&&(document.body.removeChild(this.myIFrame),this.myIFrame=null)}),Math.floor(0)));const e=this.onDisconnect;e&&(this.onDisconnect=null,e())}startLongPoll(e,t){for(this.myID=e,this.myPW=t,this.alive=!0;this.newRequest_(););}newRequest_(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;const e={};e.id=this.myID,e.pw=this.myPW,e.ser=this.currentSerial;let t=this.urlFn(e),n="",i=0;for(;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){const e=this.pendingSegs.shift();n=n+"&seg"+i+"="+e.seg+"&ts"+i+"="+e.ts+"&d"+i+"="+e.d,i++}return t+=n,this.addLongPollTag_(t,this.currentSerial),!0}return!1}enqueueSegment(e,t,n){this.pendingSegs.push({seg:e,ts:t,d:n}),this.alive&&this.newRequest_()}addLongPollTag_(e,t){this.outstandingRequests.add(t);const n=()=>{this.outstandingRequests.delete(t),this.newRequest_()},i=setTimeout(n,Math.floor(25e3));this.addTag(e,(()=>{clearTimeout(i),n()}))}addTag(e,t){_()?this.doNodeLongPoll(e,t):setTimeout((()=>{try{if(!this.sendNewPolls)return;const n=this.myIFrame.doc.createElement("script");n.type="text/javascript",n.async=!0,n.src=e,n.onload=n.onreadystatechange=function(){const e=n.readyState;e&&"loaded"!==e&&"complete"!==e||(n.onload=n.onreadystatechange=null,n.parentNode&&n.parentNode.removeChild(n),t())},n.onerror=()=>{sr("Long-poll script failed to load: "+e),this.sendNewPolls=!1,this.close()},this.myIFrame.doc.body.appendChild(n)}catch(e){}}),Math.floor(1))}}let Hr=null;"undefined"!=typeof MozWebSocket?Hr=MozWebSocket:"undefined"!=typeof WebSocket&&(Hr=WebSocket);class Vr{constructor(e,t,n,i,s,r,o){this.connId=e,this.applicationId=n,this.appCheckToken=i,this.authToken=s,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=rr(this.connId),this.stats_=Fr(t),this.connURL=Vr.connectionURL_(t,r,o,i,n),this.nodeAdmin=t.nodeAdmin}static connectionURL_(e,t,n,i,s){const r={};return r.v=Sr,!_()&&"undefined"!=typeof location&&location.hostname&&Nr.test(location.hostname)&&(r.r="f"),t&&(r.s=t),n&&(r.ls=n),i&&(r[Pr]=i),s&&(r.p=s),Ar(e,Rr,r)}open(e,t){this.onDisconnect=t,this.onMessage=e,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,Js.set("previous_websocket_failure",!0);try{let e;if(_()){const t=this.nodeAdmin?"AdminNode":"Node";e={headers:{"User-Agent":`Firebase/${Sr}/${$s}/${process.platform}/${t}`,"X-Firebase-GMPID":this.applicationId||""}},this.authToken&&(e.headers.Authorization=`Bearer ${this.authToken}`),this.appCheckToken&&(e.headers["X-Firebase-AppCheck"]=this.appCheckToken);const n=process.env,i=0===this.connURL.indexOf("wss://")?n.HTTPS_PROXY||n.https_proxy:n.HTTP_PROXY||n.http_proxy;i&&(e.proxy={origin:i})}this.mySock=new Hr(this.connURL,[],e)}catch(e){this.log_("Error instantiating WebSocket.");const t=e.message||e.data;return t&&this.log_(t),void this.onClosed_()}this.mySock.onopen=()=>{this.log_("Websocket connected."),this.everConnected_=!0},this.mySock.onclose=()=>{this.log_("Websocket connection was disconnected."),this.mySock=null,this.onClosed_()},this.mySock.onmessage=e=>{this.handleIncomingFrame(e)},this.mySock.onerror=e=>{this.log_("WebSocket error.  Closing connection.");const t=e.message||e.data;t&&this.log_(t),this.onClosed_()}}start(){}static forceDisallow(){Vr.forceDisallow_=!0}static isAvailable(){let e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){const t=/Android ([0-9]{0,}\.[0-9]{0,})/,n=navigator.userAgent.match(t);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==Hr&&!Vr.forceDisallow_}static previouslyFailed(){return Js.isInMemoryStorage||!0===Js.get("previous_websocket_failure")}markConnectionHealthy(){Js.remove("previous_websocket_failure")}appendFrame_(e){if(this.frames.push(e),this.frames.length===this.totalFrames){const e=this.frames.join("");this.frames=null;const t=I(e);this.onMessage(t)}}handleNewFrameCount_(e){this.totalFrames=e,this.frames=[]}extractFrameCount_(e){if(t(null===this.frames,"We already have a frame buffer"),e.length<=6){const t=Number(e);if(!isNaN(t))return this.handleNewFrameCount_(t),null}return this.handleNewFrameCount_(1),e}handleIncomingFrame(e){if(null===this.mySock)return;const t=e.data;if(this.bytesReceived+=t.length,this.stats_.incrementCounter("bytes_received",t.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(t);else{const e=this.extractFrameCount_(t);null!==e&&this.appendFrame_(e)}}send(e){this.resetKeepAlive();const t=b(e);this.bytesSent+=t.length,this.stats_.incrementCounter("bytes_sent",t.length);const n=mr(t,16384);n.length>1&&this.sendString_(String(n.length));for(let e=0;e<n.length;e++)this.sendString_(n[e])}shutdown_(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)}onClosed_(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))}close(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())}resetKeepAlive(){clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval((()=>{this.mySock&&this.sendString_("0"),this.resetKeepAlive()}),Math.floor(45e3))}sendString_(e){try{this.mySock.send(e)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}}}Vr.responsesRequiredToBeHealthy=2,Vr.healthyTimeout=3e4;class zr{constructor(e){this.initTransports_(e)}static get ALL_TRANSPORTS(){return[jr,Vr]}static get IS_TRANSPORT_INITIALIZED(){return this.globalTransportInitialized_}initTransports_(e){const t=Vr&&Vr.isAvailable();let n=t&&!Vr.previouslyFailed();if(e.webSocketOnly&&(t||cr("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),n=!0),n)this.transports_=[Vr];else{const e=this.transports_=[];for(const t of zr.ALL_TRANSPORTS)t&&t.isAvailable()&&e.push(t);zr.globalTransportInitialized_=!0}}initialTransport(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")}upgradeTransport(){return this.transports_.length>1?this.transports_[1]:null}}zr.globalTransportInitialized_=!1;class Br{constructor(e,t,n,i,s,r,o,a,c,l){this.id=e,this.repoInfo_=t,this.applicationId_=n,this.appCheckToken_=i,this.authToken_=s,this.onMessage_=r,this.onReady_=o,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=rr("c:"+this.id+":"),this.transportManager_=new zr(t),this.log_("Connection created"),this.start_()}start_(){const e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.conn_),n=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout((()=>{this.conn_&&this.conn_.open(t,n)}),Math.floor(0));const i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=Cr((()=>{this.healthyTimeout_=null,this.isHealthy_||(this.conn_&&this.conn_.bytesReceived>102400?(this.log_("Connection exceeded healthy timeout but has received "+this.conn_.bytesReceived+" bytes.  Marking connection healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()):this.conn_&&this.conn_.bytesSent>10240?this.log_("Connection exceeded healthy timeout but has sent "+this.conn_.bytesSent+" bytes.  Leaving connection alive."):(this.log_("Closing unhealthy connection after timeout."),this.close()))}),Math.floor(i)))}nextTransportId_(){return"c:"+this.id+":"+this.connectionCount++}disconnReceiver_(e){return t=>{e===this.conn_?this.onConnectionLost_(t):e===this.secondaryConn_?(this.log_("Secondary connection lost."),this.onSecondaryConnectionLost_()):this.log_("closing an old connection")}}connReceiver_(e){return t=>{2!==this.state_&&(e===this.rx_?this.onPrimaryMessageReceived_(t):e===this.secondaryConn_?this.onSecondaryMessageReceived_(t):this.log_("message on old connection"))}}sendRequest(e){const t={t:"d",d:e};this.sendData_(t)}tryCleanupConnection(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)}onSecondaryControl_(e){if("t"in e){const t=e.t;"a"===t?this.upgradeIfSecondaryHealthy_():"r"===t?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===t&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}}onSecondaryMessageReceived_(e){const t=fr("t",e),n=fr("d",e);if("c"===t)this.onSecondaryControl_(n);else{if("d"!==t)throw new Error("Unknown protocol layer: "+t);this.pendingDataMessages.push(n)}}upgradeIfSecondaryHealthy_(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))}proceedWithUpgrade_(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()}onPrimaryMessageReceived_(e){const t=fr("t",e),n=fr("d",e);"c"===t?this.onControl_(n):"d"===t&&this.onDataMessage_(n)}onDataMessage_(e){this.onPrimaryResponse_(),this.onMessage_(e)}onPrimaryResponse_(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))}onControl_(e){const t=fr("t",e);if("d"in e){const n=e.d;if("h"===t)this.onHandshake_(n);else if("n"===t){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(let e=0;e<this.pendingDataMessages.length;++e)this.onDataMessage_(this.pendingDataMessages[e]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===t?this.onConnectionShutdown_(n):"r"===t?this.onReset_(n):"e"===t?or("Server Error: "+n):"o"===t?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):or("Unknown control packet command: "+t)}}onHandshake_(e){const t=e.ts,n=e.v,i=e.h;this.sessionId=e.s,this.repoInfo_.host=i,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,t),Sr!==n&&cr("Protocol version mismatch detected"),this.tryStartUpgrade_())}tryStartUpgrade_(){const e=this.transportManager_.upgradeTransport();e&&this.startUpgrade_(e)}startUpgrade_(e){this.secondaryConn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;const t=this.connReceiver_(this.secondaryConn_),n=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(t,n),Cr((()=>{this.secondaryConn_&&(this.log_("Timed out trying to upgrade."),this.secondaryConn_.close())}),Math.floor(6e4))}onReset_(e){this.log_("Reset packet received.  New host: "+e),this.repoInfo_.host=e,1===this.state_?this.close():(this.closeConnections_(),this.start_())}onConnectionEstablished_(e,t){this.log_("Realtime connection established."),this.conn_=e,this.state_=1,this.onReady_&&(this.onReady_(t,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):Cr((()=>{this.sendPingOnPrimaryIfNecessary_()}),Math.floor(5e3))}sendPingOnPrimaryIfNecessary_(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))}onSecondaryConnectionLost_(){const e=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==e&&this.rx_!==e||this.close()}onConnectionLost_(e){this.conn_=null,e||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(Js.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()}onConnectionShutdown_(e){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(e),this.onKill_=null),this.onDisconnect_=null,this.close()}sendData_(e){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(e)}close(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))}closeConnections_(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)}}class $r{put(e,t,n,i){}merge(e,t,n,i){}refreshAuthToken(e){}refreshAppCheckToken(e){}onDisconnectPut(e,t,n){}onDisconnectMerge(e,t,n){}onDisconnectCancel(e,t){}reportStats(e){}}class Kr{constructor(e){this.allowedEvents_=e,this.listeners_={},t(Array.isArray(e)&&e.length>0,"Requires a non-empty array")}trigger(e,...t){if(Array.isArray(this.listeners_[e])){const n=[...this.listeners_[e]];for(let e=0;e<n.length;e++)n[e].callback.apply(n[e].context,t)}}on(e,t,n){this.validateEventType_(e),this.listeners_[e]=this.listeners_[e]||[],this.listeners_[e].push({callback:t,context:n});const i=this.getInitialEvent(e);i&&t.apply(n,i)}off(e,t,n){this.validateEventType_(e);const i=this.listeners_[e]||[];for(let e=0;e<i.length;e++)if(i[e].callback===t&&(!n||n===i[e].context))return void i.splice(e,1)}validateEventType_(e){t(this.allowedEvents_.find((t=>t===e)),"Unknown event: "+e)}}class Gr extends Kr{constructor(){super(["online"]),this.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||d()||(window.addEventListener("online",(()=>{this.online_||(this.online_=!0,this.trigger("online",!0))}),!1),window.addEventListener("offline",(()=>{this.online_&&(this.online_=!1,this.trigger("online",!1))}),!1))}static getInstance(){return new Gr}getInitialEvent(e){return t("online"===e,"Unknown event type: "+e),[this.online_]}currentlyOnline(){return this.online_}}const Yr=32,Jr=768;class Qr{constructor(e,t){if(void 0===t){this.pieces_=e.split("/");let t=0;for(let e=0;e<this.pieces_.length;e++)this.pieces_[e].length>0&&(this.pieces_[t]=this.pieces_[e],t++);this.pieces_.length=t,this.pieceNum_=0}else this.pieces_=e,this.pieceNum_=t}toString(){let e="";for(let t=this.pieceNum_;t<this.pieces_.length;t++)""!==this.pieces_[t]&&(e+="/"+this.pieces_[t]);return e||"/"}}function Xr(){return new Qr("")}function Zr(e){return e.pieceNum_>=e.pieces_.length?null:e.pieces_[e.pieceNum_]}function eo(e){return e.pieces_.length-e.pieceNum_}function to(e){let t=e.pieceNum_;return t<e.pieces_.length&&t++,new Qr(e.pieces_,t)}function no(e){return e.pieceNum_<e.pieces_.length?e.pieces_[e.pieces_.length-1]:null}function io(e,t=0){return e.pieces_.slice(e.pieceNum_+t)}function so(e){if(e.pieceNum_>=e.pieces_.length)return null;const t=[];for(let n=e.pieceNum_;n<e.pieces_.length-1;n++)t.push(e.pieces_[n]);return new Qr(t,0)}function ro(e,t){const n=[];for(let t=e.pieceNum_;t<e.pieces_.length;t++)n.push(e.pieces_[t]);if(t instanceof Qr)for(let e=t.pieceNum_;e<t.pieces_.length;e++)n.push(t.pieces_[e]);else{const e=t.split("/");for(let t=0;t<e.length;t++)e[t].length>0&&n.push(e[t])}return new Qr(n,0)}function oo(e){return e.pieceNum_>=e.pieces_.length}function ao(e,t){const n=Zr(e),i=Zr(t);if(null===n)return t;if(n===i)return ao(to(e),to(t));throw new Error("INTERNAL ERROR: innerPath ("+t+") is not within outerPath ("+e+")")}function co(e,t){if(eo(e)!==eo(t))return!1;for(let n=e.pieceNum_,i=t.pieceNum_;n<=e.pieces_.length;n++,i++)if(e.pieces_[n]!==t.pieces_[i])return!1;return!0}function lo(e,t){let n=e.pieceNum_,i=t.pieceNum_;if(eo(e)>eo(t))return!1;for(;n<e.pieces_.length;){if(e.pieces_[n]!==t.pieces_[i])return!1;++n,++i}return!0}class ho{constructor(e,t){this.errorPrefix_=t,this.parts_=io(e,0),this.byteLength_=Math.max(1,this.parts_.length);for(let e=0;e<this.parts_.length;e++)this.byteLength_+=F(this.parts_[e]);uo(this)}}function uo(e){if(e.byteLength_>Jr)throw new Error(e.errorPrefix_+"has a key path longer than "+Jr+" bytes ("+e.byteLength_+").");if(e.parts_.length>Yr)throw new Error(e.errorPrefix_+"path specified exceeds the maximum depth that can be written ("+Yr+") or object contains a cycle "+po(e))}function po(e){return 0===e.parts_.length?"":"in property '"+e.parts_.join(".")+"'"}class fo extends Kr{constructor(){let e,t;super(["visible"]),"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(t="visibilitychange",e="hidden"):void 0!==document.mozHidden?(t="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(t="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(t="webkitvisibilitychange",e="webkitHidden")),this.visible_=!0,t&&document.addEventListener(t,(()=>{const t=!document[e];t!==this.visible_&&(this.visible_=t,this.trigger("visible",t))}),!1)}static getInstance(){return new fo}getInitialEvent(e){return t("visible"===e,"Unknown event type: "+e),[this.visible_]}}const _o=1e3;class mo extends $r{constructor(e,t,n,i,s,r,o,a){if(super(),this.repoInfo_=e,this.applicationId_=t,this.onDataUpdate_=n,this.onConnectStatus_=i,this.onServerInfoUpdate_=s,this.authTokenProvider_=r,this.appCheckTokenProvider_=o,this.authOverride_=a,this.id=mo.nextPersistentConnectionId_++,this.log_=rr("p:"+this.id+":"),this.interruptReasons_={},this.listens=new Map,this.outstandingPuts_=[],this.outstandingGets_=[],this.outstandingPutCount_=0,this.outstandingGetCount_=0,this.onDisconnectRequestQueue_=[],this.connected_=!1,this.reconnectDelay_=_o,this.maxReconnectDelay_=3e5,this.securityDebugCallback_=null,this.lastSessionId=null,this.establishConnectionTimer_=null,this.visible_=!1,this.requestCBHash_={},this.requestNumber_=0,this.realtime_=null,this.authToken_=null,this.appCheckToken_=null,this.forceTokenRefresh_=!1,this.invalidAuthTokenCount_=0,this.invalidAppCheckTokenCount_=0,this.firstConnection_=!0,this.lastConnectionAttemptTime_=null,this.lastConnectionEstablishedTime_=null,a&&!_())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");fo.getInstance().on("visible",this.onVisible_,this),-1===e.host.indexOf("fblocal")&&Gr.getInstance().on("online",this.onOnline_,this)}sendRequest(e,n,i){const s=++this.requestNumber_,r={r:s,a:e,b:n};this.log_(b(r)),t(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(r),i&&(this.requestCBHash_[s]=i)}get(e){this.initConnection_();const t=new h,n={action:"g",request:{p:e._path.toString(),q:e._queryObject},onComplete:e=>{const n=e.d;"ok"===e.s?t.resolve(n):t.reject(n)}};this.outstandingGets_.push(n),this.outstandingGetCount_++;const i=this.outstandingGets_.length-1;return this.connected_&&this.sendGet_(i),t.promise}listen(e,n,i,s){this.initConnection_();const r=e._queryIdentifier,o=e._path.toString();this.log_("Listen called for "+o+" "+r),this.listens.has(o)||this.listens.set(o,new Map),t(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"listen() called for non-default but complete query"),t(!this.listens.get(o).has(r),"listen() called twice for same path/queryId.");const a={onComplete:s,hashFn:n,query:e,tag:i};this.listens.get(o).set(r,a),this.connected_&&this.sendListen_(a)}sendGet_(e){const t=this.outstandingGets_[e];this.sendRequest("g",t.request,(n=>{delete this.outstandingGets_[e],this.outstandingGetCount_--,0===this.outstandingGetCount_&&(this.outstandingGets_=[]),t.onComplete&&t.onComplete(n)}))}sendListen_(e){const t=e.query,n=t._path.toString(),i=t._queryIdentifier;this.log_("Listen on "+n+" for "+i);const s={p:n};e.tag&&(s.q=t._queryObject,s.t=e.tag),s.h=e.hashFn(),this.sendRequest("q",s,(s=>{const r=s.d,o=s.s;mo.warnOnListenWarnings_(r,t),(this.listens.get(n)&&this.listens.get(n).get(i))===e&&(this.log_("listen response",s),"ok"!==o&&this.removeListen_(n,i),e.onComplete&&e.onComplete(o,r))}))}static warnOnListenWarnings_(e,t){if(e&&"object"==typeof e&&T(e,"w")){const n=k(e,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){const e='".indexOn": "'+t._queryParams.getIndex().toString()+'"',n=t._path.toString();cr(`Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding ${e} at ${n} to your security rules for better performance.`)}}}refreshAuthToken(e){this.authToken_=e,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},(()=>{})),this.reduceReconnectDelayIfAdminCredential_(e)}reduceReconnectDelayIfAdminCredential_(e){(e&&40===e.length||function(e){const t=C(e).claims;return"object"==typeof t&&!0===t.admin}(e))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)}refreshAppCheckToken(e){this.appCheckToken_=e,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},(()=>{}))}tryAuth(){if(this.connected_&&this.authToken_){const e=this.authToken_,t=function(e){const t=C(e).claims;return!!t&&"object"==typeof t&&t.hasOwnProperty("iat")}(e)?"auth":"gauth",n={cred:e};null===this.authOverride_?n.noauth=!0:"object"==typeof this.authOverride_&&(n.authvar=this.authOverride_),this.sendRequest(t,n,(t=>{const n=t.s,i=t.d||"error";this.authToken_===e&&("ok"===n?this.invalidAuthTokenCount_=0:this.onAuthRevoked_(n,i))}))}}tryAppCheck(){this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},(e=>{const t=e.s,n=e.d||"error";"ok"===t?this.invalidAppCheckTokenCount_=0:this.onAppCheckRevoked_(t,n)}))}unlisten(e,n){const i=e._path.toString(),s=e._queryIdentifier;this.log_("Unlisten called for "+i+" "+s),t(e._queryParams.isDefault()||!e._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(i,s)&&this.connected_&&this.sendUnlisten_(i,s,e._queryObject,n)}sendUnlisten_(e,t,n,i){this.log_("Unlisten on "+e+" for "+t);const s={p:e};i&&(s.q=n,s.t=i),this.sendRequest("n",s)}onDisconnectPut(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"o",data:t,onComplete:n})}onDisconnectMerge(e,t,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",e,t,n):this.onDisconnectRequestQueue_.push({pathString:e,action:"om",data:t,onComplete:n})}onDisconnectCancel(e,t){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",e,null,t):this.onDisconnectRequestQueue_.push({pathString:e,action:"oc",data:null,onComplete:t})}sendOnDisconnect_(e,t,n,i){const s={p:t,d:n};this.log_("onDisconnect "+e,s),this.sendRequest(e,s,(e=>{i&&setTimeout((()=>{i(e.s,e.d)}),Math.floor(0))}))}put(e,t,n,i){this.putInternal("p",e,t,n,i)}merge(e,t,n,i){this.putInternal("m",e,t,n,i)}putInternal(e,t,n,i,s){this.initConnection_();const r={p:t,d:n};void 0!==s&&(r.h=s),this.outstandingPuts_.push({action:e,request:r,onComplete:i}),this.outstandingPutCount_++;const o=this.outstandingPuts_.length-1;this.connected_?this.sendPut_(o):this.log_("Buffering put: "+t)}sendPut_(e){const t=this.outstandingPuts_[e].action,n=this.outstandingPuts_[e].request,i=this.outstandingPuts_[e].onComplete;this.outstandingPuts_[e].queued=this.connected_,this.sendRequest(t,n,(n=>{this.log_(t+" response",n),delete this.outstandingPuts_[e],this.outstandingPutCount_--,0===this.outstandingPutCount_&&(this.outstandingPuts_=[]),i&&i(n.s,n.d)}))}reportStats(e){if(this.connected_){const t={c:e};this.log_("reportStats",t),this.sendRequest("s",t,(e=>{if("ok"!==e.s){const t=e.d;this.log_("reportStats","Error sending stats: "+t)}}))}}onDataMessage_(e){if("r"in e){this.log_("from server: "+b(e));const t=e.r,n=this.requestCBHash_[t];n&&(delete this.requestCBHash_[t],n(e.b))}else{if("error"in e)throw"A server-side error has occurred: "+e.error;"a"in e&&this.onDataPush_(e.a,e.b)}}onDataPush_(e,t){this.log_("handleServerMessage",e,t),"d"===e?this.onDataUpdate_(t.p,t.d,!1,t.t):"m"===e?this.onDataUpdate_(t.p,t.d,!0,t.t):"c"===e?this.onListenRevoked_(t.p,t.q):"ac"===e?this.onAuthRevoked_(t.s,t.d):"apc"===e?this.onAppCheckRevoked_(t.s,t.d):"sd"===e?this.onSecurityDebugPacket_(t):or("Unrecognized action received from server: "+b(e)+"\nAre you using the latest client?")}onReady_(e,t){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(e),this.lastSessionId=t,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)}scheduleConnect_(e){t(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout((()=>{this.establishConnectionTimer_=null,this.establishConnection_()}),Math.floor(e))}initConnection_(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)}onVisible_(e){e&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=_o,this.realtime_||this.scheduleConnect_(0)),this.visible_=e}onOnline_(e){e?(this.log_("Browser went online."),this.reconnectDelay_=_o,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())}onRealtimeDisconnect_(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=_o),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());const e=(new Date).getTime()-this.lastConnectionAttemptTime_;let t=Math.max(0,this.reconnectDelay_-e);t=Math.random()*t,this.log_("Trying to reconnect in "+t+"ms"),this.scheduleConnect_(t),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)}async establishConnection_(){if(this.shouldReconnect_()){this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null;const e=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),i=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+mo.nextConnectionId_++,r=this.lastSessionId;let o=!1,a=null;const c=function(){a?a.close():(o=!0,i())},l=function(e){t(a,"sendRequest call when we're not connected not allowed."),a.sendRequest(e)};this.realtime_={close:c,sendRequest:l};const h=this.forceTokenRefresh_;this.forceTokenRefresh_=!1;try{const[t,c]=await Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)]);o?sr("getToken() completed but was canceled"):(sr("getToken() completed. Creating connection."),this.authToken_=t&&t.accessToken,this.appCheckToken_=c&&c.token,a=new Br(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,e,n,i,(e=>{cr(e+" ("+this.repoInfo_.toString()+")"),this.interrupt("server_kill")}),r))}catch(e){this.log_("Failed to get token: "+e),o||(this.repoInfo_.nodeAdmin&&cr(e),c())}}}interrupt(e){sr("Interrupting connection for reason: "+e),this.interruptReasons_[e]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())}resume(e){sr("Resuming connection for reason: "+e),delete this.interruptReasons_[e],E(this.interruptReasons_)&&(this.reconnectDelay_=_o,this.realtime_||this.scheduleConnect_(0))}handleTimestamp_(e){const t=e-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:t})}cancelSentTransactions_(){for(let e=0;e<this.outstandingPuts_.length;e++){const t=this.outstandingPuts_[e];t&&"h"in t.request&&t.queued&&(t.onComplete&&t.onComplete("disconnect"),delete this.outstandingPuts_[e],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])}onListenRevoked_(e,t){let n;n=t?t.map((e=>_r(e))).join("$"):"default";const i=this.removeListen_(e,n);i&&i.onComplete&&i.onComplete("permission_denied")}removeListen_(e,t){const n=new Qr(e).toString();let i;if(this.listens.has(n)){const e=this.listens.get(n);i=e.get(t),e.delete(t),0===e.size&&this.listens.delete(n)}else i=void 0;return i}onAuthRevoked_(e,t){sr("Auth token revoked: "+e+"/"+t),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))}onAppCheckRevoked_(e,t){sr("App check token revoked: "+e+"/"+t),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==e&&"permission_denied"!==e||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())}onSecurityDebugPacket_(e){this.securityDebugCallback_?this.securityDebugCallback_(e):"msg"in e&&console.log("FIREBASE: "+e.msg.replace("\n","\nFIREBASE: "))}restoreState_(){this.tryAuth(),this.tryAppCheck();for(const e of this.listens.values())for(const t of e.values())this.sendListen_(t);for(let e=0;e<this.outstandingPuts_.length;e++)this.outstandingPuts_[e]&&this.sendPut_(e);for(;this.onDisconnectRequestQueue_.length;){const e=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(e.action,e.pathString,e.data,e.onComplete)}for(let e=0;e<this.outstandingGets_.length;e++)this.outstandingGets_[e]&&this.sendGet_(e)}sendConnectStats_(){const e={};let t="js";_()&&(t=this.repoInfo_.nodeAdmin?"admin_node":"node"),e["sdk."+t+"."+$s.replace(/\./g,"-")]=1,d()?e["framework.cordova"]=1:f()&&(e["framework.reactnative"]=1),this.reportStats(e)}shouldReconnect_(){const e=Gr.getInstance().currentlyOnline();return E(this.interruptReasons_)&&e}}mo.nextPersistentConnectionId_=0,mo.nextConnectionId_=0;class go{constructor(e,t){this.name=e,this.node=t}static Wrap(e,t){return new go(e,t)}}class vo{getCompare(){return this.compare.bind(this)}indexedValueChanged(e,t){const n=new go(hr,e),i=new go(hr,t);return 0!==this.compare(n,i)}minPost(){return go.MIN}}let yo;class wo extends vo{static get __EMPTY_NODE(){return yo}static set __EMPTY_NODE(e){yo=e}compare(e,t){return dr(e.name,t.name)}isDefinedOn(e){throw n("KeyIndex.isDefinedOn not expected to be called.")}indexedValueChanged(e,t){return!1}minPost(){return go.MIN}maxPost(){return new go(ur,yo)}makePost(e,n){return t("string"==typeof e,"KeyIndex indexValue must always be a string."),new go(e,yo)}toString(){return".key"}}const Io=new wo;class bo{constructor(e,t,n,i,s=null){this.isReverse_=i,this.resultGenerator_=s,this.nodeStack_=[];let r=1;for(;!e.isEmpty();)if(r=t?n(e.key,t):1,i&&(r*=-1),r<0)e=this.isReverse_?e.left:e.right;else{if(0===r){this.nodeStack_.push(e);break}this.nodeStack_.push(e),e=this.isReverse_?e.right:e.left}}getNext(){if(0===this.nodeStack_.length)return null;let e,t=this.nodeStack_.pop();if(e=this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value},this.isReverse_)for(t=t.left;!t.isEmpty();)this.nodeStack_.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack_.push(t),t=t.left;return e}hasNext(){return this.nodeStack_.length>0}peek(){if(0===this.nodeStack_.length)return null;const e=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value}}}class Co{constructor(e,t,n,i,s){this.key=e,this.value=t,this.color=null!=n?n:Co.RED,this.left=null!=i?i:To.EMPTY_NODE,this.right=null!=s?s:To.EMPTY_NODE}copy(e,t,n,i,s){return new Co(null!=e?e:this.key,null!=t?t:this.value,null!=n?n:this.color,null!=i?i:this.left,null!=s?s:this.right)}count(){return this.left.count()+1+this.right.count()}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||!!e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min_(){return this.left.isEmpty()?this:this.left.min_()}minKey(){return this.min_().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,n){let i=this;const s=n(e,i.key);return i=s<0?i.copy(null,null,null,i.left.insert(e,t,n),null):0===s?i.copy(null,t,null,null,null):i.copy(null,null,null,null,i.right.insert(e,t,n)),i.fixUp_()}removeMin_(){if(this.left.isEmpty())return To.EMPTY_NODE;let e=this;return e.left.isRed_()||e.left.left.isRed_()||(e=e.moveRedLeft_()),e=e.copy(null,null,null,e.left.removeMin_(),null),e.fixUp_()}remove(e,t){let n,i;if(n=this,t(e,n.key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===t(e,n.key)){if(n.right.isEmpty())return To.EMPTY_NODE;i=n.right.min_(),n=n.copy(i.key,i.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp_()}isRed_(){return this.color}fixUp_(){let e=this;return e.right.isRed_()&&!e.left.isRed_()&&(e=e.rotateLeft_()),e.left.isRed_()&&e.left.left.isRed_()&&(e=e.rotateRight_()),e.left.isRed_()&&e.right.isRed_()&&(e=e.colorFlip_()),e}moveRedLeft_(){let e=this.colorFlip_();return e.right.left.isRed_()&&(e=e.copy(null,null,null,null,e.right.rotateRight_()),e=e.rotateLeft_(),e=e.colorFlip_()),e}moveRedRight_(){let e=this.colorFlip_();return e.left.left.isRed_()&&(e=e.rotateRight_(),e=e.colorFlip_()),e}rotateLeft_(){const e=this.copy(null,null,Co.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight_(){const e=this.copy(null,null,Co.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip_(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth_(){const e=this.check_();return Math.pow(2,e)<=this.count()+1}check_(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");const e=this.left.check_();if(e!==this.right.check_())throw new Error("Black depths differ");return e+(this.isRed_()?0:1)}}Co.RED=!0,Co.BLACK=!1;class To{constructor(e,t=To.EMPTY_NODE){this.comparator_=e,this.root_=t}insert(e,t){return new To(this.comparator_,this.root_.insert(e,t,this.comparator_).copy(null,null,Co.BLACK,null,null))}remove(e){return new To(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,Co.BLACK,null,null))}get(e){let t,n=this.root_;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t)return n.value;t<0?n=n.left:t>0&&(n=n.right)}return null}getPredecessorKey(e){let t,n=this.root_,i=null;for(;!n.isEmpty();){if(t=this.comparator_(e,n.key),0===t){if(n.left.isEmpty())return i?i.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}t<0?n=n.left:t>0&&(i=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")}isEmpty(){return this.root_.isEmpty()}count(){return this.root_.count()}minKey(){return this.root_.minKey()}maxKey(){return this.root_.maxKey()}inorderTraversal(e){return this.root_.inorderTraversal(e)}reverseTraversal(e){return this.root_.reverseTraversal(e)}getIterator(e){return new bo(this.root_,null,this.comparator_,!1,e)}getIteratorFrom(e,t){return new bo(this.root_,e,this.comparator_,!1,t)}getReverseIteratorFrom(e,t){return new bo(this.root_,e,this.comparator_,!0,t)}getReverseIterator(e){return new bo(this.root_,null,this.comparator_,!0,e)}}function ko(e,t){return dr(e.name,t.name)}function Eo(e,t){return dr(e,t)}let So;To.EMPTY_NODE=new class{copy(e,t,n,i,s){return this}insert(e,t,n){return new Co(e,t,null)}remove(e,t){return this}count(){return 0}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}check_(){return 0}isRed_(){return!1}};const No=function(e){return"number"==typeof e?"number:"+vr(e):"string:"+e},Po=function(e){if(e.isLeafNode()){const n=e.val();t("string"==typeof n||"number"==typeof n||"object"==typeof n&&T(n,".sv"),"Priority must be a string or number.")}else t(e===So||e.isEmpty(),"priority of unexpected type.");t(e===So||e.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")};let Ro,Oo,Do;class Ao{constructor(e,n=Ao.__childrenNodeConstructor.EMPTY_NODE){this.value_=e,this.priorityNode_=n,this.lazyHash_=null,t(void 0!==this.value_&&null!==this.value_,"LeafNode shouldn't be created with null/undefined value."),Po(this.priorityNode_)}static set __childrenNodeConstructor(e){Ro=e}static get __childrenNodeConstructor(){return Ro}isLeafNode(){return!0}getPriority(){return this.priorityNode_}updatePriority(e){return new Ao(this.value_,e)}getImmediateChild(e){return".priority"===e?this.priorityNode_:Ao.__childrenNodeConstructor.EMPTY_NODE}getChild(e){return oo(e)?this:".priority"===Zr(e)?this.priorityNode_:Ao.__childrenNodeConstructor.EMPTY_NODE}hasChild(){return!1}getPredecessorChildName(e,t){return null}updateImmediateChild(e,t){return".priority"===e?this.updatePriority(t):t.isEmpty()&&".priority"!==e?this:Ao.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,t).updatePriority(this.priorityNode_)}updateChild(e,n){const i=Zr(e);return null===i?n:n.isEmpty()&&".priority"!==i?this:(t(".priority"!==i||1===eo(e),".priority must be the last token in a path"),this.updateImmediateChild(i,Ao.__childrenNodeConstructor.EMPTY_NODE.updateChild(to(e),n)))}isEmpty(){return!1}numChildren(){return 0}forEachChild(e,t){return!1}val(e){return e&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()}hash(){if(null===this.lazyHash_){let e="";this.priorityNode_.isEmpty()||(e+="priority:"+No(this.priorityNode_.val())+":");const t=typeof this.value_;e+=t+":",e+="number"===t?vr(this.value_):this.value_,this.lazyHash_=er(e)}return this.lazyHash_}getValue(){return this.value_}compareTo(e){return e===Ao.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof Ao.__childrenNodeConstructor?-1:(t(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))}compareToLeafNode_(e){const n=typeof e.value_,i=typeof this.value_,s=Ao.VALUE_TYPE_ORDER.indexOf(n),r=Ao.VALUE_TYPE_ORDER.indexOf(i);return t(s>=0,"Unknown leaf type: "+n),t(r>=0,"Unknown leaf type: "+i),s===r?"object"===i?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:r-s}withIndex(){return this}isIndexed(){return!0}equals(e){if(e===this)return!0;if(e.isLeafNode()){const t=e;return this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)}return!1}}Ao.VALUE_TYPE_ORDER=["object","boolean","number","string"];const xo=new class extends vo{compare(e,t){const n=e.node.getPriority(),i=t.node.getPriority(),s=n.compareTo(i);return 0===s?dr(e.name,t.name):s}isDefinedOn(e){return!e.getPriority().isEmpty()}indexedValueChanged(e,t){return!e.getPriority().equals(t.getPriority())}minPost(){return go.MIN}maxPost(){return new go(ur,new Ao("[PRIORITY-POST]",Do))}makePost(e,t){const n=Oo(e);return new go(t,new Ao("[PRIORITY-POST]",n))}toString(){return".priority"}},Mo=Math.log(2);class Lo{constructor(e){var t;this.count=(t=e+1,parseInt(Math.log(t)/Mo,10)),this.current_=this.count-1;const n=(i=this.count,parseInt(Array(i+1).join("1"),2));var i;this.bits_=e+1&n}nextBitIsOne(){const e=!(this.bits_&1<<this.current_);return this.current_--,e}}const Fo=function(e,t,n,i){e.sort(t);const s=function(t,i){const r=i-t;let o,a;if(0===r)return null;if(1===r)return o=e[t],a=n?n(o):o,new Co(a,o.node,Co.BLACK,null,null);{const c=parseInt(r/2,10)+t,l=s(t,c),h=s(c+1,i);return o=e[c],a=n?n(o):o,new Co(a,o.node,Co.BLACK,l,h)}},r=function(t){let i=null,r=null,o=e.length;const a=function(t,i){const r=o-t,a=o;o-=t;const l=s(r+1,a),h=e[r],u=n?n(h):h;c(new Co(u,h.node,i,null,l))},c=function(e){i?(i.left=e,i=e):(r=e,i=e)};for(let e=0;e<t.count;++e){const n=t.nextBitIsOne(),i=Math.pow(2,t.count-(e+1));n?a(i,Co.BLACK):(a(i,Co.BLACK),a(i,Co.RED))}return r}(new Lo(e.length));return new To(i||t,r)};let Uo;const qo={};class jo{constructor(e,t){this.indexes_=e,this.indexSet_=t}static get Default(){return t(qo&&xo,"ChildrenNode.ts has not been loaded"),Uo=Uo||new jo({".priority":qo},{".priority":xo}),Uo}get(e){const t=k(this.indexes_,e);if(!t)throw new Error("No index defined for "+e);return t instanceof To?t:null}hasIndex(e){return T(this.indexSet_,e.toString())}addIndex(e,n){t(e!==Io,"KeyIndex always exists and isn't meant to be added to the IndexMap.");const i=[];let s=!1;const r=n.getIterator(go.Wrap);let o,a=r.getNext();for(;a;)s=s||e.isDefinedOn(a.node),i.push(a),a=r.getNext();o=s?Fo(i,e.getCompare()):qo;const c=e.toString(),l=Object.assign({},this.indexSet_);l[c]=e;const h=Object.assign({},this.indexes_);return h[c]=o,new jo(h,l)}addToIndexes(e,n){const i=S(this.indexes_,((i,s)=>{const r=k(this.indexSet_,s);if(t(r,"Missing index implementation for "+s),i===qo){if(r.isDefinedOn(e.node)){const t=[],i=n.getIterator(go.Wrap);let s=i.getNext();for(;s;)s.name!==e.name&&t.push(s),s=i.getNext();return t.push(e),Fo(t,r.getCompare())}return qo}{const t=n.get(e.name);let s=i;return t&&(s=s.remove(new go(e.name,t))),s.insert(e,e.node)}}));return new jo(i,this.indexSet_)}removeFromIndexes(e,t){const n=S(this.indexes_,(n=>{if(n===qo)return n;{const i=t.get(e.name);return i?n.remove(new go(e.name,i)):n}}));return new jo(n,this.indexSet_)}}let Wo;class Ho{constructor(e,n,i){this.children_=e,this.priorityNode_=n,this.indexMap_=i,this.lazyHash_=null,this.priorityNode_&&Po(this.priorityNode_),this.children_.isEmpty()&&t(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}static get EMPTY_NODE(){return Wo||(Wo=new Ho(new To(Eo),null,jo.Default))}isLeafNode(){return!1}getPriority(){return this.priorityNode_||Wo}updatePriority(e){return this.children_.isEmpty()?this:new Ho(this.children_,e,this.indexMap_)}getImmediateChild(e){if(".priority"===e)return this.getPriority();{const t=this.children_.get(e);return null===t?Wo:t}}getChild(e){const t=Zr(e);return null===t?this:this.getImmediateChild(t).getChild(to(e))}hasChild(e){return null!==this.children_.get(e)}updateImmediateChild(e,n){if(t(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);{const t=new go(e,n);let i,s;n.isEmpty()?(i=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(t,this.children_)):(i=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(t,this.children_));const r=i.isEmpty()?Wo:this.priorityNode_;return new Ho(i,r,s)}}updateChild(e,n){const i=Zr(e);if(null===i)return n;{t(".priority"!==Zr(e)||1===eo(e),".priority must be the last token in a path");const s=this.getImmediateChild(i).updateChild(to(e),n);return this.updateImmediateChild(i,s)}}isEmpty(){return this.children_.isEmpty()}numChildren(){return this.children_.count()}val(e){if(this.isEmpty())return null;const t={};let n=0,i=0,s=!0;if(this.forEachChild(xo,((r,o)=>{t[r]=o.val(e),n++,s&&Ho.INTEGER_REGEXP_.test(r)?i=Math.max(i,Number(r)):s=!1})),!e&&s&&i<2*n){const e=[];for(const n in t)e[n]=t[n];return e}return e&&!this.getPriority().isEmpty()&&(t[".priority"]=this.getPriority().val()),t}hash(){if(null===this.lazyHash_){let e="";this.getPriority().isEmpty()||(e+="priority:"+No(this.getPriority().val())+":"),this.forEachChild(xo,((t,n)=>{const i=n.hash();""!==i&&(e+=":"+t+":"+i)})),this.lazyHash_=""===e?"":er(e)}return this.lazyHash_}getPredecessorChildName(e,t,n){const i=this.resolveIndex_(n);if(i){const n=i.getPredecessorKey(new go(e,t));return n?n.name:null}return this.children_.getPredecessorKey(e)}getFirstChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.minKey();return e&&e.name}return this.children_.minKey()}getFirstChild(e){const t=this.getFirstChildName(e);return t?new go(t,this.children_.get(t)):null}getLastChildName(e){const t=this.resolveIndex_(e);if(t){const e=t.maxKey();return e&&e.name}return this.children_.maxKey()}getLastChild(e){const t=this.getLastChildName(e);return t?new go(t,this.children_.get(t)):null}forEachChild(e,t){const n=this.resolveIndex_(e);return n?n.inorderTraversal((e=>t(e.name,e.node))):this.children_.inorderTraversal(t)}getIterator(e){return this.getIteratorFrom(e.minPost(),e)}getIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getIteratorFrom(e,(e=>e));{const n=this.children_.getIteratorFrom(e.name,go.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)<0;)n.getNext(),i=n.peek();return n}}getReverseIterator(e){return this.getReverseIteratorFrom(e.maxPost(),e)}getReverseIteratorFrom(e,t){const n=this.resolveIndex_(t);if(n)return n.getReverseIteratorFrom(e,(e=>e));{const n=this.children_.getReverseIteratorFrom(e.name,go.Wrap);let i=n.peek();for(;null!=i&&t.compare(i,e)>0;)n.getNext(),i=n.peek();return n}}compareTo(e){return this.isEmpty()?e.isEmpty()?0:-1:e.isLeafNode()||e.isEmpty()?1:e===Vo?-1:0}withIndex(e){if(e===Io||this.indexMap_.hasIndex(e))return this;{const t=this.indexMap_.addIndex(e,this.children_);return new Ho(this.children_,this.priorityNode_,t)}}isIndexed(e){return e===Io||this.indexMap_.hasIndex(e)}equals(e){if(e===this)return!0;if(e.isLeafNode())return!1;{const t=e;if(this.getPriority().equals(t.getPriority())){if(this.children_.count()===t.children_.count()){const e=this.getIterator(xo),n=t.getIterator(xo);let i=e.getNext(),s=n.getNext();for(;i&&s;){if(i.name!==s.name||!i.node.equals(s.node))return!1;i=e.getNext(),s=n.getNext()}return null===i&&null===s}return!1}return!1}}resolveIndex_(e){return e===Io?null:this.indexMap_.get(e.toString())}}Ho.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/;const Vo=new class extends Ho{constructor(){super(new To(Eo),Ho.EMPTY_NODE,jo.Default)}compareTo(e){return e===this?0:1}equals(e){return e===this}getPriority(){return this}getImmediateChild(e){return Ho.EMPTY_NODE}isEmpty(){return!1}};Object.defineProperties(go,{MIN:{value:new go(hr,Ho.EMPTY_NODE)},MAX:{value:new go(ur,Vo)}}),wo.__EMPTY_NODE=Ho.EMPTY_NODE,Ao.__childrenNodeConstructor=Ho,So=Vo,Do=Vo;const zo=!0;function Bo(e,n=null){if(null===e)return Ho.EMPTY_NODE;if("object"==typeof e&&".priority"in e&&(n=e[".priority"]),t(null===n||"string"==typeof n||"number"==typeof n||"object"==typeof n&&".sv"in n,"Invalid priority type found: "+typeof n),"object"==typeof e&&".value"in e&&null!==e[".value"]&&(e=e[".value"]),"object"!=typeof e||".sv"in e)return new Ao(e,Bo(n));if(e instanceof Array||!zo){let t=Ho.EMPTY_NODE;return gr(e,((n,i)=>{if(T(e,n)&&"."!==n.substring(0,1)){const e=Bo(i);!e.isLeafNode()&&e.isEmpty()||(t=t.updateImmediateChild(n,e))}})),t.updatePriority(Bo(n))}{const t=[];let i=!1;if(gr(e,((e,n)=>{if("."!==e.substring(0,1)){const s=Bo(n);s.isEmpty()||(i=i||!s.getPriority().isEmpty(),t.push(new go(e,s)))}})),0===t.length)return Ho.EMPTY_NODE;const s=Fo(t,ko,(e=>e.name),Eo);if(i){const e=Fo(t,xo.getCompare());return new Ho(s,Bo(n),new jo({".priority":e},{".priority":xo}))}return new Ho(s,Bo(n),jo.Default)}}!function(e){Oo=e}(Bo);class $o extends vo{constructor(e){super(),this.indexPath_=e,t(!oo(e)&&".priority"!==Zr(e),"Can't create PathIndex with empty path or .priority key")}extractChild(e){return e.getChild(this.indexPath_)}isDefinedOn(e){return!e.getChild(this.indexPath_).isEmpty()}compare(e,t){const n=this.extractChild(e.node),i=this.extractChild(t.node),s=n.compareTo(i);return 0===s?dr(e.name,t.name):s}makePost(e,t){const n=Bo(e),i=Ho.EMPTY_NODE.updateChild(this.indexPath_,n);return new go(t,i)}maxPost(){const e=Ho.EMPTY_NODE.updateChild(this.indexPath_,Vo);return new go(ur,e)}toString(){return io(this.indexPath_,0).join("/")}}const Ko=new class extends vo{compare(e,t){const n=e.node.compareTo(t.node);return 0===n?dr(e.name,t.name):n}isDefinedOn(e){return!0}indexedValueChanged(e,t){return!e.equals(t)}minPost(){return go.MIN}maxPost(){return go.MAX}makePost(e,t){const n=Bo(e);return new go(t,n)}toString(){return".value"}};function Go(e){return{type:"value",snapshotNode:e}}function Yo(e,t){return{type:"child_added",snapshotNode:t,childName:e}}function Jo(e,t){return{type:"child_removed",snapshotNode:t,childName:e}}function Qo(e,t,n){return{type:"child_changed",snapshotNode:t,childName:e,oldSnap:n}}class Xo{constructor(e){this.index_=e}updateChild(e,n,i,s,r,o){t(e.isIndexed(this.index_),"A node must be indexed if only a child is updated");const a=e.getImmediateChild(n);return a.getChild(s).equals(i.getChild(s))&&a.isEmpty()===i.isEmpty()?e:(null!=o&&(i.isEmpty()?e.hasChild(n)?o.trackChildChange(Jo(n,a)):t(e.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?o.trackChildChange(Yo(n,i)):o.trackChildChange(Qo(n,i,a))),e.isLeafNode()&&i.isEmpty()?e:e.updateImmediateChild(n,i).withIndex(this.index_))}updateFullNode(e,t,n){return null!=n&&(e.isLeafNode()||e.forEachChild(xo,((e,i)=>{t.hasChild(e)||n.trackChildChange(Jo(e,i))})),t.isLeafNode()||t.forEachChild(xo,((t,i)=>{if(e.hasChild(t)){const s=e.getImmediateChild(t);s.equals(i)||n.trackChildChange(Qo(t,i,s))}else n.trackChildChange(Yo(t,i))}))),t.withIndex(this.index_)}updatePriority(e,t){return e.isEmpty()?Ho.EMPTY_NODE:e.updatePriority(t)}filtersNodes(){return!1}getIndexedFilter(){return this}getIndex(){return this.index_}}class Zo{constructor(e){this.indexedFilter_=new Xo(e.getIndex()),this.index_=e.getIndex(),this.startPost_=Zo.getStartPost_(e),this.endPost_=Zo.getEndPost_(e)}getStartPost(){return this.startPost_}getEndPost(){return this.endPost_}matches(e){return this.index_.compare(this.getStartPost(),e)<=0&&this.index_.compare(e,this.getEndPost())<=0}updateChild(e,t,n,i,s,r){return this.matches(new go(t,n))||(n=Ho.EMPTY_NODE),this.indexedFilter_.updateChild(e,t,n,i,s,r)}updateFullNode(e,t,n){t.isLeafNode()&&(t=Ho.EMPTY_NODE);let i=t.withIndex(this.index_);i=i.updatePriority(Ho.EMPTY_NODE);const s=this;return t.forEachChild(xo,((e,t)=>{s.matches(new go(e,t))||(i=i.updateImmediateChild(e,Ho.EMPTY_NODE))})),this.indexedFilter_.updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.indexedFilter_}getIndex(){return this.index_}static getStartPost_(e){if(e.hasStart()){const t=e.getIndexStartName();return e.getIndex().makePost(e.getIndexStartValue(),t)}return e.getIndex().minPost()}static getEndPost_(e){if(e.hasEnd()){const t=e.getIndexEndName();return e.getIndex().makePost(e.getIndexEndValue(),t)}return e.getIndex().maxPost()}}class ea{constructor(e){this.rangedFilter_=new Zo(e),this.index_=e.getIndex(),this.limit_=e.getLimit(),this.reverse_=!e.isViewFromLeft()}updateChild(e,t,n,i,s,r){return this.rangedFilter_.matches(new go(t,n))||(n=Ho.EMPTY_NODE),e.getImmediateChild(t).equals(n)?e:e.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(e,t,n,i,s,r):this.fullLimitUpdateChild_(e,t,n,s,r)}updateFullNode(e,t,n){let i;if(t.isLeafNode()||t.isEmpty())i=Ho.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<t.numChildren()&&t.isIndexed(this.index_)){let e;i=Ho.EMPTY_NODE.withIndex(this.index_),e=this.reverse_?t.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):t.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);let n=0;for(;e.hasNext()&&n<this.limit_;){const t=e.getNext();let s;if(s=this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),t)<=0:this.index_.compare(t,this.rangedFilter_.getEndPost())<=0,!s)break;i=i.updateImmediateChild(t.name,t.node),n++}}else{let e,n,s,r;if(i=t.withIndex(this.index_),i=i.updatePriority(Ho.EMPTY_NODE),this.reverse_){r=i.getReverseIterator(this.index_),e=this.rangedFilter_.getEndPost(),n=this.rangedFilter_.getStartPost();const t=this.index_.getCompare();s=(e,n)=>t(n,e)}else r=i.getIterator(this.index_),e=this.rangedFilter_.getStartPost(),n=this.rangedFilter_.getEndPost(),s=this.index_.getCompare();let o=0,a=!1;for(;r.hasNext();){const t=r.getNext();!a&&s(e,t)<=0&&(a=!0),a&&o<this.limit_&&s(t,n)<=0?o++:i=i.updateImmediateChild(t.name,Ho.EMPTY_NODE)}}return this.rangedFilter_.getIndexedFilter().updateFullNode(e,i,n)}updatePriority(e,t){return e}filtersNodes(){return!0}getIndexedFilter(){return this.rangedFilter_.getIndexedFilter()}getIndex(){return this.index_}fullLimitUpdateChild_(e,n,i,s,r){let o;if(this.reverse_){const e=this.index_.getCompare();o=(t,n)=>e(n,t)}else o=this.index_.getCompare();const a=e;t(a.numChildren()===this.limit_,"");const c=new go(n,i),l=this.reverse_?a.getFirstChild(this.index_):a.getLastChild(this.index_),h=this.rangedFilter_.matches(c);if(a.hasChild(n)){const e=a.getImmediateChild(n);let t=s.getChildAfterChild(this.index_,l,this.reverse_);for(;null!=t&&(t.name===n||a.hasChild(t.name));)t=s.getChildAfterChild(this.index_,t,this.reverse_);const u=null==t?1:o(t,c);if(h&&!i.isEmpty()&&u>=0)return null!=r&&r.trackChildChange(Qo(n,i,e)),a.updateImmediateChild(n,i);{null!=r&&r.trackChildChange(Jo(n,e));const i=a.updateImmediateChild(n,Ho.EMPTY_NODE);return null!=t&&this.rangedFilter_.matches(t)?(null!=r&&r.trackChildChange(Yo(t.name,t.node)),i.updateImmediateChild(t.name,t.node)):i}}return i.isEmpty()?e:h&&o(l,c)>=0?(null!=r&&(r.trackChildChange(Jo(l.name,l.node)),r.trackChildChange(Yo(n,i))),a.updateImmediateChild(n,i).updateImmediateChild(l.name,Ho.EMPTY_NODE)):e}}class ta{constructor(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=xo}hasStart(){return this.startSet_}hasStartAfter(){return this.startAfterSet_}hasEndBefore(){return this.endBeforeSet_}isViewFromLeft(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_}getIndexStartValue(){return t(this.startSet_,"Only valid if start has been set"),this.indexStartValue_}getIndexStartName(){return t(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:hr}hasEnd(){return this.endSet_}getIndexEndValue(){return t(this.endSet_,"Only valid if end has been set"),this.indexEndValue_}getIndexEndName(){return t(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:ur}hasLimit(){return this.limitSet_}hasAnchoredLimit(){return this.limitSet_&&""!==this.viewFrom_}getLimit(){return t(this.limitSet_,"Only valid if limit has been set"),this.limit_}getIndex(){return this.index_}loadsAllData(){return!(this.startSet_||this.endSet_||this.limitSet_)}isDefault(){return this.loadsAllData()&&this.index_===xo}copy(){const e=new ta;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e}}function na(e){const n={};if(e.isDefault())return n;let i;return e.index_===xo?i="$priority":e.index_===Ko?i="$value":e.index_===Io?i="$key":(t(e.index_ instanceof $o,"Unrecognized index type!"),i=e.index_.toString()),n.orderBy=b(i),e.startSet_&&(n.startAt=b(e.indexStartValue_),e.startNameSet_&&(n.startAt+=","+b(e.indexStartName_))),e.endSet_&&(n.endAt=b(e.indexEndValue_),e.endNameSet_&&(n.endAt+=","+b(e.indexEndName_))),e.limitSet_&&(e.isViewFromLeft()?n.limitToFirst=e.limit_:n.limitToLast=e.limit_),n}function ia(e){const t={};if(e.startSet_&&(t.sp=e.indexStartValue_,e.startNameSet_&&(t.sn=e.indexStartName_)),e.endSet_&&(t.ep=e.indexEndValue_,e.endNameSet_&&(t.en=e.indexEndName_)),e.limitSet_){t.l=e.limit_;let n=e.viewFrom_;""===n&&(n=e.isViewFromLeft()?"l":"r"),t.vf=n}return e.index_!==xo&&(t.i=e.index_.toString()),t}class sa extends $r{constructor(e,t,n,i){super(),this.repoInfo_=e,this.onDataUpdate_=t,this.authTokenProvider_=n,this.appCheckTokenProvider_=i,this.log_=rr("p:rest:"),this.listens_={}}reportStats(e){throw new Error("Method not implemented.")}static getListenId_(e,n){return void 0!==n?"tag$"+n:(t(e._queryParams.isDefault(),"should have a tag if it's not a default query."),e._path.toString())}listen(e,t,n,i){const s=e._path.toString();this.log_("Listen called for "+s+" "+e._queryIdentifier);const r=sa.getListenId_(e,n),o={};this.listens_[r]=o;const a=na(e._queryParams);this.restRequest_(s+".json",a,((e,t)=>{let a=t;if(404===e&&(a=null,e=null),null===e&&this.onDataUpdate_(s,a,!1,n),k(this.listens_,r)===o){let t;t=e?401===e?"permission_denied":"rest_error:"+e:"ok",i(t,null)}}))}unlisten(e,t){const n=sa.getListenId_(e,t);delete this.listens_[n]}get(e){const t=na(e._queryParams),n=e._path.toString(),i=new h;return this.restRequest_(n+".json",t,((e,t)=>{let s=t;404===e&&(s=null,e=null),null===e?(this.onDataUpdate_(n,s,!1,null),i.resolve(s)):i.reject(new Error(s))})),i.promise}refreshAuthToken(e){}restRequest_(e,t={},n){return t.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then((([i,s])=>{i&&i.accessToken&&(t.auth=i.accessToken),s&&s.token&&(t.ac=s.token);const r=(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host+e+"?ns="+this.repoInfo_.namespace+R(t);this.log_("Sending REST request for "+r);const o=new XMLHttpRequest;o.onreadystatechange=()=>{if(n&&4===o.readyState){this.log_("REST Response for "+r+" received. status:",o.status,"response:",o.responseText);let e=null;if(o.status>=200&&o.status<300){try{e=I(o.responseText)}catch(e){cr("Failed to parse JSON response for "+r+": "+o.responseText)}n(null,e)}else 401!==o.status&&404!==o.status&&cr("Got unsuccessful REST response for "+r+" Status: "+o.status),n(o.status);n=null}},o.open("GET",r,!0),o.send()}))}}class ra{constructor(){this.rootNode_=Ho.EMPTY_NODE}getNode(e){return this.rootNode_.getChild(e)}updateSnapshot(e,t){this.rootNode_=this.rootNode_.updateChild(e,t)}}function oa(){return{value:null,children:new Map}}function aa(e,t,n){if(oo(t))e.value=n,e.children.clear();else if(null!==e.value)e.value=e.value.updateChild(t,n);else{const i=Zr(t);e.children.has(i)||e.children.set(i,oa()),aa(e.children.get(i),t=to(t),n)}}function ca(e,t,n){null!==e.value?n(t,e.value):function(e,t){e.children.forEach(((e,n)=>{t(n,e)}))}(e,((e,i)=>{ca(i,new Qr(t.toString()+"/"+e),n)}))}class la{constructor(e){this.collection_=e,this.last_=null}get(){const e=this.collection_.get(),t=Object.assign({},e);return this.last_&&gr(this.last_,((e,n)=>{t[e]=t[e]-n})),this.last_=e,t}}class ha{constructor(e,t){this.server_=t,this.statsToReport_={},this.statsListener_=new la(e);const n=1e4+2e4*Math.random();Cr(this.reportStats_.bind(this),Math.floor(n))}reportStats_(){const e=this.statsListener_.get(),t={};let n=!1;gr(e,((e,i)=>{i>0&&T(this.statsToReport_,e)&&(t[e]=i,n=!0)})),n&&this.server_.reportStats(t),Cr(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))}}var ua,da;function pa(e){return{fromUser:!1,fromServer:!0,queryId:e,tagged:!0}}(da=ua||(ua={}))[da.OVERWRITE=0]="OVERWRITE",da[da.MERGE=1]="MERGE",da[da.ACK_USER_WRITE=2]="ACK_USER_WRITE",da[da.LISTEN_COMPLETE=3]="LISTEN_COMPLETE";class fa{constructor(e,t,n){this.path=e,this.affectedTree=t,this.revert=n,this.type=ua.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}operationForChild(e){if(oo(this.path)){if(null!=this.affectedTree.value)return t(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;{const t=this.affectedTree.subtree(new Qr(e));return new fa(Xr(),t,this.revert)}}return t(Zr(this.path)===e,"operationForChild called for unrelated child."),new fa(to(this.path),this.affectedTree,this.revert)}}class _a{constructor(e,t){this.source=e,this.path=t,this.type=ua.LISTEN_COMPLETE}operationForChild(e){return oo(this.path)?new _a(this.source,Xr()):new _a(this.source,to(this.path))}}class ma{constructor(e,t,n){this.source=e,this.path=t,this.snap=n,this.type=ua.OVERWRITE}operationForChild(e){return oo(this.path)?new ma(this.source,Xr(),this.snap.getImmediateChild(e)):new ma(this.source,to(this.path),this.snap)}}class ga{constructor(e,t,n){this.source=e,this.path=t,this.children=n,this.type=ua.MERGE}operationForChild(e){if(oo(this.path)){const t=this.children.subtree(new Qr(e));return t.isEmpty()?null:t.value?new ma(this.source,Xr(),t.value):new ga(this.source,Xr(),t)}return t(Zr(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new ga(this.source,to(this.path),this.children)}toString(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"}}class va{constructor(e,t,n){this.node_=e,this.fullyInitialized_=t,this.filtered_=n}isFullyInitialized(){return this.fullyInitialized_}isFiltered(){return this.filtered_}isCompleteForPath(e){if(oo(e))return this.isFullyInitialized()&&!this.filtered_;const t=Zr(e);return this.isCompleteForChild(t)}isCompleteForChild(e){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(e)}getNode(){return this.node_}}class ya{constructor(e){this.query_=e,this.index_=this.query_._queryParams.getIndex()}}function wa(e,t,i,s,r,o){const a=s.filter((e=>e.type===i));a.sort(((t,i)=>function(e,t,i){if(null==t.childName||null==i.childName)throw n("Should only compare child_ events.");const s=new go(t.childName,t.snapshotNode),r=new go(i.childName,i.snapshotNode);return e.index_.compare(s,r)}(e,t,i))),a.forEach((n=>{const i=function(e,t,n){return"value"===t.type||"child_removed"===t.type||(t.prevName=n.getPredecessorChildName(t.childName,t.snapshotNode,e.index_)),t}(e,n,o);r.forEach((s=>{s.respondsTo(n.type)&&t.push(s.createEvent(i,e.query_))}))}))}function Ia(e,t){return{eventCache:e,serverCache:t}}function ba(e,t,n,i){return Ia(new va(t,n,i),e.serverCache)}function Ca(e,t,n,i){return Ia(e.eventCache,new va(t,n,i))}function Ta(e){return e.eventCache.isFullyInitialized()?e.eventCache.getNode():null}function ka(e){return e.serverCache.isFullyInitialized()?e.serverCache.getNode():null}let Ea;class Sa{constructor(e,t=(()=>(Ea||(Ea=new To(pr)),Ea))()){this.value=e,this.children=t}static fromObject(e){let t=new Sa(null);return gr(e,((e,n)=>{t=t.set(new Qr(e),n)})),t}isEmpty(){return null===this.value&&this.children.isEmpty()}findRootMostMatchingPathAndValue(e,t){if(null!=this.value&&t(this.value))return{path:Xr(),value:this.value};if(oo(e))return null;{const n=Zr(e),i=this.children.get(n);if(null!==i){const s=i.findRootMostMatchingPathAndValue(to(e),t);return null!=s?{path:ro(new Qr(n),s.path),value:s.value}:null}return null}}findRootMostValueAndPath(e){return this.findRootMostMatchingPathAndValue(e,(()=>!0))}subtree(e){if(oo(e))return this;{const t=Zr(e),n=this.children.get(t);return null!==n?n.subtree(to(e)):new Sa(null)}}set(e,t){if(oo(e))return new Sa(t,this.children);{const n=Zr(e),i=(this.children.get(n)||new Sa(null)).set(to(e),t),s=this.children.insert(n,i);return new Sa(this.value,s)}}remove(e){if(oo(e))return this.children.isEmpty()?new Sa(null):new Sa(null,this.children);{const t=Zr(e),n=this.children.get(t);if(n){const i=n.remove(to(e));let s;return s=i.isEmpty()?this.children.remove(t):this.children.insert(t,i),null===this.value&&s.isEmpty()?new Sa(null):new Sa(this.value,s)}return this}}get(e){if(oo(e))return this.value;{const t=Zr(e),n=this.children.get(t);return n?n.get(to(e)):null}}setTree(e,t){if(oo(e))return t;{const n=Zr(e),i=(this.children.get(n)||new Sa(null)).setTree(to(e),t);let s;return s=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),new Sa(this.value,s)}}fold(e){return this.fold_(Xr(),e)}fold_(e,t){const n={};return this.children.inorderTraversal(((i,s)=>{n[i]=s.fold_(ro(e,i),t)})),t(e,this.value,n)}findOnPath(e,t){return this.findOnPath_(e,Xr(),t)}findOnPath_(e,t,n){const i=!!this.value&&n(t,this.value);if(i)return i;if(oo(e))return null;{const i=Zr(e),s=this.children.get(i);return s?s.findOnPath_(to(e),ro(t,i),n):null}}foreachOnPath(e,t){return this.foreachOnPath_(e,Xr(),t)}foreachOnPath_(e,t,n){if(oo(e))return this;{this.value&&n(t,this.value);const i=Zr(e),s=this.children.get(i);return s?s.foreachOnPath_(to(e),ro(t,i),n):new Sa(null)}}foreach(e){this.foreach_(Xr(),e)}foreach_(e,t){this.children.inorderTraversal(((n,i)=>{i.foreach_(ro(e,n),t)})),this.value&&t(e,this.value)}foreachChild(e){this.children.inorderTraversal(((t,n)=>{n.value&&e(t,n.value)}))}}class Na{constructor(e){this.writeTree_=e}static empty(){return new Na(new Sa(null))}}function Pa(e,t,n){if(oo(t))return new Na(new Sa(n));{const i=e.writeTree_.findRootMostValueAndPath(t);if(null!=i){const s=i.path;let r=i.value;const o=ao(s,t);return r=r.updateChild(o,n),new Na(e.writeTree_.set(s,r))}{const i=new Sa(n),s=e.writeTree_.setTree(t,i);return new Na(s)}}}function Ra(e,t,n){let i=e;return gr(n,((e,n)=>{i=Pa(i,ro(t,e),n)})),i}function Oa(e,t){if(oo(t))return Na.empty();{const n=e.writeTree_.setTree(t,new Sa(null));return new Na(n)}}function Da(e,t){return null!=Aa(e,t)}function Aa(e,t){const n=e.writeTree_.findRootMostValueAndPath(t);return null!=n?e.writeTree_.get(n.path).getChild(ao(n.path,t)):null}function xa(e){const t=[],n=e.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(xo,((e,n)=>{t.push(new go(e,n))})):e.writeTree_.children.inorderTraversal(((e,n)=>{null!=n.value&&t.push(new go(e,n.value))})),t}function Ma(e,t){if(oo(t))return e;{const n=Aa(e,t);return new Na(null!=n?new Sa(n):e.writeTree_.subtree(t))}}function La(e){return e.writeTree_.isEmpty()}function Fa(e,t){return Ua(Xr(),e.writeTree_,t)}function Ua(e,n,i){if(null!=n.value)return i.updateChild(e,n.value);{let s=null;return n.children.inorderTraversal(((n,r)=>{".priority"===n?(t(null!==r.value,"Priority writes must always be leaf nodes"),s=r.value):i=Ua(ro(e,n),r,i)})),i.getChild(e).isEmpty()||null===s||(i=i.updateChild(ro(e,".priority"),s)),i}}function qa(e,t){return Ja(t,e)}function ja(e,t){if(e.snap)return lo(e.path,t);for(const n in e.children)if(e.children.hasOwnProperty(n)&&lo(ro(e.path,n),t))return!0;return!1}function Wa(e){return e.visible}function Ha(e,t,i){let s=Na.empty();for(let r=0;r<e.length;++r){const o=e[r];if(t(o)){const e=o.path;let t;if(o.snap)lo(i,e)?(t=ao(i,e),s=Pa(s,t,o.snap)):lo(e,i)&&(t=ao(e,i),s=Pa(s,Xr(),o.snap.getChild(t)));else{if(!o.children)throw n("WriteRecord should have .snap or .children");if(lo(i,e))t=ao(i,e),s=Ra(s,t,o.children);else if(lo(e,i))if(t=ao(e,i),oo(t))s=Ra(s,Xr(),o.children);else{const e=k(o.children,Zr(t));if(e){const n=e.getChild(to(t));s=Pa(s,Xr(),n)}}}}}return s}function Va(e,t,n,i,s){if(i||s){const r=Ma(e.visibleWrites,t);if(!s&&La(r))return n;if(s||null!=n||Da(r,Xr())){const r=function(e){return(e.visible||s)&&(!i||!~i.indexOf(e.writeId))&&(lo(e.path,t)||lo(t,e.path))};return Fa(Ha(e.allWrites,r,t),n||Ho.EMPTY_NODE)}return null}{const i=Aa(e.visibleWrites,t);if(null!=i)return i;{const i=Ma(e.visibleWrites,t);return La(i)?n:null!=n||Da(i,Xr())?Fa(i,n||Ho.EMPTY_NODE):null}}}function za(e,t,n,i){return Va(e.writeTree,e.treePath,t,n,i)}function Ba(e,t){return function(e,t,n){let i=Ho.EMPTY_NODE;const s=Aa(e.visibleWrites,t);if(s)return s.isLeafNode()||s.forEachChild(xo,((e,t)=>{i=i.updateImmediateChild(e,t)})),i;if(n){const s=Ma(e.visibleWrites,t);return n.forEachChild(xo,((e,t)=>{const n=Fa(Ma(s,new Qr(e)),t);i=i.updateImmediateChild(e,n)})),xa(s).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}return xa(Ma(e.visibleWrites,t)).forEach((e=>{i=i.updateImmediateChild(e.name,e.node)})),i}(e.writeTree,e.treePath,t)}function $a(e,n,i,s){return function(e,n,i,s,r){t(s||r,"Either existingEventSnap or existingServerSnap must exist");const o=ro(n,i);if(Da(e.visibleWrites,o))return null;{const t=Ma(e.visibleWrites,o);return La(t)?r.getChild(i):Fa(t,r.getChild(i))}}(e.writeTree,e.treePath,n,i,s)}function Ka(e,t){return function(e,t){return Aa(e.visibleWrites,t)}(e.writeTree,ro(e.treePath,t))}function Ga(e,t,n){return function(e,t,n,i){const s=ro(t,n),r=Aa(e.visibleWrites,s);return null!=r?r:i.isCompleteForChild(n)?Fa(Ma(e.visibleWrites,s),i.getNode().getImmediateChild(n)):null}(e.writeTree,e.treePath,t,n)}function Ya(e,t){return Ja(ro(e.treePath,t),e.writeTree)}function Ja(e,t){return{treePath:e,writeTree:t}}class Qa{constructor(){this.changeMap=new Map}trackChildChange(e){const i=e.type,s=e.childName;t("child_added"===i||"child_changed"===i||"child_removed"===i,"Only child changes supported for tracking"),t(".priority"!==s,"Only non-priority child changes can be tracked.");const r=this.changeMap.get(s);if(r){const t=r.type;if("child_added"===i&&"child_removed"===t)this.changeMap.set(s,Qo(s,e.snapshotNode,r.snapshotNode));else if("child_removed"===i&&"child_added"===t)this.changeMap.delete(s);else if("child_removed"===i&&"child_changed"===t)this.changeMap.set(s,Jo(s,r.oldSnap));else if("child_changed"===i&&"child_added"===t)this.changeMap.set(s,Yo(s,e.snapshotNode));else{if("child_changed"!==i||"child_changed"!==t)throw n("Illegal combination of changes: "+e+" occurred after "+r);this.changeMap.set(s,Qo(s,e.snapshotNode,r.oldSnap))}}else this.changeMap.set(s,e)}getChanges(){return Array.from(this.changeMap.values())}}const Xa=new class{getCompleteChild(e){return null}getChildAfterChild(e,t,n){return null}};class Za{constructor(e,t,n=null){this.writes_=e,this.viewCache_=t,this.optCompleteServerCache_=n}getCompleteChild(e){const t=this.viewCache_.eventCache;if(t.isCompleteForChild(e))return t.getNode().getImmediateChild(e);{const t=null!=this.optCompleteServerCache_?new va(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return Ga(this.writes_,e,t)}}getChildAfterChild(e,t,n){const i=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:ka(this.viewCache_),s=function(e,t,n,i,s,r){return function(e,t,n,i,s,r,o){let a;const c=Ma(e.visibleWrites,t),l=Aa(c,Xr());if(null!=l)a=l;else{if(null==n)return[];a=Fa(c,n)}if(a=a.withIndex(o),a.isEmpty()||a.isLeafNode())return[];{const e=[],t=o.getCompare(),n=r?a.getReverseIteratorFrom(i,o):a.getIteratorFrom(i,o);let c=n.getNext();for(;c&&e.length<s;)0!==t(c,i)&&e.push(c),c=n.getNext();return e}}(e.writeTree,e.treePath,t,n,i,s,r)}(this.writes_,i,t,1,n,e);return 0===s.length?null:s[0]}}function ec(e,n,i,s,r,o){const a=n.eventCache;if(null!=Ka(s,i))return n;{let c,l;if(oo(i))if(t(n.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),n.serverCache.isFiltered()){const t=ka(n),i=Ba(s,t instanceof Ho?t:Ho.EMPTY_NODE);c=e.filter.updateFullNode(n.eventCache.getNode(),i,o)}else{const t=za(s,ka(n));c=e.filter.updateFullNode(n.eventCache.getNode(),t,o)}else{const h=Zr(i);if(".priority"===h){t(1===eo(i),"Can't have a priority with additional path components");const r=a.getNode();l=n.serverCache.getNode();const o=$a(s,i,r,l);c=null!=o?e.filter.updatePriority(r,o):a.getNode()}else{const t=to(i);let u;if(a.isCompleteForChild(h)){l=n.serverCache.getNode();const e=$a(s,i,a.getNode(),l);u=null!=e?a.getNode().getImmediateChild(h).updateChild(t,e):a.getNode().getImmediateChild(h)}else u=Ga(s,h,n.serverCache);c=null!=u?e.filter.updateChild(a.getNode(),h,u,t,r,o):a.getNode()}}return ba(n,c,a.isFullyInitialized()||oo(i),e.filter.filtersNodes())}}function tc(e,t,n,i,s,r,o,a){const c=t.serverCache;let l;const h=o?e.filter:e.filter.getIndexedFilter();if(oo(n))l=h.updateFullNode(c.getNode(),i,null);else if(h.filtersNodes()&&!c.isFiltered()){const e=c.getNode().updateChild(n,i);l=h.updateFullNode(c.getNode(),e,null)}else{const e=Zr(n);if(!c.isCompleteForPath(n)&&eo(n)>1)return t;const s=to(n),r=c.getNode().getImmediateChild(e).updateChild(s,i);l=".priority"===e?h.updatePriority(c.getNode(),r):h.updateChild(c.getNode(),e,r,s,Xa,null)}const u=Ca(t,l,c.isFullyInitialized()||oo(n),h.filtersNodes());return ec(e,u,n,s,new Za(s,u,r),a)}function nc(e,t,n,i,s,r,o){const a=t.eventCache;let c,l;const h=new Za(s,t,r);if(oo(n))l=e.filter.updateFullNode(t.eventCache.getNode(),i,o),c=ba(t,l,!0,e.filter.filtersNodes());else{const s=Zr(n);if(".priority"===s)l=e.filter.updatePriority(t.eventCache.getNode(),i),c=ba(t,l,a.isFullyInitialized(),a.isFiltered());else{const r=to(n),l=a.getNode().getImmediateChild(s);let u;if(oo(r))u=i;else{const e=h.getCompleteChild(s);u=null!=e?".priority"===no(r)&&e.getChild(so(r)).isEmpty()?e:e.updateChild(r,i):Ho.EMPTY_NODE}c=l.equals(u)?t:ba(t,e.filter.updateChild(a.getNode(),s,u,r,h,o),a.isFullyInitialized(),e.filter.filtersNodes())}}return c}function ic(e,t){return e.eventCache.isCompleteForChild(t)}function sc(e,t,n){return n.foreach(((e,n)=>{t=t.updateChild(e,n)})),t}function rc(e,t,n,i,s,r,o,a){if(t.serverCache.getNode().isEmpty()&&!t.serverCache.isFullyInitialized())return t;let c,l=t;c=oo(n)?i:new Sa(null).setTree(n,i);const h=t.serverCache.getNode();return c.children.inorderTraversal(((n,i)=>{if(h.hasChild(n)){const c=sc(0,t.serverCache.getNode().getImmediateChild(n),i);l=tc(e,l,new Qr(n),c,s,r,o,a)}})),c.children.inorderTraversal(((n,i)=>{const c=!t.serverCache.isCompleteForChild(n)&&null===i.value;if(!h.hasChild(n)&&!c){const c=sc(0,t.serverCache.getNode().getImmediateChild(n),i);l=tc(e,l,new Qr(n),c,s,r,o,a)}})),l}class oc{constructor(e,t){this.query_=e,this.eventRegistrations_=[];const n=this.query_._queryParams,i=new Xo(n.getIndex()),s=(r=n).loadsAllData()?new Xo(r.getIndex()):r.hasLimit()?new ea(r):new Zo(r);var r;this.processor_=function(e){return{filter:e}}(s);const o=t.serverCache,a=t.eventCache,c=i.updateFullNode(Ho.EMPTY_NODE,o.getNode(),null),l=s.updateFullNode(Ho.EMPTY_NODE,a.getNode(),null),h=new va(c,o.isFullyInitialized(),i.filtersNodes()),u=new va(l,a.isFullyInitialized(),s.filtersNodes());this.viewCache_=Ia(u,h),this.eventGenerator_=new ya(this.query_)}get query(){return this.query_}}function ac(e,t){const n=ka(e.viewCache_);return n&&(e.query._queryParams.loadsAllData()||!oo(t)&&!n.getImmediateChild(Zr(t)).isEmpty())?n.getChild(t):null}function cc(e){return 0===e.eventRegistrations_.length}function lc(e,n,i){const s=[];if(i){t(null==n,"A cancel should cancel all event registrations.");const r=e.query._path;e.eventRegistrations_.forEach((e=>{const t=e.createCancelEvent(i,r);t&&s.push(t)}))}if(n){let t=[];for(let i=0;i<e.eventRegistrations_.length;++i){const s=e.eventRegistrations_[i];if(s.matches(n)){if(n.hasAnyCallback()){t=t.concat(e.eventRegistrations_.slice(i+1));break}}else t.push(s)}e.eventRegistrations_=t}else e.eventRegistrations_=[];return s}function hc(e,i,s,r){i.type===ua.MERGE&&null!==i.source.queryId&&(t(ka(e.viewCache_),"We should always have a full cache before handling merges"),t(Ta(e.viewCache_),"Missing event cache, even though we have a server cache"));const o=e.viewCache_,a=function(e,i,s,r,o){const a=new Qa;let c,l;if(s.type===ua.OVERWRITE){const n=s;n.source.fromUser?c=nc(e,i,n.path,n.snap,r,o,a):(t(n.source.fromServer,"Unknown source."),l=n.source.tagged||i.serverCache.isFiltered()&&!oo(n.path),c=tc(e,i,n.path,n.snap,r,o,l,a))}else if(s.type===ua.MERGE){const n=s;n.source.fromUser?c=function(e,t,n,i,s,r,o){let a=t;return i.foreach(((i,c)=>{const l=ro(n,i);ic(t,Zr(l))&&(a=nc(e,a,l,c,s,r,o))})),i.foreach(((i,c)=>{const l=ro(n,i);ic(t,Zr(l))||(a=nc(e,a,l,c,s,r,o))})),a}(e,i,n.path,n.children,r,o,a):(t(n.source.fromServer,"Unknown source."),l=n.source.tagged||i.serverCache.isFiltered(),c=rc(e,i,n.path,n.children,r,o,l,a))}else if(s.type===ua.ACK_USER_WRITE){const n=s;c=n.revert?function(e,n,i,s,r,o){let a;if(null!=Ka(s,i))return n;{const c=new Za(s,n,r),l=n.eventCache.getNode();let h;if(oo(i)||".priority"===Zr(i)){let i;if(n.serverCache.isFullyInitialized())i=za(s,ka(n));else{const e=n.serverCache.getNode();t(e instanceof Ho,"serverChildren would be complete if leaf node"),i=Ba(s,e)}h=e.filter.updateFullNode(l,i,o)}else{const t=Zr(i);let r=Ga(s,t,n.serverCache);null==r&&n.serverCache.isCompleteForChild(t)&&(r=l.getImmediateChild(t)),h=null!=r?e.filter.updateChild(l,t,r,to(i),c,o):n.eventCache.getNode().hasChild(t)?e.filter.updateChild(l,t,Ho.EMPTY_NODE,to(i),c,o):l,h.isEmpty()&&n.serverCache.isFullyInitialized()&&(a=za(s,ka(n)),a.isLeafNode()&&(h=e.filter.updateFullNode(h,a,o)))}return a=n.serverCache.isFullyInitialized()||null!=Ka(s,Xr()),ba(n,h,a,e.filter.filtersNodes())}}(e,i,n.path,r,o,a):function(e,t,n,i,s,r,o){if(null!=Ka(s,n))return t;const a=t.serverCache.isFiltered(),c=t.serverCache;if(null!=i.value){if(oo(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return tc(e,t,n,c.getNode().getChild(n),s,r,a,o);if(oo(n)){let i=new Sa(null);return c.getNode().forEachChild(Io,((e,t)=>{i=i.set(new Qr(e),t)})),rc(e,t,n,i,s,r,a,o)}return t}{let l=new Sa(null);return i.foreach(((e,t)=>{const i=ro(n,e);c.isCompleteForPath(i)&&(l=l.set(e,c.getNode().getChild(i)))})),rc(e,t,n,l,s,r,a,o)}}(e,i,n.path,n.affectedTree,r,o,a)}else{if(s.type!==ua.LISTEN_COMPLETE)throw n("Unknown operation type: "+s.type);c=function(e,t,n,i,s){const r=t.serverCache;return ec(e,Ca(t,r.getNode(),r.isFullyInitialized()||oo(n),r.isFiltered()),n,i,Xa,s)}(e,i,s.path,r,a)}const h=a.getChanges();return function(e,t,n){const i=t.eventCache;if(i.isFullyInitialized()){const s=i.getNode().isLeafNode()||i.getNode().isEmpty(),r=Ta(e);(n.length>0||!e.eventCache.isFullyInitialized()||s&&!i.getNode().equals(r)||!i.getNode().getPriority().equals(r.getPriority()))&&n.push(Go(Ta(t)))}}(i,c,h),{viewCache:c,changes:h}}(e.processor_,o,i,s,r);var c,l;return c=e.processor_,l=a.viewCache,t(l.eventCache.getNode().isIndexed(c.filter.getIndex()),"Event snap not indexed"),t(l.serverCache.getNode().isIndexed(c.filter.getIndex()),"Server snap not indexed"),t(a.viewCache.serverCache.isFullyInitialized()||!o.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),e.viewCache_=a.viewCache,uc(e,a.changes,a.viewCache.eventCache.getNode(),null)}function uc(e,t,n,i){const s=i?[i]:e.eventRegistrations_;return function(e,t,n,i){const s=[],r=[];return t.forEach((t=>{var n;"child_changed"===t.type&&e.index_.indexedValueChanged(t.oldSnap,t.snapshotNode)&&r.push((n=t.childName,{type:"child_moved",snapshotNode:t.snapshotNode,childName:n}))})),wa(e,s,"child_removed",t,i,n),wa(e,s,"child_added",t,i,n),wa(e,s,"child_moved",r,i,n),wa(e,s,"child_changed",t,i,n),wa(e,s,"value",t,i,n),s}(e.eventGenerator_,t,n,s)}let dc,pc;class fc{constructor(){this.views=new Map}}function _c(e,n,i,s){const r=n.source.queryId;if(null!==r){const o=e.views.get(r);return t(null!=o,"SyncTree gave us an op for an invalid query."),hc(o,n,i,s)}{let t=[];for(const r of e.views.values())t=t.concat(hc(r,n,i,s));return t}}function mc(e,t,n,i,s,r){const o=function(e,t,n,i,s){const r=t._queryIdentifier,o=e.views.get(r);if(!o){let e=za(n,s?i:null),r=!1;e?r=!0:i instanceof Ho?(e=Ba(n,i),r=!1):(e=Ho.EMPTY_NODE,r=!1);const o=Ia(new va(e,r,!1),new va(i,s,!1));return new oc(t,o)}return o}(e,t,i,s,r);return e.views.has(t._queryIdentifier)||e.views.set(t._queryIdentifier,o),function(e,t){e.eventRegistrations_.push(t)}(o,n),function(e,t){const n=e.viewCache_.eventCache,i=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(xo,((e,t)=>{i.push(Yo(e,t))})),n.isFullyInitialized()&&i.push(Go(n.getNode())),uc(e,i,n.getNode(),t)}(o,n)}function gc(e){const t=[];for(const n of e.views.values())n.query._queryParams.loadsAllData()||t.push(n);return t}function vc(e,t){let n=null;for(const i of e.views.values())n=n||ac(i,t);return n}function yc(e,t){if(t._queryParams.loadsAllData())return bc(e);{const n=t._queryIdentifier;return e.views.get(n)}}function wc(e,t){return null!=yc(e,t)}function Ic(e){return null!=bc(e)}function bc(e){for(const t of e.views.values())if(t.query._queryParams.loadsAllData())return t;return null}let Cc=1;class Tc{constructor(e){this.listenProvider_=e,this.syncPointTree_=new Sa(null),this.pendingWriteTree_={visibleWrites:Na.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}function kc(e,n,i,s,r){return function(e,n,i,s,r){t(s>e.lastWriteId,"Stacking an older write on top of newer ones"),void 0===r&&(r=!0),e.allWrites.push({path:n,snap:i,writeId:s,visible:r}),r&&(e.visibleWrites=Pa(e.visibleWrites,n,i)),e.lastWriteId=s}(e.pendingWriteTree_,n,i,s,r),r?Oc(e,new ma({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},n,i)):[]}function Ec(e,n,i=!1){const s=function(e,t){for(let n=0;n<e.allWrites.length;n++){const i=e.allWrites[n];if(i.writeId===t)return i}return null}(e.pendingWriteTree_,n);if(function(e,n){const i=e.allWrites.findIndex((e=>e.writeId===n));t(i>=0,"removeWrite called with nonexistent writeId.");const s=e.allWrites[i];e.allWrites.splice(i,1);let r=s.visible,o=!1,a=e.allWrites.length-1;for(;r&&a>=0;){const t=e.allWrites[a];t.visible&&(a>=i&&ja(t,s.path)?r=!1:lo(s.path,t.path)&&(o=!0)),a--}return!!r&&(o?(function(e){e.visibleWrites=Ha(e.allWrites,Wa,Xr()),e.allWrites.length>0?e.lastWriteId=e.allWrites[e.allWrites.length-1].writeId:e.lastWriteId=-1}(e),!0):(s.snap?e.visibleWrites=Oa(e.visibleWrites,s.path):gr(s.children,(t=>{e.visibleWrites=Oa(e.visibleWrites,ro(s.path,t))})),!0))}(e.pendingWriteTree_,n)){let t=new Sa(null);return null!=s.snap?t=t.set(Xr(),!0):gr(s.children,(e=>{t=t.set(new Qr(e),!0)})),Oc(e,new fa(s.path,t,i))}return[]}function Sc(e,t,n){return Oc(e,new ma({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,n))}function Nc(e,n,i,s,r=!1){const o=n._path,a=e.syncPointTree_.get(o);let c=[];if(a&&("default"===n._queryIdentifier||wc(a,n))){const l=function(e,n,i,s){const r=n._queryIdentifier,o=[];let a=[];const c=Ic(e);if("default"===r)for(const[t,n]of e.views.entries())a=a.concat(lc(n,i,s)),cc(n)&&(e.views.delete(t),n.query._queryParams.loadsAllData()||o.push(n.query));else{const t=e.views.get(r);t&&(a=a.concat(lc(t,i,s)),cc(t)&&(e.views.delete(r),t.query._queryParams.loadsAllData()||o.push(t.query)))}return c&&!Ic(e)&&o.push(new(t(dc,"Reference.ts has not been loaded"),dc)(n._repo,n._path)),{removed:o,events:a}}(a,n,i,s);0===a.views.size&&(e.syncPointTree_=e.syncPointTree_.remove(o));const h=l.removed;if(c=l.events,!r){const t=-1!==h.findIndex((e=>e._queryParams.loadsAllData())),i=e.syncPointTree_.findOnPath(o,((e,t)=>Ic(t)));if(t&&!i){const t=e.syncPointTree_.subtree(o);if(!t.isEmpty()){const n=function(e){return e.fold(((e,t,n)=>{if(t&&Ic(t))return[bc(t)];{let e=[];return t&&(e=gc(t)),gr(n,((t,n)=>{e=e.concat(n)})),e}}))}(t);for(let t=0;t<n.length;++t){const i=n[t],s=i.query,r=xc(e,i);e.listenProvider_.startListening(jc(s),Mc(e,s),r.hashFn,r.onComplete)}}}if(!i&&h.length>0&&!s)if(t){const t=null;e.listenProvider_.stopListening(jc(n),t)}else h.forEach((t=>{const n=e.queryToTagMap.get(Lc(t));e.listenProvider_.stopListening(jc(t),n)}))}!function(e,t){for(let n=0;n<t.length;++n){const i=t[n];if(!i._queryParams.loadsAllData()){const t=Lc(i),n=e.queryToTagMap.get(t);e.queryToTagMap.delete(t),e.tagToQueryMap.delete(n)}}}(e,h)}return c}function Pc(e,n,i,s=!1){const r=n._path;let o=null,a=!1;e.syncPointTree_.foreachOnPath(r,((e,t)=>{const n=ao(e,r);o=o||vc(t,n),a=a||Ic(t)}));let c,l=e.syncPointTree_.get(r);l?(a=a||Ic(l),o=o||vc(l,Xr())):(l=new fc,e.syncPointTree_=e.syncPointTree_.set(r,l)),null!=o?c=!0:(c=!1,o=Ho.EMPTY_NODE,e.syncPointTree_.subtree(r).foreachChild(((e,t)=>{const n=vc(t,Xr());n&&(o=o.updateImmediateChild(e,n))})));const h=wc(l,n);if(!h&&!n._queryParams.loadsAllData()){const i=Lc(n);t(!e.queryToTagMap.has(i),"View does not exist, but we have a tag");const s=Cc++;e.queryToTagMap.set(i,s),e.tagToQueryMap.set(s,i)}let u=mc(l,n,i,qa(e.pendingWriteTree_,r),o,c);if(!h&&!a&&!s){const i=yc(l,n);u=u.concat(function(e,n,i){const s=n._path,r=Mc(e,n),o=xc(e,i),a=e.listenProvider_.startListening(jc(n),r,o.hashFn,o.onComplete),c=e.syncPointTree_.subtree(s);if(r)t(!Ic(c.value),"If we're adding a query, it shouldn't be shadowed");else{const t=c.fold(((e,t,n)=>{if(!oo(e)&&t&&Ic(t))return[bc(t).query];{let e=[];return t&&(e=e.concat(gc(t).map((e=>e.query)))),gr(n,((t,n)=>{e=e.concat(n)})),e}}));for(let n=0;n<t.length;++n){const i=t[n];e.listenProvider_.stopListening(jc(i),Mc(e,i))}}return a}(e,n,i))}return u}function Rc(e,t,n){const i=e.pendingWriteTree_,s=e.syncPointTree_.findOnPath(t,((e,n)=>{const i=vc(n,ao(e,t));if(i)return i}));return Va(i,t,s,n,!0)}function Oc(e,t){return Dc(t,e.syncPointTree_,null,qa(e.pendingWriteTree_,Xr()))}function Dc(e,t,n,i){if(oo(e.path))return Ac(e,t,n,i);{const s=t.get(Xr());null==n&&null!=s&&(n=vc(s,Xr()));let r=[];const o=Zr(e.path),a=e.operationForChild(o),c=t.children.get(o);if(c&&a){const e=n?n.getImmediateChild(o):null,t=Ya(i,o);r=r.concat(Dc(a,c,e,t))}return s&&(r=r.concat(_c(s,e,i,n))),r}}function Ac(e,t,n,i){const s=t.get(Xr());null==n&&null!=s&&(n=vc(s,Xr()));let r=[];return t.children.inorderTraversal(((t,s)=>{const o=n?n.getImmediateChild(t):null,a=Ya(i,t),c=e.operationForChild(t);c&&(r=r.concat(Ac(c,s,o,a)))})),s&&(r=r.concat(_c(s,e,i,n))),r}function xc(e,t){const n=t.query,i=Mc(e,n);return{hashFn:()=>{const e=function(e){return e.viewCache_.serverCache.getNode()}(t)||Ho.EMPTY_NODE;return e.hash()},onComplete:t=>{if("ok"===t)return i?function(e,t,n){const i=Fc(e,n);if(i){const n=Uc(i),s=n.path,r=n.queryId,o=ao(s,t);return qc(e,s,new _a(pa(r),o))}return[]}(e,n._path,i):function(e,t){return Oc(e,new _a({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t))}(e,n._path);{const i=function(e,t){let n="Unknown Error";"too_big"===e?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===e?n="Client doesn't have permission to access the desired data.":"unavailable"===e&&(n="The service is unavailable");const i=new Error(e+" at "+t._path.toString()+": "+n);return i.code=e.toUpperCase(),i}(t,n);return Nc(e,n,null,i)}}}}function Mc(e,t){const n=Lc(t);return e.queryToTagMap.get(n)}function Lc(e){return e._path.toString()+"$"+e._queryIdentifier}function Fc(e,t){return e.tagToQueryMap.get(t)}function Uc(e){const n=e.indexOf("$");return t(-1!==n&&n<e.length-1,"Bad queryKey."),{queryId:e.substr(n+1),path:new Qr(e.substr(0,n))}}function qc(e,n,i){const s=e.syncPointTree_.get(n);return t(s,"Missing sync point for query tag that we're tracking"),_c(s,i,qa(e.pendingWriteTree_,n),null)}function jc(e){return e._queryParams.loadsAllData()&&!e._queryParams.isDefault()?new(t(pc,"Reference.ts has not been loaded"),pc)(e._repo,e._path):e}class Wc{constructor(e){this.node_=e}getImmediateChild(e){const t=this.node_.getImmediateChild(e);return new Wc(t)}node(){return this.node_}}class Hc{constructor(e,t){this.syncTree_=e,this.path_=t}getImmediateChild(e){const t=ro(this.path_,e);return new Hc(this.syncTree_,t)}node(){return Rc(this.syncTree_,this.path_)}}const Vc=function(e){return(e=e||{}).timestamp=e.timestamp||(new Date).getTime(),e},zc=function(e,n,i){return e&&"object"==typeof e?(t(".sv"in e,"Unexpected leaf node or priority contents"),"string"==typeof e[".sv"]?Bc(e[".sv"],n,i):"object"==typeof e[".sv"]?$c(e[".sv"],n):void t(!1,"Unexpected server value: "+JSON.stringify(e,null,2))):e},Bc=function(e,n,i){if("timestamp"===e)return i.timestamp;t(!1,"Unexpected server value: "+e)},$c=function(e,n,i){e.hasOwnProperty("increment")||t(!1,"Unexpected server value: "+JSON.stringify(e,null,2));const s=e.increment;"number"!=typeof s&&t(!1,"Unexpected increment value: "+s);const r=n.node();if(t(null!=r,"Expected ChildrenNode.EMPTY_NODE for nulls"),!r.isLeafNode())return s;const o=r.getValue();return"number"!=typeof o?s:o+s},Kc=function(e,t,n,i){return Yc(t,new Hc(n,e),i)},Gc=function(e,t,n){return Yc(e,new Wc(t),n)};function Yc(e,t,n){const i=e.getPriority().val(),s=zc(i,t.getImmediateChild(".priority"),n);let r;if(e.isLeafNode()){const i=e,r=zc(i.getValue(),t,n);return r!==i.getValue()||s!==i.getPriority().val()?new Ao(r,Bo(s)):e}{const i=e;return r=i,s!==i.getPriority().val()&&(r=r.updatePriority(new Ao(s))),i.forEachChild(xo,((e,i)=>{const s=Yc(i,t.getImmediateChild(e),n);s!==i&&(r=r.updateImmediateChild(e,s))})),r}}class Jc{constructor(e="",t=null,n={children:{},childCount:0}){this.name=e,this.parent=t,this.node=n}}function Qc(e,t){let n=t instanceof Qr?t:new Qr(t),i=e,s=Zr(n);for(;null!==s;){const e=k(i.node.children,s)||{children:{},childCount:0};i=new Jc(s,i,e),n=to(n),s=Zr(n)}return i}function Xc(e){return e.node.value}function Zc(e,t){e.node.value=t,sl(e)}function el(e){return e.node.childCount>0}function tl(e,t){gr(e.node.children,((n,i)=>{t(new Jc(n,e,i))}))}function nl(e,t,n,i){n&&!i&&t(e),tl(e,(e=>{nl(e,t,!0,i)})),n&&i&&t(e)}function il(e){return new Qr(null===e.parent?e.name:il(e.parent)+"/"+e.name)}function sl(e){null!==e.parent&&function(e,t,n){const i=function(e){return void 0===Xc(e)&&!el(e)}(n),s=T(e.node.children,t);i&&s?(delete e.node.children[t],e.node.childCount--,sl(e)):i||s||(e.node.children[t]=n.node,e.node.childCount++,sl(e))}(e.parent,e.name,e)}const rl=/[\[\].#$\/\u0000-\u001F\u007F]/,ol=/[\[\].#$\u0000-\u001F\u007F]/,al=10485760,cl=function(e){return"string"==typeof e&&0!==e.length&&!rl.test(e)},ll=function(e){return"string"==typeof e&&0!==e.length&&!ol.test(e)},hl=function(e,t,n,i){i&&void 0===t||ul(L(e,"value"),t,n)},ul=function(e,t,n){const i=n instanceof Qr?new ho(n,e):n;if(void 0===t)throw new Error(e+"contains undefined "+po(i));if("function"==typeof t)throw new Error(e+"contains a function "+po(i)+" with contents = "+t.toString());if(lr(t))throw new Error(e+"contains "+t.toString()+" "+po(i));if("string"==typeof t&&t.length>al/3&&F(t)>al)throw new Error(e+"contains a string greater than "+al+" utf8 bytes "+po(i)+" ('"+t.substring(0,50)+"...')");if(t&&"object"==typeof t){let n=!1,s=!1;if(gr(t,((t,r)=>{if(".value"===t)n=!0;else if(".priority"!==t&&".sv"!==t&&(s=!0,!cl(t)))throw new Error(e+" contains an invalid key ("+t+") "+po(i)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');!function(e,t){e.parts_.length>0&&(e.byteLength_+=1),e.parts_.push(t),e.byteLength_+=F(t),uo(e)}(i,t),ul(e,r,i),function(e){const t=e.parts_.pop();e.byteLength_-=F(t),e.parts_.length>0&&(e.byteLength_-=1)}(i)})),n&&s)throw new Error(e+' contains ".value" child '+po(i)+" in addition to actual children.")}},dl=function(e,t,n,i){if(!(i&&void 0===n||ll(n)))throw new Error(L(e,t)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},pl=function(e,t,n,i){n&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),dl(e,t,n,i)},fl=function(e,t){if(".info"===Zr(t))throw new Error(e+" failed = Can't modify data under /.info/")},_l=function(e,t){const n=t.path.toString();if("string"!=typeof t.repoInfo.host||0===t.repoInfo.host.length||!cl(t.repoInfo.namespace)&&"localhost"!==t.repoInfo.host.split(":")[0]||0!==n.length&&!function(e){return e&&(e=e.replace(/^\/*\.info(\/|$)/,"/")),ll(e)}(n))throw new Error(L(e,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')};class ml{constructor(){this.eventLists_=[],this.recursionDepth_=0}}function gl(e,t){let n=null;for(let i=0;i<t.length;i++){const s=t[i],r=s.getPath();null===n||co(r,n.path)||(e.eventLists_.push(n),n=null),null===n&&(n={events:[],path:r}),n.events.push(s)}n&&e.eventLists_.push(n)}function vl(e,t,n){gl(e,n),wl(e,(e=>co(e,t)))}function yl(e,t,n){gl(e,n),wl(e,(e=>lo(e,t)||lo(t,e)))}function wl(e,t){e.recursionDepth_++;let n=!0;for(let i=0;i<e.eventLists_.length;i++){const s=e.eventLists_[i];s&&(t(s.path)?(Il(e.eventLists_[i]),e.eventLists_[i]=null):n=!1)}n&&(e.eventLists_=[]),e.recursionDepth_--}function Il(e){for(let t=0;t<e.events.length;t++){const n=e.events[t];if(null!==n){e.events[t]=null;const i=n.getEventRunner();nr&&sr("event: "+n.toString()),Ir(i)}}}const bl="repo_interrupt",Cl=25;class Tl{constructor(e,t,n,i){this.repoInfo_=e,this.forceRestClient_=t,this.authTokenProvider_=n,this.appCheckProvider_=i,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new ml,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=oa(),this.transactionQueueTree_=new Jc,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}toString(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host}}function kl(e,t,n){if(e.stats_=Fr(e.repoInfo_),e.forceRestClient_||br())e.server_=new sa(e.repoInfo_,((t,n,i,s)=>{Nl(e,t,n,i,s)}),e.authTokenProvider_,e.appCheckProvider_),setTimeout((()=>Pl(e,!0)),0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{b(n)}catch(e){throw new Error("Invalid authOverride provided: "+e)}}e.persistentConnection_=new mo(e.repoInfo_,t,((t,n,i,s)=>{Nl(e,t,n,i,s)}),(t=>{Pl(e,t)}),(t=>{!function(e,t){gr(t,((t,n)=>{Rl(e,t,n)}))}(e,t)}),e.authTokenProvider_,e.appCheckProvider_,n),e.server_=e.persistentConnection_}e.authTokenProvider_.addTokenChangeListener((t=>{e.server_.refreshAuthToken(t)})),e.appCheckProvider_.addTokenChangeListener((t=>{e.server_.refreshAppCheckToken(t.token)})),e.statsReporter_=function(t,n){const i=t.toString();return Lr[i]||(Lr[i]=new ha(e.stats_,e.server_)),Lr[i]}(e.repoInfo_),e.infoData_=new ra,e.infoSyncTree_=new Tc({startListening:(t,n,i,s)=>{let r=[];const o=e.infoData_.getNode(t._path);return o.isEmpty()||(r=Sc(e.infoSyncTree_,t._path,o),setTimeout((()=>{s("ok")}),0)),r},stopListening:()=>{}}),Rl(e,"connected",!1),e.serverSyncTree_=new Tc({startListening:(t,n,i,s)=>(e.server_.listen(t,i,n,((n,i)=>{const r=s(n,i);yl(e.eventQueue_,t._path,r)})),[]),stopListening:(t,n)=>{e.server_.unlisten(t,n)}})}function El(e){const t=e.infoData_.getNode(new Qr(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+t}function Sl(e){return Vc({timestamp:El(e)})}function Nl(e,t,n,i,s){e.dataUpdateCount++;const r=new Qr(t);n=e.interceptServerDataCallback_?e.interceptServerDataCallback_(t,n):n;let o=[];if(s)if(i){const t=S(n,(e=>Bo(e)));o=function(e,t,n,i){const s=Fc(e,i);if(s){const i=Uc(s),r=i.path,o=i.queryId,a=ao(r,t),c=Sa.fromObject(n);return qc(e,r,new ga(pa(o),a,c))}return[]}(e.serverSyncTree_,r,t,s)}else{const t=Bo(n);o=function(e,t,n,i){const s=Fc(e,i);if(null!=s){const i=Uc(s),r=i.path,o=i.queryId,a=ao(r,t);return qc(e,r,new ma(pa(o),a,n))}return[]}(e.serverSyncTree_,r,t,s)}else if(i){const t=S(n,(e=>Bo(e)));o=function(e,t,n){const i=Sa.fromObject(n);return Oc(e,new ga({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},t,i))}(e.serverSyncTree_,r,t)}else{const t=Bo(n);o=Sc(e.serverSyncTree_,r,t)}let a=r;o.length>0&&(a=Fl(e,r)),yl(e.eventQueue_,a,o)}function Pl(e,t){Rl(e,"connected",t),!1===t&&function(e){xl(e,"onDisconnectEvents");const t=Sl(e),n=oa();ca(e.onDisconnect_,Xr(),((i,s)=>{const r=Kc(i,s,e.serverSyncTree_,t);aa(n,i,r)}));let i=[];ca(n,Xr(),((t,n)=>{i=i.concat(Sc(e.serverSyncTree_,t,n));const s=Hl(e,t);Fl(e,s)})),e.onDisconnect_=oa(),yl(e.eventQueue_,Xr(),i)}(e)}function Rl(e,t,n){const i=new Qr("/.info/"+t),s=Bo(n);e.infoData_.updateSnapshot(i,s);const r=Sc(e.infoSyncTree_,i,s);yl(e.eventQueue_,i,r)}function Ol(e){return e.nextWriteId_++}function Dl(e,t,n,i,s){xl(e,"set",{path:t.toString(),value:n,priority:i});const r=Sl(e),o=Bo(n,i),a=Rc(e.serverSyncTree_,t),c=Gc(o,a,r),l=Ol(e),h=kc(e.serverSyncTree_,t,c,l,!0);gl(e.eventQueue_,h),e.server_.put(t.toString(),o.val(!0),((n,i)=>{const r="ok"===n;r||cr("set at "+t+" failed: "+n);const o=Ec(e.serverSyncTree_,l,!r);yl(e.eventQueue_,t,o),function(e,t,n,i){t&&Ir((()=>{if("ok"===n)t(null);else{const e=(n||"error").toUpperCase();let s=e;i&&(s+=": "+i);const r=new Error(s);r.code=e,t(r)}}))}(0,s,n,i)}));const u=Hl(e,t);Fl(e,u),yl(e.eventQueue_,u,[])}function Al(e,t,n){let i;i=".info"===Zr(t._path)?Nc(e.infoSyncTree_,t,n):Nc(e.serverSyncTree_,t,n),vl(e.eventQueue_,t._path,i)}function xl(e,...t){let n="";e.persistentConnection_&&(n=e.persistentConnection_.id+":"),sr(n,...t)}function Ml(e,t,n){return Rc(e.serverSyncTree_,t,n)||Ho.EMPTY_NODE}function Ll(e,n=e.transactionQueueTree_){if(n||Wl(e,n),Xc(n)){const i=ql(e,n);t(i.length>0,"Sending zero length transaction queue"),i.every((e=>0===e.status))&&function(e,n,i){const s=i.map((e=>e.currentWriteId)),r=Ml(e,n,s);let o=r;const a=r.hash();for(let e=0;e<i.length;e++){const s=i[e];t(0===s.status,"tryToSendTransactionQueue_: items in queue should all be run."),s.status=1,s.retryCount++;const r=ao(n,s.path);o=o.updateChild(r,s.currentOutputSnapshotRaw)}const c=o.val(!0),l=n;e.server_.put(l.toString(),c,(t=>{xl(e,"transaction put response",{path:l.toString(),status:t});let s=[];if("ok"===t){const t=[];for(let n=0;n<i.length;n++)i[n].status=2,s=s.concat(Ec(e.serverSyncTree_,i[n].currentWriteId)),i[n].onComplete&&t.push((()=>i[n].onComplete(null,!0,i[n].currentOutputSnapshotResolved))),i[n].unwatcher();Wl(e,Qc(e.transactionQueueTree_,n)),Ll(e,e.transactionQueueTree_),yl(e.eventQueue_,n,s);for(let e=0;e<t.length;e++)Ir(t[e])}else{if("datastale"===t)for(let e=0;e<i.length;e++)3===i[e].status?i[e].status=4:i[e].status=0;else{cr("transaction at "+l.toString()+" failed: "+t);for(let e=0;e<i.length;e++)i[e].status=4,i[e].abortReason=t}Fl(e,n)}}),a)}(e,il(n),i)}else el(n)&&tl(n,(t=>{Ll(e,t)}))}function Fl(e,n){const i=Ul(e,n),s=il(i);return function(e,n,i){if(0===n.length)return;const s=[];let r=[];const o=n.filter((e=>0===e.status)).map((e=>e.currentWriteId));for(let c=0;c<n.length;c++){const l=n[c],h=ao(i,l.path);let u,d=!1;if(t(null!==h,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)d=!0,u=l.abortReason,r=r.concat(Ec(e.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=Cl)d=!0,u="maxretry",r=r.concat(Ec(e.serverSyncTree_,l.currentWriteId,!0));else{const t=Ml(e,l.path,o);l.currentInputSnapshot=t;const i=n[c].update(t.val());if(void 0!==i){ul("transaction failed: Data returned ",i,l.path);let n=Bo(i);"object"==typeof i&&null!=i&&T(i,".priority")||(n=n.updatePriority(t.getPriority()));const s=l.currentWriteId,a=Sl(e),c=Gc(n,t,a);l.currentOutputSnapshotRaw=n,l.currentOutputSnapshotResolved=c,l.currentWriteId=Ol(e),o.splice(o.indexOf(s),1),r=r.concat(kc(e.serverSyncTree_,l.path,c,l.currentWriteId,l.applyLocally)),r=r.concat(Ec(e.serverSyncTree_,s,!0))}else d=!0,u="nodata",r=r.concat(Ec(e.serverSyncTree_,l.currentWriteId,!0))}yl(e.eventQueue_,i,r),r=[],d&&(n[c].status=2,a=n[c].unwatcher,setTimeout(a,Math.floor(0)),n[c].onComplete&&("nodata"===u?s.push((()=>n[c].onComplete(null,!1,n[c].currentInputSnapshot))):s.push((()=>n[c].onComplete(new Error(u),!1,null)))))}var a;Wl(e,e.transactionQueueTree_);for(let e=0;e<s.length;e++)Ir(s[e]);Ll(e,e.transactionQueueTree_)}(e,ql(e,i),s),s}function Ul(e,t){let n,i=e.transactionQueueTree_;for(n=Zr(t);null!==n&&void 0===Xc(i);)i=Qc(i,n),n=Zr(t=to(t));return i}function ql(e,t){const n=[];return jl(e,t,n),n.sort(((e,t)=>e.order-t.order)),n}function jl(e,t,n){const i=Xc(t);if(i)for(let e=0;e<i.length;e++)n.push(i[e]);tl(t,(t=>{jl(e,t,n)}))}function Wl(e,t){const n=Xc(t);if(n){let e=0;for(let t=0;t<n.length;t++)2!==n[t].status&&(n[e]=n[t],e++);n.length=e,Zc(t,n.length>0?n:void 0)}tl(t,(t=>{Wl(e,t)}))}function Hl(e,t){const n=il(Ul(e,t)),i=Qc(e.transactionQueueTree_,t);return function(e,t,n){let i=e.parent;for(;null!==i;){if(t(i))return!0;i=i.parent}}(i,(t=>{Vl(e,t)})),Vl(e,i),nl(i,(t=>{Vl(e,t)})),n}function Vl(e,n){const i=Xc(n);if(i){const s=[];let r=[],o=-1;for(let n=0;n<i.length;n++)3===i[n].status||(1===i[n].status?(t(o===n-1,"All SENT items should be at beginning of queue."),o=n,i[n].status=3,i[n].abortReason="set"):(t(0===i[n].status,"Unexpected transaction status in abort"),i[n].unwatcher(),r=r.concat(Ec(e.serverSyncTree_,i[n].currentWriteId,!0)),i[n].onComplete&&s.push(i[n].onComplete.bind(null,new Error("set"),!1,null))));-1===o?Zc(n,void 0):i.length=o+1,yl(e.eventQueue_,il(n),r);for(let e=0;e<s.length;e++)Ir(s[e])}}const zl=function(e,t){const n=Bl(e),i=n.namespace;"firebase.com"===n.domain&&ar(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),i&&"undefined"!==i||"localhost"===n.domain||ar("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&cr("Insecure Firebase access from a secure page. Please use https in calls to new Firebase().");const s="ws"===n.scheme||"wss"===n.scheme;return{repoInfo:new Dr(n.host,n.secure,i,s,t,"",i!==n.subdomain),path:new Qr(n.pathString)}},Bl=function(e){let t="",n="",i="",s="",r="",o=!0,a="https",c=443;if("string"==typeof e){let l=e.indexOf("//");l>=0&&(a=e.substring(0,l-1),e=e.substring(l+2));let h=e.indexOf("/");-1===h&&(h=e.length);let u=e.indexOf("?");-1===u&&(u=e.length),t=e.substring(0,Math.min(h,u)),h<u&&(s=function(e){let t="";const n=e.split("/");for(let e=0;e<n.length;e++)if(n[e].length>0){let i=n[e];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(e){}t+="/"+i}return t}(e.substring(h,u)));const d=function(e){const t={};"?"===e.charAt(0)&&(e=e.substring(1));for(const n of e.split("&")){if(0===n.length)continue;const i=n.split("=");2===i.length?t[decodeURIComponent(i[0])]=decodeURIComponent(i[1]):cr(`Invalid query segment '${n}' in query '${e}'`)}return t}(e.substring(Math.min(e.length,u)));l=t.indexOf(":"),l>=0?(o="https"===a||"wss"===a,c=parseInt(t.substring(l+1),10)):l=t.length;const p=t.slice(0,l);if("localhost"===p.toLowerCase())n="localhost";else if(p.split(".").length<=2)n=p;else{const e=t.indexOf(".");i=t.substring(0,e).toLowerCase(),n=t.substring(e+1),r=i}"ns"in d&&(r=d.ns)}return{host:t,port:c,domain:n,subdomain:i,secure:o,scheme:a,pathString:s,namespace:r}};class $l{constructor(e,t,n,i){this.eventType=e,this.eventRegistration=t,this.snapshot=n,this.prevName=i}getPath(){const e=this.snapshot.ref;return"value"===this.eventType?e._path:e.parent._path}getEventType(){return this.eventType}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.getPath().toString()+":"+this.eventType+":"+b(this.snapshot.exportVal())}}class Kl{constructor(e,t,n){this.eventRegistration=e,this.error=t,this.path=n}getPath(){return this.path}getEventType(){return"cancel"}getEventRunner(){return this.eventRegistration.getEventRunner(this)}toString(){return this.path.toString()+":cancel"}}class Gl{constructor(e,t){this.snapshotCallback=e,this.cancelCallback=t}onValue(e,t){this.snapshotCallback.call(null,e,t)}onCancel(e){return t(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,e)}get hasCancelCallback(){return!!this.cancelCallback}matches(e){return this.snapshotCallback===e.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===e.snapshotCallback.userCallback&&this.snapshotCallback.context===e.snapshotCallback.context}}class Yl{constructor(e,t,n,i){this._repo=e,this._path=t,this._queryParams=n,this._orderByCalled=i}get key(){return oo(this._path)?null:no(this._path)}get ref(){return new Jl(this._repo,this._path)}get _queryIdentifier(){const e=ia(this._queryParams),t=_r(e);return"{}"===t?"default":t}get _queryObject(){return ia(this._queryParams)}isEqual(e){if(!((e=V(e))instanceof Yl))return!1;const t=this._repo===e._repo,n=co(this._path,e._path),i=this._queryIdentifier===e._queryIdentifier;return t&&n&&i}toJSON(){return this.toString()}toString(){return this._repo.toString()+function(e){let t="";for(let n=e.pieceNum_;n<e.pieces_.length;n++)""!==e.pieces_[n]&&(t+="/"+encodeURIComponent(String(e.pieces_[n])));return t||"/"}(this._path)}}class Jl extends Yl{constructor(e,t){super(e,t,new ta,!1)}get parent(){const e=so(this._path);return null===e?null:new Jl(this._repo,e)}get root(){let e=this;for(;null!==e.parent;)e=e.parent;return e}}class Ql{constructor(e,t,n){this._node=e,this.ref=t,this._index=n}get priority(){return this._node.getPriority().val()}get key(){return this.ref.key}get size(){return this._node.numChildren()}child(e){const t=new Qr(e),n=Zl(this.ref,e);return new Ql(this._node.getChild(t),n,xo)}exists(){return!this._node.isEmpty()}exportVal(){return this._node.val(!0)}forEach(e){return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,((t,n)=>e(new Ql(n,Zl(this.ref,t),xo))))}hasChild(e){const t=new Qr(e);return!this._node.getChild(t).isEmpty()}hasChildren(){return!this._node.isLeafNode()&&!this._node.isEmpty()}toJSON(){return this.exportVal()}val(){return this._node.val()}}function Xl(e,t){return(e=V(e))._checkNotDeleted("ref"),void 0!==t?Zl(e._root,t):e._root}function Zl(e,t){return null===Zr((e=V(e))._path)?pl("child","path",t,!1):dl("child","path",t,!1),new Jl(e._repo,ro(e._path,t))}function eh(e,t){e=V(e),fl("set",e._path),hl("set",t,e._path,!1);const n=new h;return Dl(e._repo,e._path,t,null,n.wrapCallback((()=>{}))),n.promise}class th{constructor(e){this.callbackContext=e}respondsTo(e){return"value"===e}createEvent(e,t){const n=t._queryParams.getIndex();return new $l("value",this,new Ql(e.snapshotNode,new Jl(t._repo,t._path),n))}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,null)}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Kl(this,e,t):null}matches(e){return e instanceof th&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))}hasAnyCallback(){return null!==this.callbackContext}}class nh{constructor(e,t){this.eventType=e,this.callbackContext=t}respondsTo(e){let t="children_added"===e?"child_added":e;return t="children_removed"===t?"child_removed":t,this.eventType===t}createCancelEvent(e,t){return this.callbackContext.hasCancelCallback?new Kl(this,e,t):null}createEvent(e,n){t(null!=e.childName,"Child events should have a childName.");const i=Zl(new Jl(n._repo,n._path),e.childName),s=n._queryParams.getIndex();return new $l(e.type,this,new Ql(e.snapshotNode,i,s),e.prevName)}getEventRunner(e){return"cancel"===e.getEventType()?()=>this.callbackContext.onCancel(e.error):()=>this.callbackContext.onValue(e.snapshot,e.prevName)}matches(e){return e instanceof nh&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))}hasAnyCallback(){return!!this.callbackContext}}function ih(e,t,n,i){return function(e,t,n,i,s){let r;if("object"==typeof i&&(r=void 0,s=i),"function"==typeof i&&(r=i),s&&s.onlyOnce){const t=n,i=(n,i)=>{Al(e._repo,e,a),t(n,i)};i.userCallback=n.userCallback,i.context=n.context,n=i}const o=new Gl(n,r||void 0),a="value"===t?new th(o):new nh(t,o);return function(e,t,n){let i;i=".info"===Zr(t._path)?Pc(e.infoSyncTree_,t,n):Pc(e.serverSyncTree_,t,n),vl(e.eventQueue_,t._path,i)}(e._repo,e,a),()=>Al(e._repo,e,a)}(e,"value",t,n,i)}!function(e){t(!dc,"__referenceConstructor has already been defined"),dc=e}(Jl),function(e){t(!pc,"__referenceConstructor has already been defined"),pc=e}(Jl);const sh="FIREBASE_DATABASE_EMULATOR_HOST",rh={};let oh=!1;class ah{constructor(e,t){this._repoInternal=e,this.app=t,this.type="database",this._instanceStarted=!1}get _repo(){return this._instanceStarted||(kl(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal}get _root(){return this._rootInternal||(this._rootInternal=new Jl(this._repo,Xr())),this._rootInternal}_delete(){return null!==this._rootInternal&&(function(e,t){const n=rh[t];n&&n[e.key]===e||ar(`Database ${t}(${e.repoInfo_}) has already been deleted.`),function(e){e.persistentConnection_&&e.persistentConnection_.interrupt(bl)}(e),delete n[e.key]}(this._repo,this.app.name),this._repoInternal=null,this._rootInternal=null),Promise.resolve()}_checkNotDeleted(e){null===this._rootInternal&&ar("Cannot call "+e+" on a deleted database.")}}mo.prototype.simpleListen=function(e,t){this.sendRequest("q",{p:e},t)},mo.prototype.echo=function(e,t){this.sendRequest("echo",{d:e},t)},$s=De,Ne(new z("database",((e,{instanceIdentifier:t})=>function(e,t,n,i,s){let r=i||e.options.databaseURL;void 0===r&&(e.options.projectId||ar("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),sr("Using default host for project ",e.options.projectId),r=`${e.options.projectId}-default-rtdb.firebaseio.com`);let o,a,c=zl(r,s),l=c.repoInfo;"undefined"!=typeof process&&process.env&&(a=process.env[sh]),a?(o=!0,r=`http://${a}?ns=${l.namespace}`,c=zl(r,s),l=c.repoInfo):o=!c.repoInfo.secure;const h=s&&o?new Er(Er.OWNER):new kr(e.name,e.options,t);_l("Invalid Firebase Database URL",c),oo(c.path)||ar("Database URL must point to the root of a Firebase Database (not including a child path).");const u=function(e,t,n,i){let s=rh[t.name];s||(s={},rh[t.name]=s);let r=s[e.toURLString()];return r&&ar("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),r=new Tl(e,oh,n,i),s[e.toURLString()]=r,r}(l,e,h,new Tr(e.name,n));return new ah(u,e)}(e.getProvider("app").getImmediate(),e.getProvider("auth-internal"),e.getProvider("app-check-internal"),t)),"PUBLIC").setMultipleInstances(!0)),xe(zs,Bs,void 0),xe(zs,Bs,"esm2017"),function(e=Ae()){const t=Pe(e=V(e),At);t.isInitialized()?t.getImmediate():function(e,t={}){const n=Pe(e,At);if(n.isInitialized()){const e=n.getImmediate();if(N(t,n.getOptions()))return e;throw Wt.create("already-initialized")}n.initialize({options:t})}(e)}(function(e,t={}){"object"!=typeof t&&(t={name:t});const n=Object.assign({name:Ce,automaticDataCollectionEnabled:!1},t),i=n.name;if("string"!=typeof i||!i)throw Re.create("bad-app-name",{appName:String(i)});const s=ke.get(i);if(s){if(N(e,s.options)&&N(n,s.config))return s;throw Re.create("duplicate-app",{appName:i})}const r=new K(i);for(const e of Ee.values())r.addComponent(e);const o=new Oe(e,n,r);return ke.set(i,o),o}({apiKey:"AIzaSyBmIarwUuVON-u-2UY8wkvby4LM_PCCKIE",authDomain:"waiting-list-7aede.firebaseapp.com",projectId:"waiting-list-7aede",storageBucket:"waiting-list-7aede.appspot.com",messagingSenderId:"214078511178",appId:"1:214078511178:web:b81ed1805d43b88a506eb3",measurementId:"G-F046QQZRGR"}));const ch=function(e=Ae()){const t=Pe(e,"auth");return t.isInitialized()?t.getImmediate():function(e,t){const n=Pe(e,"auth");if(n.isInitialized()){const e=n.getImmediate();if(N(n.getOptions(),null!=t?t:{}))return e;_n(e,"already-initialized")}return n.initialize({options:t})}(e,{popupRedirectResolver:qs,persistence:[Qi,Ai,Mi]})}(),lh=function(e=Ae(),t){return Pe(e,"database").getImmediate({identifier:t})}();window.addEventListener("load",(()=>{const e=document.getElementById("techs");let t;ih(Xl(lh,"technicians"),(n=>{t=n.val();for(let n=0;n<t.length;n++){const i=document.createElement("option");i.value=i.innerHTML=t[i.id=n].name,e.appendChild(i)}})),document.getElementById("add").addEventListener("click",(()=>{const n=document.getElementById("email"),i=document.getElementById("password");let s="",r=null;/^[\w.]+@\w+\.\w+$/.test(n.value)||(s="Please enter a valid email,",r=n),(i.value.length<8||i.value.length>50)&&(s+=(s?" and ":"Please enter a ")+"password between 8-50 characters",r||(r=i)),s&&(alert(s+"."),r.focus()),async function(e,t,n){const i=hi(e),s=await async function(e,t){return An(e,"POST","/v1/accounts:signUp",Rn(e,t))}(i,{returnSecureToken:!0,email:t,password:n}),r=await Ei._fromIdTokenResponse(i,"signIn",s);return await i._updateCurrentUser(r.user),r}(ch,n.value,i.value).then((n=>{const i=e.options[e.selectedIndex].id;eh(Xl(lh,"technicians/"+i+"/clientsInQueue/"+t.length),n.user.uid),eh(Xl(lh,"users/"+n.user.uid),Number(i))}))}))}))})();